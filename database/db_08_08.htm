<html><!-- #BeginTemplate "/Templates/Database2.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Il linguaggio SQL (le clausole GROUP BY e HAVING)</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Il linguaggio SQL<br>
    Le clausole GROUP BY e HAVING<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/database.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Le <a href="db_08_07.htm">funzioni di aggregazione</a> trattate nell'articolo 
        precedente trovano il loro connubbio naturale con la clausola <b>GROUP 
        BY</b>, utilizzata, come ne dice il nome, per suddividere in gruppi le 
        righe estratte mediante <a href="db_08_01.htm">istruzione <b>SELECT</b></a>. 
        La sintassi generale, molto semplice &egrave; la seguente:</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p class="codicevb2">GROUP BY &lt;campi&gt;</p>
      <p>&Egrave; applicata alle selezioni per suddividere i risultati in gruppi 
        distinti per valore nei campi specificati. Spiegare il funzionamento non 
        &egrave; semplice e ci avvaleremo di alcuni esempi per renderlo pi&ugrave; 
        chiaro. Data la solita selezione dei direttori dalle tabella degli impiegati:</p>
      <p class="codicevb2">SELECT nome, cognome, stipendio FROM impiegati WHERE 
        ruolo='Direttore'</p>
      <p>Possiamo avere la necessit&agrave; di recuperare il costo medio oppure 
        totale suddiviso per ruolo. Sappiamo di poter sfruttare le funzioni di 
        aggregazione <b>AVG</b> e <b>SUM</b> per ottenere questi dati ma tutti 
        gli esempi che abbiamo gi&agrave; visto restituivano sempre e soltanto 
        una singola riga, come totale o media di tutte le righe richieste dalla 
        <a href="db_08_02.htm">clausola WHERE</a> (o dall'intera tabella in assenza 
        della clausola). Vediamo invece come spaccare il set di risultati in pi&ugrave; 
        gruppi, ognuno dei quali con il proprio criterio di aggregazione:</p>
      <p class="codicevb2">SELECT ruolo, AVG(stipendio) AS media, SUM(stipendio) 
        AS somma<br>
        FROM dipendenti GROUP BY ruolo</p>
      <p>Restituir&agrave; tre colonne in cui la prima conterr&agrave; il ruolo 
        del gruppo di dipendenti, la seconda lo stipendio medio del gruppo cui 
        appartengono e la terza la somma degli stipendi di ogni gruppo di persone:</p>
      <table width="45%" border="1" align="center">
        <tr> 
          <th width="50%">RUOLO</th>
          <th width="25%">MEDIA</th>
          <th width="25%">SOMMA</th>
        </tr>
        <tr> 
          <td width="50%">Impiegato</td>
          <td align="center" width="25%">1000</td>
          <td align="center" width="25%">5000</td>
        </tr>
        <tr> 
          <td width="50%">Direttore</td>
          <td align="center" width="25%">3100</td>
          <td align="center" width="25%">9500</td>
        </tr>
      </table>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>&Egrave; importante capire il funzionamento della clausola GROUP BY e 
        delle funzioni di aggregazione, perch&eacute; il loro comportamento &egrave; 
        ben differente da quello delle altre clausole; affinch&egrave; sia possibile 
        il raggruppamento &egrave; necessario che tutti i campi coinvolti nella 
        selezione siano raggruppati. Nell'esempio precedente esiste un criterio 
        di raggruppamento dato dal campo ruolo che segue la clausola GROUP BY, 
        mentre gli altri due campi contengono funzioni di aggregazione che, come 
        abbiamo gi&agrave; visto, restituiscono sempre un'unica riga. L'espressione 
        contiene quindi tre campi raggruppati.</p>
      <p>Il principio di fondo delle funzioni di aggregazione e della clausola 
        GROUP BY &egrave; infatti questo: tutti i campi devono rappresentare un 
        raggruppamento, dettato da un'aggregazione oppure da una clausola GROUP 
        BY. Questa &egrave; la ragione per cui questa clausola costituisce il 
        complemento delle funzioni viste nell'articolo precedente.</p>
      <p>Vediamo qualche altro esempio:</p>
      <p class="codicevb2">SELECT ruolo, stipendio, COUNT(stipendio) AS conta, 
        SUM(stipendio) AS somma<br>
        FROM dipendenti GROUP BY ruolo, stipendio</p>
      <p>Questa selezione restituisce lo stipendio, il numero di dipendententi 
        e la spesa totale differenziata per ciascun valore di stipendio. Nell'esempio 
        ci&ograve; che riporter&agrave; saranno i dati seguenti:</p>
      <table width="65%" border="1" align="center">
        <tr> 
          <th width="40%">RUOLO</th>
          <th width="20%">STIPENDIO</th>
          <th width="20%">CONTA</th>
          <th width="20%">SOMMA</th>
        </tr>
        <tr> 
          <td width="40%">Impiegato</td>
          <td align="center" width="20%">1000</td>
          <td align="center" width="20%">5</td>
          <td align="center" width="20%">5000</td>
        </tr>
        <tr> 
          <td width="40%">Direttore</td>
          <td align="center" width="20%">2700</td>
          <td align="center" width="20%">1</td>
          <td align="center" width="20%">2700</td>
        </tr>
        <tr> 
          <td width="40%">Direttore</td>
          <td align="center" width="20%">3400</td>
          <td align="center" width="20%">2</td>
          <td align="center" width="20%">6800</td>
        </tr>
      </table>
      <p>Anche in questo caso tutti i campi sono ragguppati; i primi due sono 
        regolati dalla clausola GROUP BY, gli ultimi due dalle funzioni di aggregazione. 
        Possiamo notare la presenza di due righe con il ruolo Direttore, ma differenziate 
        per stipendio. I cinque impiegati sono invece raggruppati su un'unica 
        riga perch&egrave; tutti con lo stesso stipendio.</p>
      <p><!-- #BeginLibraryItem "/Library/Notes2.lbi" --><img src="../images/notes2.gif" width="31" height="32" align="left"><!-- #EndLibraryItem -->Se 
        il database lamenta qualcosa circa l'assenza di un campo dell'istruzione 
        SELECT all'interno delle clausola GROUP BY oppure delle funzioni di aggregazione 
        la ragione &egrave; quella gi&agrave; accennata: tutti i campi dell'istruzione 
        devono essere raggruppati in una delle due maniere gi&agrave; accennate.</p>
      <hr class="hrseparator">
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><a name="HAVING"></a>La clausola <b>HAVING</b> rappresenta un vincolo 
        sui dati risultanti dall'operazione di raggruppamento. Il suo funzionamento 
        &egrave; molto simile a quello della clausola WHERE ma anzich&eacute; 
        operare sui campi del database opera sui raggruppamenti; i campi richiesti 
        possono essere sia quelli delle funzioni di aggregazione sia quelli indicati 
        nelle clausole GROUP BY.</p>
      <p>Riprendendo l'esempio precedente per estrarre soltanto quelle righe in 
        cui il numero di dipendenti sia maggiore di 1:</p>
      <p class="codicevb2">SELECT ruolo, stipendio, COUNT(stipendio) AS conta, 
        SUM(stipendio) AS somma<br>
        FROM dipendenti GROUP BY ruolo, stipendio HAVING COUNT(stipendio) &gt; 
        1 </p>
      <p>Si tratta dello stesso esempio precedente, ma con l'aggiunta di una clausola 
        HAVING che richiede che il numero di stipendi sia superiore a 1; il suo 
        utilizzo &egrave; molto simile a quello della clausola WHERE ma richiede 
        la specifica di un criterio di raggruppamento o aggregazione.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --><!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        17 Marzo 2004<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar2.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice della sezione Database</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
