<html><!-- #BeginTemplate "/Templates/Richieste.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Connettere un'unità di rete</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Connettere un'unit&agrave; 
    di rete<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/activity.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Richiesta di: <!-- #BeginEditable "RICHIEDENTE" -->Diego 
        Indaimo<!-- #EndEditable --> 
        - <!-- #BeginEditable "DATARICHIESTA" -->14 
        Aprile 2002<!-- #EndEditable --><br>
        Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level4.gif" width="17" height="18" align="absmiddle"> 
        4<!-- #EndEditable --> / 5 </p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" -->
      <p><i>Lavoro in un ufficio collegato tramite rete locale. Molto spesso sono 
        costretto a collegarmi agli altri computer tramite il comando NET USE. 
        Vorrei sapere come posso implementare questo comando in un applicazione 
        scritta in Visual Basic.</i></p>
      <hr>
      <p>Esistono svariate soluzioni per questo problema. La pi&ugrave; semplice 
        consiste nel richiamare lo stesso comando DOS tramite la funzione <b>Shell</b>. 
        Ad esempio:</p>
      <p><code>Call Shell(&quot;NET USE T: \\LINUX\tmp pass&quot;)</code></p>
      <p>Richiama il comando <i><b>NET USE</b></i> indicando di connettere l'unit&agrave; 
        <b>T:</b> alla condivisione <b>tmp</b> del server <b>LINUX</b>, utilizzando 
        la password <b>pass</b>.</p>
      <p>In questo articolo invece dedicheremo una particolare cura allo sviluppo 
        di un modulo per la scelta di una cartella di rete condivisa. Potr&agrave; 
        quindi essere connessa un'unit&agrave; di rete alla cartella condivisa 
        selezionata. Questa soluzione ha molti punti in comune con l'<a href="../howto/ht_009.htm">HowTo 
        dedicato alla selezione di una cartella</a> ed utilizza la stessa funzione 
        <b>ShBrowseForFolder</b> con un pizzico di personalizzazione in pi&ugrave;. 
        Prima di procedere si raccomanda la consultazione del citato articolo.</p>
      <p>La personalizzazione consiste nell'utilizzo di una funzione di <a href="../glossary/c.htm#CALLBACK">Callback</a> 
        che ricever&agrave; i <a href="../glossary/m.htm#MESSAGGIO">messaggi</a> 
        inviati dalla finestra di dialogo e regoler&agrave; la possibilit&agrave; 
        di scegliere una cartella che sia condivisa piuttosto che un'altra che 
        non lo sia. L'impostazione della funzione di callback &egrave; effettuato 
        impostando il <a href="../glossary/m.htm#MEMBRO">membro</a> <b>lpfn</b> 
        della struttura <img src="../images/ide/tipoudt.gif" width="16" height="16" align="absmiddle"> 
        <i><b>BROWSEINFO</b></i>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Il codice per il richiamo di tale finestra di dialogo deve necessariamente 
        stare o utilizzare un modulo <img src="../images/ide/modulo.gif" width="16" height="16" align="absmiddle"> 
        standard poich&eacute; la funzione <b>AddressOf</b> di Visual Basic, che 
        restituisce un <a href="../glossary/p.htm#PUNTATORE">puntatore</a> ad 
        una funzione, pu&ograve; essere utilizzato soltanto facendo riferimento 
        ad una funzione posta all'interno di un modulo standard. Vediamo pertanto 
        il codice:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Type BROWSEINFO</li>
        <li>&nbsp;&nbsp;hOwner As Long</li>
        <li>&nbsp;&nbsp;pidlRoot As Long</li>
        <li>&nbsp;&nbsp;pszDisplayName As String</li>
        <li>&nbsp;&nbsp;lpszTitle As String</li>
        <li>&nbsp;&nbsp;ulFlags As Long</li>
        <li>&nbsp;&nbsp;lpfn As Long</li>
        <li>&nbsp;&nbsp;lParam As Long</li>
        <li>&nbsp;&nbsp;iImage As Long</li>
        <li>End Type</li>
        <li></li>
        <li>Private Const BIF_RETURNONLYFSDIRS = &amp;H1</li>
        <li>Private Const BIF_STATUSTEXT = &amp;H4</li>
        <li>Private Const CSIDL_NETWORK = &amp;H12</li>
        <li>Private Const MAX_PATH = 260</li>
        <li>Private Const WM_USER = &amp;H400</li>
        <li>Private Const BFFM_SELCHANGED = 2</li>
        <li>Private Const BFFM_ENABLEOK = (WM_USER + 101)</li>
        <li>Private Const BFFM_SETSTATUSTEXTA = (WM_USER + 100)</li>
        <li></li>
      </ol>
      <p>Il tipo di dati <i><b>BROWSEINFO</b></i> servir&agrave; per specificare 
        una serie di dati utilizzati dalla funzione <b>ShBrowseForFolder</b>. 
        Tali dati sono l'handle della finestra che richiama l'altra finestra di 
        dialogo (<i>hOwner</i>), la cartella che far&agrave; da radice nella selezione 
        (<i>pidlRoot</i>), il titolo che apparir&agrave; nella finestra di dialogo 
        (<i>lpszTitle</i>) , le opzioni di scelta (<i>ulFlags</i>), il puntatore 
        alla funzione di Callback (<i>lpfn</i>) e degli eventuali dati aggiuntivi 
        da passare alla funzione di Callback (<i>lParam</i>). Gli altri due membri 
        (<i>pszDisplayName</i> ed <i>iImage</i>) non sono utilizzati in questo 
        esempio.</p>
      <p>Alle righe 14-21 seguono le dichiarazioni delle costanti <a href="../glossary/a.htm#API">API</a>: 
        la prima &egrave; gi&agrave; stata spiegata nell'<a href="../howto/ht_009.htm">altro 
        articolo</a>. <i><b>BIF_STATUSTEXT</b></i> consente di aggiungere un messaggio 
        alla finestra di dialogo tramite la funzione di Callback. <i><b>CSIDL_NETWORK</b></i> 
        definisce l'insieme delle Risorse di rete e verr&agrave; utilizzata da 
        radice nella ricerca. <i><b>MAX_PATH</b></i> indicher&agrave; la lunghezza 
        massima di un percorso di una cartella e sar&agrave; utilizzata per allocare 
        un <a href="../glossary/b.htm#BUFFER">buffer</a> sufficientemente ampio. 
        Le costanti alle righe 19-21 indicano tre messaggi relativi alla finestra 
        di dialogo e saranno spiegati pi&ugrave; avanti. </p>
      <ol class="codicevb" start="23">
        <li>Private Declare Function SHBrowseForFolder Lib &quot;shell32.dll&quot; 
          Alias &quot;SHBrowseForFolderA&quot; (lpBrowseInfo As BROWSEINFO) As 
          Long</li>
        <li>Private Declare Function SHGetPathFromIDList Lib &quot;shell32.dll&quot; 
          Alias &quot;SHGetPathFromIDListA&quot; (ByVal pidl As Long, ByVal pszPath 
          As String) As Long</li>
        <li>Private Declare Sub CoTaskMemFree Lib &quot;ole32.dll&quot; (ByVal 
          pv As Long)</li>
        <li>Private Declare Function SendMessage Lib &quot;user32&quot; Alias 
          &quot;SendMessageA&quot; (ByVal hWnd As Long, ByVal wMsg As Long, ByVal 
          wParam As Long, lParam As Any) As Long</li>
        <li></li>
      </ol>
      <p>Dovremmo gi&agrave; conoscere le tre funzioni dichiarate alle righe 23-25; 
        ad esse aggiungiamo la ben nota <b>SendMessage</b> che consente di inviare 
        un messaggio specifico ad una finestra ben definita.</p>
      <ol class="codicevb" start="28">
        <li>Public Function SfogliaCondivisione(ByVal hWnd As Long, ByRef strCondivisione 
          As String, Optional ByVal strErrorStatus As String = &quot;&quot;) As 
          Boolean</li>
        <li>&nbsp;&nbsp;Dim BInfo As BROWSEINFO</li>
        <li>&nbsp;&nbsp;Dim lngPercorsoAllocato As Long</li>
        <li>&nbsp;&nbsp;Dim strPercorsoScelto As String</li>
        <li>&nbsp;&nbsp;With BInfo</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;.hOwner = hWnd</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;.lpfn = FunPtr(AddressOf BrowseCallbackProc)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;.lpszTitle = &quot;Scegli una condivisione:&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;.pidlRoot = CSIDL_NETWORK</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;.ulFlags = BIF_RETURNONLYFSDIRS</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If strErrorStatus &lt;&gt; &quot;&quot; Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ulFlags = .ulFlags + BIF_STATUSTEXT</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strErrorStatus = StrConv(strErrorStatus, 
          vbFromUnicode)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.lParam = StrPtr(strErrorStatus)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;End With</li>
      </ol>
      <p>La funzione <b>SfogliaCondivisione</b> si occuper&agrave; di mostrare 
        all'utente la finestra di dialogo per la scelta della cartella condivisa. 
        Essa richiede l'<a href="../glossary/h.htm#HANDLE">handle</a> del form 
        che la richiama, una variabile buffer di nome <b>strCondivisione</b> per 
        contere il percorso della cartella recuperata ed infine consente opzionalmente 
        di fornire una stringa che verr&agrave; mostrata nel momento in cui l'utente 
        seleziona una cartella non condivisa (<b>strErrorStatus</b>).</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Alle righe 32-43 verr&agrave; riempita la struttura BInfo di tipo BROWSEINFO. 
        La riga 33 specifica l'handle della finestra, mentre la successiva assegna 
        al membro <b>lpfn</b> il puntatore alla funzione di Callback tramite la 
        funzione <b>FunPtr</b> che vedremo dopo.</p>
      <p>Verr&agrave; impostata la radice delle cartelle ed anche il titolo della 
        finestra di dialogo (righe 35 e 36). Se &egrave; stato specificato un 
        messaggio di errore per la scelta delle cartelle condivise sar&agrave; 
        allora necessario specificare nelle opzioni di utilizzare tale messaggio 
        quando richiesto dalla funzione di Callback. La stringa da passare verr&agrave; 
        prima convertita in formato <a href="../glossary/a.htm#ANSI">ANSI</a> 
        e ne verr&agrave; passato il <a href="../glossary/p.htm#PUNTATORE">puntatore</a> 
        nel membro <b>lParam</b> (righe 38-42).</p>
      <ol class="codicevb" start="44">
        <li>&nbsp;&nbsp;lngPercorsoAllocato = SHBrowseForFolder(BInfo)</li>
        <li>&nbsp;&nbsp;strPercorsoScelto = Space$(MAX_PATH)</li>
        <li>&nbsp;&nbsp;SfogliaCondivisione = SHGetPathFromIDList(lngPercorsoAllocato, 
          strPercorsoScelto)</li>
        <li>&nbsp;&nbsp;If SfogliaCondivisione = True Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;CoTaskMemFree lngPercorsoAllocato</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;strCondivisione = Left$(strPercorsoScelto, 
          InStr(strPercorsoScelto, Chr$(0)) - 1)</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>Alla riga 44 verr&agrave; richiamata la finestra di dialogo con le opzioni 
        specificate in precedenza. Il procedimento di estrazione della cartella 
        selezionata &egrave; pressocch&eacute; identico a quello specificato nell'altro 
        articolo. La cartella selezionata sar&agrave; quindi memorizzata nella 
        variabile di ritorno <b>strCondivisione</b>.</p>
      <ol class="codicevb" start="53">
        <li>Private Function FunPtr(ByVal lngFn As Long) As Long</li>
        <li>&nbsp;&nbsp;FunPtr = lngFn</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>La funzione <b>FunPtr</b> &egrave; estremamente semplice, tanto da sembrare 
        inutile. Purtroppo Visual Basic non consente di assegnare il valore di 
        un'espressione <b>AddressOf</b> ad una variabile. &Egrave; pertanto necessario 
        passare tale espressione ad una funzione fantasma che restituir&agrave; 
        come valore di ritorno il puntatore fornito (riga 54).</p>
      <ol class="codicevb" start="57">
        <li>Private Function BrowseCallbackProc(ByVal hWnd As Long, ByVal uMsg 
          As Long, ByVal lParam As Long, ByVal lpData As Long) As Long</li>
        <li>&nbsp;&nbsp;Dim strBuf As String</li>
        <li>&nbsp;&nbsp;Dim intPos As Integer</li>
        <li>&nbsp;&nbsp;If uMsg = BFFM_SELCHANGED Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;strBuf = Space$(MAX_PATH)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If SHGetPathFromIDList(lParam, strBuf) Then</li>
      </ol>
      <p>La funzione di Callback prende il nome di <b>BrowseCallbackProc</b> e 
        consente di ricevere i messaggi inviati dalla finestra di dialogo. L'unico 
        messaggio che interessa noi &egrave; <i><b>BFFM_SELCHANGED</b></i> (riga 
        60), che indica che la selezione si &egrave; spostata su un elemento della 
        lista. L'elemento selezionato si trova in <b>lParam, </b>sar&agrave; estratto 
        alle righe 61 e 62 e dovr&agrave; essere controllato.</p>
      <p>Se il percorso della cartella scelta &egrave; una cartella condivisa 
        conterr&agrave; due backslash all'inizio ( \\ ), il nome del computer, 
        un ulteriore barra rovesciata ed il nome della cartella condivisa. Un 
        esempio potrebbe essere <code>\\LINUX\tmp</code>.</p>
      <p><img src="../images/activity/att20_01.png" width="259" height="265" align="right" alt="Figura 1">La 
        presenza di ulteriori backslash indicher&agrave; una sottocartella della 
        cartella condivisa selezionata. Tali sottocartelle saranno evitate bloccando 
        il pulsante OK che consente la chiusura della finestra di dialogo.</p>
      <p>Il blocco del pulsante OK &egrave; effettuato inviando il messaggio <i><b>BFFM_ENABLEOK</b></i> 
        alla finestra di dialogo e specificando nell'argomento <b>lParam</b> un 
        valore 0. Nel caso venga selezionata una cartella non condivisa sar&agrave; 
        anche mostrato l'eventuale messaggio di errore passato alla struttura 
        alla riga 41.</p>
      <p>Nella figura fianco &egrave; stata selezionata la cartella <b>etc</b> 
        della condivisione <b>public</b> sul computer <b>FIBIA_486</b>. Non essendo 
        una cartella condivisa (ma una sua sottocartella) il pulsante OK &egrave; 
        stato bloccato ed in alto &egrave; apparso l'avviso <i>Condivisione non 
        valida</i>.</p>
      <ol class="codicevb" start="63">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intPos = InStr(3, strBuf, &quot;\&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If InStr(intPos + 1, strBuf, &quot;\&quot;) 
          &gt; 0 Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage hWnd, 
          BFFM_ENABLEOK, ByVal 0&amp;, ByVal 0&amp;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage hWnd, 
          BFFM_SETSTATUSTEXTA, ByVal 0&amp;, ByVal lpData</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage hWnd, 
          BFFM_SETSTATUSTEXTA, ByVal 0&amp;, ByVal vbNullChar</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage hWnd, BFFM_SETSTATUSTEXTA, 
          ByVal 0&amp;, ByVal lpData</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessage hWnd, BFFM_ENABLEOK, 
          ByVal 0&amp;, ByVal 0&amp;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Function</li>
      </ol>
      <p>L'accennato controllo &egrave; svolto alle righe 63 e 64. Se non &egrave; 
        presente la barra di separazione tra il nome del computer e la cartella, 
        sar&agrave; segno che la selezione si trova sopra il nome di un computer 
        e pertanto (righe 70-72) sar&agrave; bloccato il pulsante OK della finestra 
        di dialogo e verr&agrave; mostrato il messaggio di errore. Se la barra 
        di separazione tra nome del computer e cartella &egrave; presente, sar&agrave; 
        quindi verificata la presenza di un'ulteriore barra (per una sottocartella). 
        La sua presenza bloccher&agrave; il pulsante OK e mostrer&agrave; il messaggio 
        di errore (righe 65 e 66).</p>
      <p>In caso di assenza di quest'ultima condizione (ovvero di un'ulteriore 
        barra dopo quella che separa il nome del computer dalla condivisione), 
        la cartella scelta non &egrave; n&egrave; il nome di un computer n&eacute; 
        una sottocartella di una cartella condivisa. &Egrave; invece una cartella 
        condivisa e pertanto sar&agrave; cancellato l'eventuale avviso passato 
        dagli errori precedenti (riga 71).</p>
      <hr>
      <p><img src="../images/activity/att20_02.png" width="222" height="102" align="right" alt="Figura 2">Possiamo 
        provare il modulo appena sviluppato con il form presentato a fianco, costituito 
        da una serie di <i>Label</i>, <i>TextBox</i> e <i>CommandButton</i>. I 
        controlli fondamentali sono la casella di testo <b>txtCondivisione</b>, 
        il pulsante <b>cmdSfoglia</b>, le caselle <b>txtPassword</b> (con propriet&agrave; 
        <i> <b>PasswordChar</b></i> impostata su *) e <b>txtDisco</b> (con propriet&agrave; 
        <i> <b>MaxLength</b></i> impostata su 1) ed infine i due pulsanti in basso 
        <b>cmdConnetti</b> e <b>cmdDisconnetti</b>. Il funzionamento &egrave; 
        molto semplice: l'utente potr&agrave; immettere manualmente il percorso 
        della cartella condivisa oppure effettuare la scelta premendo il pulsante 
        <i> <b>Sfoglia</b></i>. Dovr&agrave; anche immettere l'eventuale password 
        e specificare la lettera dell'unit&agrave; da assegnare, prima di premere 
        il pulsante <i><b>Connetti unit&agrave; di rete</b></i>. Per disconnettere 
        un'unit&agrave; sar&agrave; invece necessaria soltanto la letter&agrave; 
        dell'unit&agrave; e la pressione del pulsatne <i><b>Disconnetti unit&agrave;</b></i>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Il codice del form si compone di sole tre procedure legate al click sopra 
        ognuno dei tre pulsanti:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Declare Function WNetAddConnection Lib &quot;mpr.dll&quot; 
          Alias &quot;WNetAddConnectionA&quot; (ByVal lpszNetPath As String, ByVal 
          lpszPassword As String, ByVal lpszLocalName As String) As Long</li>
        <li>Private Declare Function WNetCancelConnection Lib &quot;mpr.dll&quot; 
          Alias &quot;WNetCancelConnectionA&quot; (ByVal lpszName As String, ByVal 
          bForce As Long) As Long</li>
        <li></li>
        <li>Private Sub cmdSfoglia_Click()</li>
        <li>&nbsp;&nbsp;Dim strCondivisione As String</li>
        <li>&nbsp;&nbsp;If SfogliaCondivisione(Me.hWnd, strCondivisione, &quot;Condivisione 
          non valida!&quot;) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;txtCondivisione.Text = strCondivisione</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Alla riga 3 &egrave; dichiarata la funzione <a href="../glossary/a.htm#API">API</a> 
        <b>WNetAddConnection</b> che consente la connessione di un'unit&agrave; 
        rete, mentre la funzione successiva <b>WNetCancelConnection</b> consente 
        la sua disconnessione.</p>
      <p>Alla riga 8 &egrave; richiamata la funzione SfogliaCondivisione dal modulo, 
        fornendole l'<a href="../glossary/h.htm#HANDLE">handle</a> del form che 
        richiama la finestra di dialogo, un <a href="../glossary/b.htm#BUFFER">buffer</a> 
        di nome <b>strCondivisione</b> ed il messaggio di errore <i><b>&quot;Condivisione 
        non valida!&quot;</b></i> sulle cartelle non condivise. Se la funzione 
        ritorna un valore True sar&agrave; segno che l'utente ha effettuato la 
        sua scelta premendo il pulsante OK. Sar&agrave; pertanto inserito il percorso 
        della cartella scelta nella casella <b>txtCondivisione</b> (riga 9).</p>
      <ol class="codicevb" start="13">
        <li>Private Sub cmdConnetti_Click()</li>
        <li>&nbsp;&nbsp;If WNetAddConnection(txtCondivisione.Text, txtPassword.Text, 
          txtDisco &amp; &quot;:&quot;) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Errore durante la connessione 
          a &quot; &amp; txtCondivisione.Text, vbCritical + vbOKOnly, Me.Caption</li>
        <li>&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Unit&agrave; di rete &quot; &amp; 
          txtDisco.Text &amp; &quot;: connessa!&quot;, vbInformation + vbOKOnly, 
          Me.Caption</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Alla pressione del pulsante <b>cmdConnetti</b> verr&agrave; connessa 
        l'unit&agrave; di rete tramite la funzione <b>WNetAddConnection</b>. In 
        ambo i casi di successo o fallimento sar&agrave; mostata una finestra 
        di avviso con le relative informazioni.</p>
      <ol class="codicevb" start="21">
        <li>Private Sub cmdDisconnetti_Click()</li>
        <li>&nbsp;&nbsp;If WNetCancelConnection(txtDisco &amp; &quot;:&quot;, 
          ByVal 0&amp;) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Errore durante la disconnessione 
          di &quot; &amp; txtDisco &amp; &quot;:&quot;, vbCritical + vbOKOnly, 
          Me.Caption</li>
        <li>&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Unit&agrave; di rete &quot; &amp; 
          txtDisco.Text &amp; &quot;: disconnessa!&quot;, vbInformation + vbOKOnly, 
          Me.Caption</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Sub</li>
      </ol>
      <p>Alla stessa maniera, alla pressione del pulsante <b>cmdDisconnetti</b> 
        dovr&agrave; essere disconnesa l'unit&agrave; di rete tramite la funzione 
        <b>WNetCancelConnection</b> ed in base al risultato dell'operazione sar&agrave; 
        mostrato un avviso.</p>
      <hr>
      <p><img src="../images/activity/att20_03.png" width="259" height="265" align="right" alt="Figura 3">La 
        dimostrazione del funzionamento del progetto &egrave; molto semplice. 
        Baster&agrave; cliccare sul pulsante <i><b>Sfoglia</b></i>, selezionare 
        una cartella condivisa, notando come il pulsante OK si attiva e si disattiva 
        in funzione della selezione; si comporta allo stesso modo anche il messaggio 
        informativo tra il titolo e l'elenco delle cartelle.</p>
      <p>Nel nostro esempio abbiamo scelto la condivisione <b>public</b> sul computer 
        <b>FIBIA_486</b>.</p>
      <p>Alla pressione del pulsante OK sar&agrave; ricopiato il percorso della 
        cartella nella casella di testo <b>txtCondivisione</b>.</p>
      <p>Non ci resta che riempire i dati mancanti fornendo l'eventuale password 
        per la cartella e la lettera dell'unit&agrave; da assegnare e premere 
        il pulsante <i> <b>Connetti unit&agrave; di rete</b></i>.</p>
      <p>Oltre che con il messaggio informativo possiamo verificare l'avvenuta 
        connessione aprendo la finestra <i>Risorse del computer</i> per vedere 
        l'unit&agrave; di rete connessa, come mostrato nella figura sotto.</p>
      <table width="100%" border="0" cellspacing="2" cellpadding="2" align="center">
        <tr> 
          <td width="50%" align="center" valign="top"><img src="../images/activity/att20_04.png" width="222" height="102" alt="Figura 4"><br>
            <b>Figura 4</b></td>
          <td width="50%" align="center" valign="top"><img src="../images/activity/att20_05.png" width="294" height="374" alt="Figura 5"><br>
            <b>Figura 5</b></td>
        </tr>
      </table>
      <br>
      <br>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Questo articolo implementa una soluzione per la connessione di unit&agrave; 
        di rete molto comoda ed utilizza una tecnica di Callback molto semplice. 
        &Egrave; stata provata utilizzando una rete di tipo Microsoft ed unit&agrave; 
        Linux connessa tramite Samba nel formato di condivisione Windows NT.</p>
      <p>Non si pongono rischi particolari connessi all'utilizzo di questa soluzione 
        in quanto tutte le operazioni di richiamo della funzione di Callback sono 
        svolte dalla funzione API. Potrebbero invece presentarsi problemi se la 
        funzione di Callback viene modificata in maniera impropria.</p>
      <!-- #EndEditable --><!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        22 Aprile 2002</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'introduzione delle Richieste dei lettori</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
