<html><!-- #BeginTemplate "/Templates/Richieste.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Generare dei files in base ad un particolare tracciato (terza parte)</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Generare dei files in base 
    ad un particolare tracciato<br>
    (terza&nbsp;parte)<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/activity.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Richiesta di: <!-- #BeginEditable "RICHIEDENTE" -->Roberto 
        Corona<!-- #EndEditable --> 
        - <!-- #BeginEditable "DATARICHIESTA" -->12 
        Gennaio 2001<!-- #EndEditable --><br>
        Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level4.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level5.gif" width="17" height="18" align="absmiddle"> 
        5<!-- #EndEditable --> / 5 </p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p><i>Ho bisogno di scrivere un programmino che, dopo aver analizzato dei 
        files contenenti dei particolari tracciati, estragga dei dati da un foglio 
        di Excel e tramite questi generi dei files di testo con una particolare 
        struttura determinata dal file del tracciato.</i></p>
      <hr>
      <p align="center"><a href="act_11_2.htm">&lt;&lt; Continua dalla parte 2</a></p>
      <p>Terminata la visione e lo studio del modulo standard del progetto possiamo 
        passare ai due form che compongono l'interfaccia utente.</p>
      <p>Poich&eacute; i due form sono strettamente connessi, nello studio sar&agrave; 
        necessario dare un primo sguardo al primo form, studiare il secondo e 
        una volta fatto, terminare lo studio del primo form.</p>
      <p>Cominciamo con la semplicissima interfaccia utente del form principale.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/activity/att11_01.jpg" width="203" height="174" alt="Figura 1" align="right">Essa 
        consiste in 5 <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">e 
        5 <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
        e in basso appaiono due semplici <i>CommandButton</i><img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">che 
        serviranno per accedere al secondo form e confermare i dati immessi.</p>
      <p>Abbiamo quindi nell'ordine:</p>
      <ul>
        <li>Una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
          nome <b>DatiInputLabel</b> con la <i>Caption</i> impostata a <i><b>&quot;File 
          Dati di Input:&quot;</b></i>;</li>
        <li>Una <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
          di nome <b>DatiInputText</b>, che dovr&agrave; contenere il nome del 
          file di Excel contenente i dati da processare;</li>
        <li>Una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
          nome <b>NomeFoglioLabel</b> con la <i>Caption</i> impostata a <i><b>&quot;Nome 
          del foglio:&quot;</b></i>;</li>
        <li>Una <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
          di nome <b>NomeFoglioText</b> che dovr&agrave; contenere il nome del 
          foglio del file di Excel con i dati da processare;</li>
        <li>Una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
          nome <b>TracciatoLabel</b> con la <i>Caption</i> impostata a <i><b>&quot;File 
          Tracciato:&quot;</b></i>;</li>
        <li>Una <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
          di nome <b>TracciatoText</b> che dovr&agrave; contenere il nome del 
          file di testo del tracciato;</li>
        <li>Una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
          nome <b>DefinizioneLabel</b> con la <i>Caption</i> impostata a <i><b>&quot;File 
          definizione:&quot;</b></i>;</li>
        <li>Una <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
          di nome <b>DefinizioneText</b> che dovr&agrave; contenere il nome di 
          un file definizione .FDF salvato tramite l'utility di Creazione delle 
          definizioni;</li>
        <li>Una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
          nome <b>OutputLabel</b> con la <i>Caption</i> impostata a <i><b>&quot;File 
          di Output:&quot;</b></i>;</li>
        <li>Una <i>TextBox</i> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
          di nome <b>OutputText</b> che dovr&agrave; contenere il nome del file 
          di testo in cui saranno salvati i dati. Tale file non deve esistere 
          su Hard disk e nel caso che ci fosse non sar&agrave; tentata la scrittura;</li>
        <li>Un <i>CommanButton</i><img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">di 
          nome <b>CreaDefinizione</b> con la <i>Caption</i> impostata a <i><b>&quot;Crea 
          definizione&quot;</b></i> che servir&agrave; per richiamare l'utility 
          di Definizione delle definizioni;</li>
        <li>Un <i>CommanButton</i><img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">di 
          nome <b>GeneraOutput</b> con la <i>Caption</i> impostata a <i><b>&quot;Genera 
          output&quot;</b></i> che servir&agrave; ad accettare tutti i dati immessi 
          e generare il file .TXT voluto con questo programma.</li>
      </ul>
      <p>Il codice &egrave; molto semplice: saranno gestiti soltanto tre <a href="../glossary/e.htm#EVENTO">eventi</a><img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle">in 
        questo form: il click sopra il pulsante <i><b>&quot;Crea definizione&quot;</b></i>, 
        il click sopra il pulsante <i><b>&quot;Genera output&quot;</b></i> e la 
        chiusura del programma per effettuare la chiusura del database <i>EXCEL</i> 
        aperto.</p>
      <p>Inizialmente vedremo soltanto il primo e l'ultimo evento, poich&eacute; 
        ancora non sappiamo come sia costituito il file di definizione.</p>
      <p>Ecco quindi le poche righe di codice:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Sub CreaDefinizione_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;On Error GoTo ERRORE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If FileEsiste(DatiInputText.Text) = False 
          Then Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If FileEsiste(TracciatoText.Text) = False 
          Then Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Len(Trim(NomeFoglioText.Text)) = 0 Then 
          Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FILEXLS = OpenDatabase(DatiInputText.Text, 
          0, 0, &quot;Excel 5.0&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FOGLIOXLS = FILEXLS.OpenRecordset(NomeFoglioText.Text 
          &amp; &quot;$&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Load DefinitionForm</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;DefinitionForm.FileTracciato.LoadFile TracciatoText.Text, 
          rtfText</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;DefinitionForm.Show vbModal</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Unload DefinitionForm</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Exit Sub</li>
        <li>ERRORE:</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Si &egrave; verificato un errore.&quot;, 
          vbCritical + vbOKOnly, &quot;Genera output&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FOGLIOXLS = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FILEXLS = Nothing</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Nel momento in cui l'utente clicca sul pulsante CreaDefinizione viene 
        controllato se i dati immessi nelle caselle <i>DatiInputText</i>, <i>TracciatoText</i> 
        e <i>NomeFoglioText</i> sono validi mediante verifica dell'esistenza del 
        file e apertura del foglio di Excel.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Alla riga 4 abbiamo un'istruzione di gestione degli errori; per cui ogni 
        errore far&agrave; si che la Sub giunga al termine.</p>
      <p>Alla riga 8 abbiamo l'apertura del database Excel tramite driver <a href="../glossary/i.htm#ISAM">ISAM</a> 
        &quot;Excel 5.0&quot;, compatibile con tutte le versioni di Excel. Alla 
        riga successiva viene effettuata l'apertura del foglio specificato nella 
        casella di testo apposita.</p>
      <p>Nota che i nomi dei fogli di testo sono memorizzati in una maniera per 
        la quale il nome del foglio &egrave; sempre seguito da un segno di dollaro 
        ($); ecco perch&eacute; l'apertura del Recordset ha come parametro il 
        nome del foglio ed il segno di dollaro.</p>
      <p>Alla riga 10 viene caricato il form <b>DefinitionForm</b>, che si occuper&agrave; 
        di generare i file di definizione, ma non viene mostrato subito. Prima 
        viene caricato il file di tracciato all'interno della <i>RichTextBox</i><img src="../images/controls/richtextbox.gif" width="25" height="25" align="absmiddle"><b>FileTracciato</b> 
        tramite il metodo <i><b>LoadFile</b></i>. Subito dopo questo viene mostrato 
        il form in modalit&agrave; <a href="../glossary/m.htm#MODALE">modale</a>, 
        ovvero a scelta obbligatoria (riga 12).</p>
      <p>Da questo punto in poi la gestione viene affidata completamente al form 
        <b>DefinitionForm</b>. Il nostro form principale si occuper&agrave; soltanto 
        di chiudere il form all'uscita da esso.</p>
      <p>In caso fosse generato qualche errore in questa Sub verr&agrave; mostrato 
        un messaggio di errore (riga 16) e verranno chiusi e <a href="../glossary/d.htm#DEALLOCARE">deallocati</a> 
        il Recordset ed il database Excel.</p>
      <ol class="codicevb" start="21">
        <li>Private Sub Form_Unload(Cancel As Integer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;On Error Resume Next</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FOGLIOXLS.Close</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FILEXLS.Close</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FOGLIOXLS = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FILEXLS = Nothing</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>La chiusura del form si assicura soltanto che vengano chiusi e deallocati 
        correttamente il Recordset FOGLIOXLS ed il database FILEXLS.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Prima di vedere il funzionamento della routine di creazione del file 
        di output &egrave; necessario vedere come si compone il file di definizione.<br>
        Vediamo prima, quindi, il form che si occuper&agrave; della definizione 
        del tracciato. Il nome del form &egrave; <b>DefinitionForm</b> e si presenta 
        abbastanza complesso.</p>
      <p align="center"><img src="../images/activity/att11_02.jpg" width="378" height="262" alt="Figura 2"><br>
        <b>Figura 2</b></p>
      <p>Nella parte superiore del form abbiamo una <i>RichTextBox</i><img src="../images/controls/richtextbox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>FileTracciato</b> con le propriet&agrave; impostate come segue:</p>
      <ul>
        <li><i>AutoVerbMenu</i> = False</li>
        <li><i>DisableNoScroll</i> = True</li>
        <li><i>Font</i> = Courier New normale dimensione 8</li>
        <li><i>HideSelection</i> = False</li>
        <li><i>Locked</i> = True</li>
        <li><i>MultiLine</i> = True</li>
        <li><i>RightMargin</i> = 65000</li>
        <li><i>ScrollBars</i> = 3 - Both</li>
      </ul>
      <p>Nella sezione sotto abbiamo due <i>ListBox</i><img src="../images/controls/listbox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>ListaSezioni</b> e <b>ListaCampi</b>; abbiamo anche una serie 
        di CommandButton<img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">i 
        cui nomi sono: <b>PulsanteChiudi</b>, <b>PulsanteCreaDefinizione</b>, 
        <b>PulsanteCaricaDefinizione</b>, <b>PulsanteAggiungiSezione</b>, <b>PulsanteEliminaSezione</b>. 
        A questi si aggiungono tre <i>CheckBox</i><img src="../images/controls/checkbox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>RigaFissaCheck</b>, <b>LunghezzaFissaCheck</b> e <b>AllineaSinistraCheck</b>.<br>
        Completano l'interfaccia una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
        nome <b>FillerLabel</b> ed una <i>TextBox</i><img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>FillerText</b> con la propriet&agrave; MaxLength impostata a 1.</p>
      <p>In sostanza, tramite questo form sar&agrave; possibile analizzare il 
        tracciato e definire le posizioni in cui andranno inseriti i dati estratti 
        dal file Excel. Una volta terminata la definizione sar&agrave; possibile 
        salvarla in un file FDF. Inoltre sar&agrave; possibile caricare files 
        FDF salvati in precedenza.</p>
      <p>L'analisi del tracciato si effettua separando in sezioni le parti che 
        devono subire un trattamento particolare, quale la sostituzione con un 
        campo del database.<br>
        La <i>RichTextBox</i><img src="../images/controls/richtextbox.gif" width="25" height="25" align="absmiddle"><b>FileTracciato</b> 
        servir&agrave; per selezionare parti del testo e dividerle in sezioni.</p>
      <p>Le sezioni saranno gestite tramite le funzioni della parte sinistra, 
        mentre la parte centrale &egrave; dedicata alla definizione delle singole 
        sezioni. </p>
      <p>Accennato il funzionamento del form <b>DefinitionForm</b>, possiamo tuffarci 
        nel complesso codice che ne regola il comportamento.</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li>Private SEZIONI As Collection</li>
        <li>Private TROVAPOSIZIONE As Boolean</li>
        <li></li>
      </ol>
      <p>Abbiamo definito due variabili globali all'interno del form. La prima 
        &egrave; una <a href="../glossary/c.htm#COLLECTION"><i>Collection</i></a> 
        di nome <b>SEZIONI</b> che conterr&agrave; tutte le sezioni convertite 
        in stringa tramite la funzione <i><b>Sezione2Riga</b></i>. La seconda 
        variabile &egrave; <b>TROVAPOSIZIONE</b>, di tipo booleano e servir&agrave; 
        per inibire l'esecuzione di certi eventi nel momento in cui cambieremo 
        alcuni stati.</p>
      <ol class="codicevb" start="5">
        <li>Public Sub MostraSezioni()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.Clear</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;For CONTA = 1 To SEZIONI.Count</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Riga2Sezione SEZIONI.Item(CONTA), 
          TMPSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.AddItem 
          &quot;Da &quot; &amp; TMPSEZIONE.INIZIO &amp; &quot; A &quot; &amp; 
          TMPSEZIONE.FINE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Next CONTA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.ListIndex = SEZIONI.Count - 1</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Prima di addentrarci nel form vediamo la Sub <b>MostraSezioni</b>. La 
        sua esecuzione comporta l'azzeramento della <i>ListBox</i><img src="../images/controls/listbox.gif" width="25" height="25" align="absmiddle"><b>ListaSezioni</b> 
        (riga 8) ed il successivo riempimento tramite lettura della <i>Collection</i> 
        SEZIONI.</p>
      <ol class="codicevb" start="16">
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set SEZIONI = New Collection</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaCampi.AddItem &quot;(nessuno)&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;For CONTA = 0 To FOGLIOXLS.Fields.Count - 
          1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListaCampi.AddItem 
          FOGLIOXLS.Fields(CONTA).Name</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Next CONTA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaCampi.ListIndex = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PulsanteAggiungiSezione.Enabled = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PulsanteEliminaSezione.Enabled = False</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Al caricamento del form vengono inseriti nella <i>ListBox</i> <b>ListaCampi</b> 
        i nomi dei campi del foglio di Excel (riga 21) e la selezione del primo 
        elemento (riga 23).</p>
      <ol class="codicevb" start="28">
        <li>Private Sub PulsanteAggiungiSezione_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li></li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If FileTracciato.SelLength &gt; 0 Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.INIZIO 
          = FileTracciato.SelStart</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.FINE = 
          TMPSEZIONE.INIZIO + FileTracciato.SelLength - 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.CAMPO = 
          ListaCampi.ListIndex</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.RIGAFISSA 
          = RigaFissaCheck.Value</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.LUNGHEZZAFISSA 
          = LunghezzaFissaCheck.Value</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.ALLINEAMENTO 
          = AllineaSinistraCheck.Value</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TMPSEZIONE.FILLER 
          = FillerText.Text</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If ListaSezioni.ListIndex 
          &gt;= 0 Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEZIONI.Add 
          Sezione2Riga(TMPSEZIONE), , , ListaSezioni.ListIndex + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEZIONI.Add 
          Sezione2Riga(TMPSEZIONE)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelColor 
          = RGB(255, 0, 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MostraSezioni</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SetFocus</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Il click sul pulsante <b>PulsanteAggiungiSezione</b> comporta la creazione 
        di una nuova sezione, i cui valori sono determinati dallo stato di alcuni 
        elementi dell'interfaccia. Per creare una sezione &egrave; necessario 
        selezionare del testo (almeno un carattere - riga 31) e premere questo 
        pulsante. Verranno memorizzate le coordinate iniziali e finali della selezione 
        (righe 32 e 33), il campo associato del foglio (riga 34), ed altri parametri 
        definiti dai controlli posti nella parte centrale dell'interfaccia (righe 
        35-38).</p>
      <p>Tale sezione verr&agrave; inserita subito dopo la sezione selezionata 
        al momento nella <i>ListBox</i> <b>ListaSezioni</b> (riga 40) o all'inizio 
        della Collection SEZIONI (riga 42).<br>
        Una volta creata la sezione il testo selezionato diverr&agrave; rosso 
        (riga 44) al fine di poterlo distinguere dalle parti non selezionate.</p>
      <p>Fin qui abbiamo inserito la nuova sezione nella Collection; la riga 46 
        provveder&agrave; a mostrare i dati della Collection nella ListBox <b>ListaSezioni</b> 
        e poi riportare il focus sulla <i>RichTextBox</i> <b>FileTracciato</b> 
        (riga 47).<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p align="center"><a href="act_11_4.htm">Segue parte 4 &gt;&gt;</a></p>
      <!-- #EndEditable --><!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        27 Gennaio 2001</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'introduzione delle Richieste dei lettori</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
