<html><!-- #BeginTemplate "/Templates/Richieste.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Invio dati ad un'applicazione esterna</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Invio dati ad un'applicazione 
    esterna<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/activity.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Richiesta di: <!-- #BeginEditable "RICHIEDENTE" -->LoneFlier<!-- #EndEditable --> 
        - <!-- #BeginEditable "DATARICHIESTA" -->2 Settembre 2002<!-- #EndEditable --><br>
        Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5 </p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" -->
      <p><i>Ho scritto un programma in VB [...] non riesco per&ograve; a fare 
        in modo che, dopo essere ridotto ad icona, mi invii i dati all'applicazione 
        attiva, che non dovrebbe essere definita dal programma.</i></p>
      <hr>
      <p align="center"><a href="act_23.htm">&lt;&lt; Prima Parte</a></p>
      <p align="center"></p>
      <p align="center"></p>
      <p align="center"></p>
      <p align="center"></p>
      <p>Nella prima parte di quest'articolo abbiamo presentato una lunga e complessa 
        soluzione in cui il 90% delle spiegazioni erano incentrate sul recupero 
        della finestra che dovr&agrave; ricevere i dati da inviare. In questa 
        seconda parte invece sar&agrave; proposta una soluzione molto pi&ugrave; 
        semplice, compatta e probabilmente migliore.</p>
      <p>La soluzione si basa fondamentalmente nell'uso di un controllo <a href="../userctls/usrctl_08.htm">FBI 
        Select Window</a><img src="../images/controls/fbi%20select%20window.gif" width="25" height="25" align="absmiddle">al 
        quale saranno delegate tutte le operazioni di ricerca della finestra di 
        destinazione. Baster&agrave; un semplice click ed un trascinamento per 
        decidere dove inviare i dati.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/activity/att23_04.png" width="244" height="44" align="right" alt="Figura 1">L'interfaccia 
        del nostro progetto cambier&agrave; davvero di poco: sar&agrave; aggiunto 
        un controllo <i>FBI Select Window</i> e verr&agrave; lasciato il nome 
        standard <i><b>FBISelectWindow1</b></i>.<br>
        Anche il codice sar&agrave; molto simile al precedente ma semplicemente 
        pi&ugrave; snello:</p>
      <ol start="1" class="codicevb">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Declare Sub Sleep Lib &quot;kernel32&quot; (ByVal dwMilliseconds 
          As Long)</li>
        <li>Private Declare Function SendMessage Lib &quot;user32&quot; Alias 
          &quot;SendMessageA&quot; (ByVal hWnd As Long, ByVal wMsg As Long, ByVal 
          wParam As Long, lParam As Any) As Long</li>
        <li></li>
        <li>Private Const WM_CHAR = &amp;H102</li>
        <li>Private Const WM_SETTEXT = &amp;HC</li>
        <li>Private Const EM_SETSEL = &amp;HB1</li>
        <li></li>
      </ol>
      <p>Tutte le funzioni di intercettazione della finestra attiva sono state 
        rimosse e sono rimaste solo le due funzioni fondamentali: <b>SendMessage</b> 
        per inviare un <a href="../glossary/m.htm#MESSAGGIO">messaggio</a> alla 
        <a href="../glossary/w.htm#WINDOWPROCEDURE">Window Procedure</a> di una 
        finestra e <b>Sleep</b> per <a href="../howto/ht_034.htm">effettuare una 
        pausa</a>. I messaggi da inviare sono sempre gli stessi: <i><b>WM_CHAR</b></i>, 
        <i><b>WM_SETTEXT</b></i> e <i><b>EM_SETSEL</b></i> per una cui spiegazione 
        si rimanda alla Prima Parte dell'articolo.</p>
      <ol start="10" class="codicevb">
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call Shell(&quot;NOTEPAD.EXE&quot;, vbNormalNoFocus)</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Anche la routine all'avvio del Form &egrave; rimasta pressocch&eacute; 
        identica. Sar&agrave; infatti caricato il Blocco Note di Windows e messo 
        in secondo piano.</p>
      <ol start="14" class="codicevb">
        <li>Private Sub cmdInvia_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim lnghWnd As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim intConta As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim bytBuffer() As Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Const lngTypeDelay = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lnghWnd = FBISelectWindow1.LastWindow</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;bytBuffer = StrConv(txtBla.Text &amp; vbCrLf 
          &amp; vbNullChar, vbFromUnicode)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call SendMessage(lnghWnd, WM_SETTEXT, ByVal 
          0&amp;, bytBuffer(0))</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call SendMessage(lnghWnd, EM_SETSEL, UBound(bytBuffer, 
          1), 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;For intConta = 0 To UBound(bytBuffer, 1) - 
          2</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call SendMessage(lnghWnd, 
          WM_CHAR, bytBuffer(intConta), ByVal 0&amp;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If lngTypeDelay &gt; 
          0 Then Call Sleep(lngTypeDelay)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Next intConta</li>
        <li>End Sub</li>
      </ol>
      <p>La routine che gestisce il click del pulsante <i><b>cmdInvia</b></i> 
        &egrave; diventata un attimo pi&ugrave; semplice e snella: le uniche variabili 
        rimaste sono quelle che indicano l'<a href="../glossary/h.htm#HANDLE">handle</a> 
        della finestra client a cui inviare i dati, la variabile utilizzata per 
        il ciclo e la <a href="../glossary/m.htm#MATRICE">matrice</a> di bytes 
        che servir&agrave; come <a href="../glossary/b.htm#BUFFER">buffer</a> 
        dei dati da inviare.</p>
      <p>Alla riga 19 &egrave; recuperato l'handle dell'ultima finestra selezionata 
        dall'utente; alla riga successiva la stringa della casella di testo &egrave; 
        convertita in matrice di bytes con le <a href="../news/news_10.htm">convenzioni 
        delle stringhe API</a> (cio&egrave; aggiungendo il carattere <a href="../glossary/n.htm#NULL">NULL</a> 
        alla fine).</p>
      <p>In maniera identica all'articolo precedente, sar&agrave; adesso possibile 
        inviare i dati alla finestra client di destinazione. L'invio anche in 
        questo caso &egrave; effettuato in due maniere: sostituendo il testo precedente 
        (messaggio <i><b>WM_SETTEXT</b></i>) oppure inviando un carattere per 
        volta (messaggio <i> <b>WM_CHAR</b></i>). Per una spiegazione pi&ugrave; 
        accurata si rimanda alla prima parte dell'articolo. <img src="../images/icons/smile%20wink.gif" width="15" height="15" border="0" align="absmiddle"></p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>La dimostrazione dell'applicazione &egrave; altrettanto semplice: avviato 
        il progetto, sar&agrave; compito dell'utente trascinare il mirino sopra 
        la finestra dentro la quale si desidera che vengano inviati i dati. Se 
        la propriet&agrave; <b>InvertOnSelect</b> del controllo FBI Select Window 
        &egrave; impostata su True, la selezione della finestra puntata &egrave; 
        evidenziata dall'inversione dei colori.</p>
      <p>Unico requisito per l'utente: la cura nel puntare la finestra <a href="../glossary/c.htm#CHILD">Child</a> 
        e non quella <a href="../glossary/p.htm#PARENT">Parent</a> dell'applicazione. 
        La differenza tra le due finestre &egrave; mostrata nelle Figura 2 e 3.</p>
      <table width="95%" border="0" cellspacing="0" cellpadding="0" align="center">
        <tr> 
          <td align="center" valign="top"><img src="../images/activity/att23_05.png" width="206" height="124" alt="Figura 2"><br>
            <b>Figura 2</b><br>
            (Scelta la finestra Parent)</td>
          <td valign="top" align="center"><img src="../images/activity/att23_06.png" width="206" height="124" alt="Figura 3"><br>
            <b>Figura 3</b><br>
            (Scelta la finestra Child)</td>
        </tr>
      </table>
      <p>La Figura 2 mostra la selezione della finestra Parent, ad esempio posando 
        il mirino sulla barra del titolo oppure sulla barra dei menu. L'utilizzo 
        di questa finestra invierebbe il testo sulla barra del titolo dell'applicazione 
        Blocco Note, al posto di <i><b>&quot;Senza nome - Blocco note&quot;</b></i>.</p>
      <p>La Figura 3 mostra invece la maniera d'uso corretta per questo esempio: 
        &egrave; stata scelta la finestra Child, la grande casella di testo (che 
        nella figura appare per&ograve; nera). L'invio dei dati a quella finestra 
        produrr&agrave; l'effetto voluto, cio&egrave; quello di scrivere del testo 
        all'interno dell'applicazione Blocco Note.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Questa soluzione presenta numerosi indiscussi vantaggi: il primo riguarda 
        la semplicit&agrave; d'uso, non obbligando l'utente ad un movimento rapido 
        e preciso per la selezione della finestra.</p>
      <p>Inoltre, una volta scelta la finestra, fino a quando questa non verr&agrave; 
        chiusa, la selezione &egrave; valida. L'utente pu&ograve; in ogni momento 
        cambiare finestra attiva, spostarla, ridurla ad icona e quant'altro, senza 
        alcuna fretta ed il programma continuer&agrave; a puntare la finestra 
        corretta scelta in precedenza. E se l'utente dovesse ripensarci, ha tutto 
        il tempo di scegliere una nuova finestra.</p>
      <p>Il controllo FBI Select Window per questo genere di operazioni semplifica 
        notevolmente le incombenze del programmatore. In questa maniera per&ograve; 
        &egrave; obbligatorio un intervento dell'utente, per selezionare la finestra 
        che si intende utilizzare.</p>
      <p>In un progetto pi&ugrave; serio e complesso che utilizza una tecnica 
        del genere si raccomanda qualche informazione in pi&ugrave; per l'utente 
        circa la finesta puntata, quale l'handle, la classe, il <a href="../glossary/p.htm#PROCESSO">processo</a> 
        di appartenenza o la sua Caption. Questo informer&agrave; l'utente che 
        la sua selezione &egrave; corretta non solo visivamente ma anche a livello 
        di sistema. Si raccomanda la visione del progetto sviluppato nell'<a href="../userctls/usrctl_08.htm">articolo 
        dedicato al controllo FBI Select Window</a>.</p>
      <!-- #EndEditable --><!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        14 Ottobre 2002</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'introduzione delle Richieste dei lettori</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
