<html><!-- #BeginTemplate "/Templates/Richieste.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Generare dei files in base ad un particolare tracciato (quarta parte)</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Generare dei files in base 
    ad un particolare tracciato<br>
    (quarta&nbsp;parte)<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/activity.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Richiesta di: <!-- #BeginEditable "RICHIEDENTE" -->Roberto 
        Corona<!-- #EndEditable --> 
        - <!-- #BeginEditable "DATARICHIESTA" -->12 
        Gennaio 2001<!-- #EndEditable --><br>
        Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level4.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level5.gif" width="17" height="18" align="absmiddle"> 
        5<!-- #EndEditable --> / 5 </p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p><i>Ho bisogno di scrivere un programmino che, dopo aver analizzato dei 
        files contenenti dei particolari tracciati, estragga dei dati da un foglio 
        di Excel e tramite questi generi dei files di testo con una particolare 
        struttura determinata dal file del tracciato.</i></p>
      <hr>
      <p align="center"><a href="act_11_3.htm">&lt;&lt; Continua dalla parte 3</a></p>
      <ol class="codicevb" start="50">
        <li>Private Sub ListaSezioni_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If ListaSezioni.ListIndex &lt; 0 Then Exit 
          Sub</li>
        <li></li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Riga2Sezione SEZIONI.Item(ListaSezioni.ListIndex 
          + 1), TMPSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelStart = TMPSEZIONE.INIZIO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelLength = TMPSEZIONE.FINE 
          - TMPSEZIONE.INIZIO + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaCampi.ListIndex = Val(TMPSEZIONE.CAMPO)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;RigaFissaCheck.Value = TMPSEZIONE.RIGAFISSA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;LunghezzaFissaCheck.Value = TMPSEZIONE.LUNGHEZZAFISSA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;AllineaSinistraCheck.Value = TMPSEZIONE.ALLINEAMENTO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FillerText.Text = TMPSEZIONE.FILLER</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Nel momento in cui l'utente clicca sul nome di una sezione dalla <i>ListBox</i> 
        <b>ListaSezioni</b> saranno mostrati i dati che tale sezione contiene.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Il click sopra un elemento estrarr&agrave; la sezione corrispondente 
        dalla <i>Collection</i> <b>SEZIONI</b> (riga 54). Da tale sezione saranno 
        letti, uno per uno, i valori al fine di impostare i controlli dell'interfaccia 
        in modo da farli corrispondere con i dati della sezione (righe 55-61).</p>
      <ol class="codicevb" start="64">
        <li>Private Sub PulsanteEliminaSezione_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If ListaSezioni.ListIndex &lt; 0 Then Exit 
          Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni_Click</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelColor = RGB(0, 0, 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SEZIONI.Remove ListaSezioni.ListIndex + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MostraSezioni</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.ListIndex = SEZIONI.Count - 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelLength = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SetFocus</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Non avrebbe molto senso dare all'utente la possibilit&agrave; di inserire 
        nuove sezioni ma non poterle eliminare dalla <i>Collection</i> delle sezioni.</p>
      <p>Cos&igrave;, nel momento del click sul pulsante <b>PulsanteEliminaSezione</b> 
        viene, innanzitutto, ricliccata la sezione dalla ListBox ListaSezioni 
        (riga 68), in modo da ottenere la sezione evidenziata sulla <i>RichTextBox</i> 
        <b>FileTracciato</b>. Ottenuto questo sar&agrave; ripristinato il colore 
        nero originario (riga 69), sar&agrave; eliminata la sezione dalla Collection 
        (riga 70) e saranno nuovamente mostrate le sezioni tramite la Sub MostraSezioni 
        (riga 71).</p>
      <ol class="codicevb" start="77">
        <li>Private Sub FileTracciato_SelChange()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTROLLA As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim INIZIADA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim FINEA As Integer</li>
      </ol>
      <p>Quella che vediamo &egrave; la parte pi&ugrave; difficile e delicata 
        del progetto. Nel momento in cui viene spostato il cursore del testo sopra 
        la <i>RichTextBox<img src="../images/controls/richtextbox.gif" width="25" height="25" align="absmiddle"></i><b>FileTracciato</b> 
        o viene effettuata una selezione del testo tramite mouse o tastiera, scatta 
        l'<a href="../glossary/e.htm#EVENTO">evento</a> <i>SelChange</i>.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Una particolare cura deve essere data a questa routine poich&eacute; 
        il posizionamento del cursore attraverso d'essa pu&ograve; richiamare 
        nuovamente questa routine, generando un ciclo continuo fino all'esaurimento 
        dell'area di <a href="../glossary/s.htm#STACK">stack</a>.</p>
      <p>Il controllo della posizione si basa su due parametri: la coordinata 
        del cursore ed il colore del testo selezionato. Infatti, un testo gi&agrave; 
        colorato in rosso indica che il cursore si trova all'interno di una sezione 
        o il testo selezionato &egrave; intersecato con una sezione.</p>
      <ol class="codicevb" start="83">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;CONTROLLA = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PulsanteAggiungiSezione.Enabled = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PulsanteEliminaSezione.Enabled = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If FileTracciato.SelColor = 0 Then CONTROLLA 
          = False</li>
      </ol>
      <p>A questo scopo utilizzeremo una variabile di nome CONTROLLA, che inizialmente 
        sar&agrave; impostata a True. Nel momento in cui viene controllato il 
        colore del testo selezionato, se esso &egrave; nero la variabile sar&agrave; 
        impostata a False (riga 86).</p>
      <p>Cosa fa esattamente questa variabile?<br>
        Se il testo selezionato &egrave; <b>tutto</b> nero, sappiamo con certezza 
        che a quelle non ci sono sezioni; se il testo selezionato, in qualche 
        parte &egrave; rosso, ci troviamo nelle vicinanze di una sezione.</p>
      <ol class="codicevb" start="87">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If (CONTROLLA = True) And (TROVAPOSIZIONE 
          = False) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INIZIADA = FileTracciato.SelStart</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FINEA = INIZIADA + 
          FileTracciato.SelLength</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For CONTA = 1 To SEZIONI.Count</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Riga2Sezione 
          SEZIONI.Item(CONTA), TMPSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          (INIZIADA &gt;= TMPSEZIONE.INIZIO) And (INIZIADA &lt;= TMPSEZIONE.FINE) 
          Then Exit For</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          (FINEA &gt;= TMPSEZIONE.INIZIO) And (FINEA &lt;= TMPSEZIONE.FINE) Then 
          Exit For</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          (TMPSEZIONE.INIZIO &lt;= FINEA) And (TMPSEZIONE.INIZIO &gt;= INIZIADA) 
          Then Exit For</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next CONTA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If CONTA &gt; SEZIONI.Count 
          Then Exit Sub</li>
      </ol>
      <p>Alla riga 87 viene verificato se la variabile <b>CONTROLLA</b> &egrave; 
        True (ovvero il cursore si trova all'interno di una sezione oppure il 
        testo selezionato copre una sezione. Altres&igrave; viene controllato 
        che la variabile <b>TROVAPOSIZIONE</b> sia False (ovvero il cursore &egrave; 
        stato spostato dall'utente e non dal codice).</p>
      <p>Quando questa situazione si verifica sar&agrave; necessario controllare 
        tutte le sezioni per vedere quale sezione si trova a quelle coordinate.</p>
      <p>Saranno memorizzate le coordinate iniziali e finali della selezione nelle 
        variabili INIZIADA e FINEA (righe 88 e 89). Dopodich&eacute; inizier&agrave; 
        la scansione di tutte le sezioni mediante l'estrazione di una sezione 
        per volta dall'array SEZIONI (riga 91).</p>
      <p>Se la selezione &egrave; all'interno della sezione analizzata (riga 92) 
        oppure la parte finale della selezione si trova all'interno della sezione 
        (riga 93), oppure la parte iniziale delle selezione si trova all'interno 
        del testo selezionato (riga 94), viene interrotto il ciclo di scansione 
        delle sezioni.</p>
      <p>L'interruzione del ciclo fa s&igrave; che la variabile CONTA contenga 
        l'indice della sezione che si interseca con il testo selezionato. Se il 
        ciclo non &egrave; stato interrotto, alla sua uscita, la variabile CONTA 
        avr&agrave; un valore superiore al numero complessivo di sezioni. In quest'ultimo 
        caso non &egrave; stata trovata la sezione corrispondente e la routine 
        termina qui, senza evidenziare alcuna sezione.</p>
      <ol class="codicevb" start="97">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TROVAPOSIZIONE = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelStart 
          = TMPSEZIONE.INIZIO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelLength 
          = TMPSEZIONE.FINE - TMPSEZIONE.INIZIO + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListaCampi.ListIndex 
          = Val(TMPSEZIONE.CAMPO)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RigaFissaCheck.Value 
          = TMPSEZIONE.RIGAFISSA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LunghezzaFissaCheck.Value 
          = TMPSEZIONE.LUNGHEZZAFISSA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AllineaSinistraCheck.Value 
          = TMPSEZIONE.ALLINEAMENTO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FillerText.Text = 
          TMPSEZIONE.FILLER</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.ListIndex 
          = CONTA - 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TROVAPOSIZIONE = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PulsanteAggiungiSezione.Enabled 
          = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PulsanteEliminaSezione.Enabled 
          = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Il raggiungimento della riga 97 presuppone che sia stata trovata la sezione 
        intersecata con il testo selezionato.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>A tale scopo possiamo effettuare la lettura dei parametri della sezione 
        <b>TMPSEZIONE</b>. Poich&eacute; ci occorrer&agrave; spostare il cursore 
        per mostrare all'utente la posizione e l'ampiezza della sezione, impostiamo 
        la variabile <b>TROVAPOSIZIONE</b> a True e alla riga successiva spostiamo 
        il cursore all'inizio della sezione ed impostiamo la selezione fino alla 
        fine della sezione. Questo fa s&igrave; che scatti nuovamente l'evento 
        SelChange.</p>
      <p>Se non avessimo impostato la variabile globale <b>TROVAPOSIZIONE</b> 
        a True, si sarebbe innescato un circolo vizioso che richiama continuamente 
        questo evento per posizionare il cursore, fino a generare un errore di 
        stack esaurito.<br>
        Questo problema di <a href="../glossary/r.htm#RICORSIVO">ricorsivit&agrave;</a> 
        viene risolto dalla variabile <b>TROVAPOSIZIONE</b>; infatti alla riga 
        87, prima di effettuare l'operazione di ricerca (e riposizionamento) devono 
        essere validate due condizioni: il colore lo stato di <b>TROVAPOSIZONE</b>. 
        L'impostazione della variabile al valore True fa s&igrave; che non venga 
        richiamato l'evento SelChange due o pi&ugrave; volte.</p>
      <p>Evidenziata la sezione sar&agrave; possibile visualizzare anche tutte 
        le altre propriet&agrave; della sezione (righe 98-105), prima di ripristinare 
        lo stato di <b>TROVAPOSIZIONE</b> a False.</p>
      <ol class="codicevb" start="112">
        <li>Private Sub PulsanteCreaDefinizione_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim NOMEFILE As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim FILEOK As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim FILENR As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CONTA As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;On Error Resume Next</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;While FILEOK = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err.Clear</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILEOK = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOMEFILE = InputBox(&quot;Inserisci 
          il nome del file in cui salvare&quot;, &quot;Salva definizione&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If NOMEFILE = &quot;&quot; 
          Then Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If FileEsiste(NOMEFILE) 
          = False Then FILEOK = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If FILEOK = True Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILENR 
          = FreeFile</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Open 
          NOMEFILE For Output As FILENR</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          Err.Number &lt;&gt; 0 Then FILEOK = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Wend</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Write #FILENR, &quot;Fibia Data Stripper&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;For CONTA = 1 To SEZIONI.Count</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write #FILENR, SEZIONI.Item(CONTA)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Next CONTA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Close FILENR</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Salvataggio effettuato!&quot;, 
          vbInformation + vbOKOnly, &quot;Crea definizione&quot;</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Il click sopra il pulsante CreaDefinizione effettua il salvataggio della 
        definizione in un file FDF. Alla riga 121 viene richiesto il nome del 
        file in cui salvare; di tale fiile sar&agrave; controllata l'esistenza. 
        Se l'utente ha premuto il tasto Annulla la routine terminer&agrave; (riga 
        122). Nel caso che il file inserito non esistesse sar&agrave; possibile 
        salvare poich&eacute; la variabile <b>FILEOK</b> conterr&agrave; il valore 
        True. Appurato che il file non esiste, verr&agrave; tentata la creazione 
        (riga 126); nel caso che il disco sia protetto o pieno, si generer&agrave; 
        un errore che verr&agrave; intercettato dalla riga successiva (riga 127) 
        la quale imposter&agrave; il valore di <b>FILEOK</b> a False.</p>
      <p>Il ciclo While (righe 118-129) durer&agrave; fintanto che FILEOK non 
        conterr&agrave; il valore True, ovvero il file non esiste e la scrittura 
        sul disco &egrave; permessa.</p>
      <p>Alla riga 130 viene scritta l'intestazione <i><b>&quot;Fibia Data Stripper&quot;</b></i> 
        che contraddistinguer&agrave; i files FDF.<br>
        Solo adesso sar&agrave; possibile scrivere le sezioni all'interno del 
        file per il salvataggio&quot;.</p>
      <ol class="codicevb" start="138">
        <li>Private Sub PulsanteCaricaDefinizione_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim FILENR As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim BUFFER As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TMPSEZIONE As TIPOSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;BUFFER = InputBox(&quot;Seleziona il nome 
          della definizione da caricare&quot;, &quot;Carica definizione&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If FileEsiste(BUFFER) = False Then Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FILENR = FreeFile</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Open BUFFER For Input As FILENR</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Input #FILENR, BUFFER</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If UCase(Left(BUFFER, 19)) &lt;&gt; &quot;FIBIA 
          DATA STRIPPER&quot; Then Exit Sub</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Me.Enabled = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;While SEZIONI.Count &gt; 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEZIONI.Remove 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Wend</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaSezioni.Clear</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;TROVAPOSIZIONE = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelStart = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelLength = Len(FileTracciato.Text) 
          + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelColor = RGB(0, 0, 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;While Not EOF(FILENR)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Input #FILENR, BUFFER</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEZIONI.Add BUFFER</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Riga2Sezione BUFFER, 
          TMPSEZIONE</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelStart 
          = TMPSEZIONE.INIZIO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelLength 
          = TMPSEZIONE.FINE - TMPSEZIONE.INIZIO + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileTracciato.SelColor 
          = RGB(255, 0, 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Wend</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;TROVAPOSIZIONE = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Close FILENR</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Me.Enabled = True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MostraSezioni</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Il click sopra il pulsante <b>CaricaDefinizione</b> richiede l'inserimento 
        del nome del file FDF da caricare (riga 142). Ovviamente tale file deve 
        necessariamente esistere. Se esso non esiste la routine terminer&agrave; 
        qui. </p>
      <p>Avendo la sicurezza che tale file esiste possiamo leggere l'intestazione 
        del file per verificare che esso sia un file valido (riga 146). Un'intestazione 
        valida fa s&igrave; che la funzione termini qui.</p>
      <p>Il file richiesto &egrave; valido! &Egrave; possibile caricarlo, ma prima 
        sar&agrave; necessario svuotare la <i>Collection</i> <b>SEZIONI</b> e 
        la <i>ListBox</i><img src="../images/controls/listbox.gif" width="25" height="25" align="absmiddle"><b>ListaSezioni</b> 
        (righe 149-152) per riempirle nuovamente. Ma prima di riempirle nuovamente 
        togliamo tutte le parti in rosso del testo (righe 153-156) tenendo la 
        variabile di blocco <b>TROVAPOSIZIONE</b> impostata a True.</p>
      <p>Alle righe 157-164 vengono lette le sezioni dal file FDF, sono scritte 
        nella <i>Collection</i> <b>SEZIONI</b> e man mano viene colorato il testo 
        in rosso dove abbiamo una sezione.</p>
      <p>Prima di uscire dalla routine ripristiniamo lo stato normale del form 
        reimpostando la variabile <b>TROVAPOSIZIONE</b> a False e ridisegnando 
        le sezioni mediante la Sub <i><b>MostraSezioni</b></i>.</p>
      <ol class="codicevb" start="171">
        <li>Private Sub PulsanteChiudi_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set SEZIONI = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Me.Hide</li>
        <li>End Sub</li>
      </ol>
      <p>Lo studio del form si conclude con il pulsante <b>PulsanteChiudi</b> 
        che azzera la Collection SEZIONI e nasconde il form, ritornando il controllo 
        al form chiamante (<i>MainForm</i>).<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p align="center"><a href="act_11_5.htm">Segue parte 5 &gt;&gt;</a></p>
      <!-- #EndEditable --><!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        27 Gennaio 2001</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'introduzione delle Richieste dei lettori</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
