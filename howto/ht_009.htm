<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Visualizza la finestra di dialogo per la selezione di una cartella</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Visualizza la finestra di 
    dialogo per la selezione di una cartella<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Insieme alla versione Professional di Visual Basic &egrave; fornito il 
        controllo Microsoft Common Dialog, utile per la selezione di un file da 
        aprire o salvare. Ma non esiste un modo per selezionare una cartella tramite 
        queste finestre.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/howto/howto009_02.jpg" width="259" height="265" align="right" alt="Figura 1">Esiste 
        a questo scopo una finestra di dialogo all'interno della DLL <i>Shell32</i>. 
        Il suo nome &egrave; <b><i>BrowseForFolder</i></b>. In questo HowTo vedremo 
        come richiamare questa funzione mediante l'<a href="../glossary/a.htm#API">API</a>.</p>
      <p>Per il nostro scopo creeremo una funzione che ritorna il percorso, ma 
        prima &egrave; necessario scrivere alcune dichiarazioni API all'interno 
        del nostro form oppure in un modulo standard <img src="../images/ide/modulo.gif" width="16" height="16" align="absmiddle"></p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Type BROWSEINFO</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;hOwner As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;pidlRoot As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;pszDisplayName As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lpszTitle As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ulFlags As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lpfn As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lParam As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;iImage As Long</li>
        <li>End Type</li>
        <li></li>
        <li>Private Const BIF_RETURNONLYFSDIRS = &amp;H1</li>
        <li>Private Declare Function SHBrowseForFolder Lib &quot;shell32.dll&quot; 
          Alias &quot;SHBrowseForFolderA&quot; (lpBrowseInfo As BROWSEINFO) As 
          Long&nbsp;&nbsp;&nbsp;&nbsp;</li>
        <li>Private Declare Function SHGetPathFromIDList Lib &quot;shell32.dll&quot; 
          Alias &quot;SHGetPathFromIDListA&quot; (ByVal pidl As Long, ByVal pszPath 
          As String) As Long</li>
        <li>Private Declare Sub CoTaskMemFree Lib &quot;ole32.dll&quot; (ByVal 
          pv As Long)</li>
      </ol>
      <p>Le righe dal 3 al 12 definiscono un nuovo tipo di nome <b>BROWSEINFO</b>. 
        Tale struttura &egrave; richiesta dalla funzione API.</p>
      <p> La riga 14 presenta una <a href="../glossary/c.htm#COSTANTE">costante</a> 
        <img src="../images/ide/costante.gif" width="16" height="16" border="0" align="absmiddle"> 
        <b>BIF_RETURNONLYFSDIRS</b> che indica che vogliamo presentate soltanto 
        le cartelle. Ulteriori costanti che &egrave; possibile utilizzare in questa 
        funzione sono presenti nelle dichiarazioni API. Per rintracciarle bisogna 
        cercare tutte le costanti il cui nome inizia per <b><i>&quot;BIF_&quot;</i></b> 
        (BrowseInfo Flags).</p>
      <p>Alla riga 15 viene dichiarata la prima funzione API: <b>SHBrowseForFolders</b>. 
        Essa richiede che sia passata una variabile di tipo BROWSEINFO (definita 
        prima), mostra la finestra di dialogo per la scelta della cartella e, 
        nel momento in cui l'utente clicca il pulsante OK <a href="../glossary/a.htm#ALLOCARE">alloca</a> 
        in uno spazio apposito il nome della cartella selezionata.</p>
      <p>La seconda funzione API (riga 16) estrae il percorso della cartella selezionata 
        dall'area di memoria allocata.</p>
      <p>L'ultima funzione API (riga 17) <a href="../glossary/d.htm#DEALLOCARE">dealloca</a> 
        l'area di memoria bloccata dalla funzione SHBrowseForFolders.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Terminate le dichiarazioni passiamo alla scrittura di una funzione che 
        faccia tutto il lavoro mediante un semplice richiamo. La nostra funzione 
        prende il nome di <b><i>SfogliaCartelle</i></b>.</p>
      <ol class="codicevb" start="19">
        <li>Public Function SfogliaCartelle(ByVal Handle As Long) As String</li>
      </ol>
      <p>La funzione richiede l'<a href="../glossary/h.htm#HANDLE">handle</a> 
        del form dentro il quale apparir&agrave; la finestra di scelta della cartella 
        e restituisce una stringa in uscita.</p>
      <ol class="codicevb" start="20">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim BInfo As BROWSEINFO</li>
      </ol>
      <p>Come gi&agrave; accennato prima, la funzione <i>SHBrowseForFolders</i> 
        richiede che sia passata una variabile con la struttura BROWSEINFO. La 
        nostra variabile si chiamer&agrave; <b>BInfo</b>.</p>
      <ol class="codicevb" start="21">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim CartellaScelta As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim PercorsoAllocato As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim PercorsoScelto As String</li>
      </ol>
      <p>Dichiareremo anche una serie di altre variabili: <b>CartellaScelta</b> 
        indica che &egrave; stato possibile estrarre il percorso scelto dall'area 
        di memoria allocata. In caso di mancata estrazione - ovvero quando l'utente 
        preme il tasto <i>Annulla</i> della finestra di dialogo - essa avr&agrave; 
        il valore 0.<br>
        La variabile <b>PercorsoAllocato</b> conterr&agrave; l'indirizzo dell'area 
        di memoria allocata dalla funzione. Tale valore sar&agrave; in seguito 
        utilizzato per ricavare il percorso della cartella selezionata che verr&agrave; 
        memorizzato nella variabile <b>PercorsoScelto</b>.</p>
      <ol class="codicevb" start="24">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;BInfo.hOwner = Handle</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;BInfo.lpszTitle = &quot;Scegli una cartella:&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;BInfo.ulFlags = BIF_RETURNONLYFSDIRS</li>
      </ol>
      <p>La struttura BROWSEINFO ha tre elementi fondamentali: <i>hOwner</i> che 
        indica l'handle della finestra dentro la quale apparir&agrave; la nostra 
        finestra di dialogo. La nostra funzione <b>SfogliaCartelle</b> ci provvede 
        l'handle da assegnare a tale elemento (riga 24).<br>
        Altro elemento fondamentale &egrave; <i>lpszTitle</i> e indica il testo 
        che apparir&agrave; nella parte superiore della finestra di dialogo. L'ultimo 
        elemento &egrave; anche il pi&ugrave; importante: esso indica il tipo 
        di azione da eseguire con tale finestra: noi assegneremo il valore della 
        costante <b>BIF_RETURNONLYFSDIRS</b> dichiarata prima.</p>
      <ol class="codicevb" start="27">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PercorsoAllocato = SHBrowseForFolder(BInfo)</li>
      </ol>
      <p>Eseguiamo la chiamata alla funzione <i>SHBrowseForFolders</i> che mostrer&agrave; 
        la finestra di scelta della cartella. All'uscita della finestra, la variabile 
        <b>PercorsoAllocato</b> conterr&agrave; un <a href="../glossary/p.htm#PUNTATORE">puntatore</a> 
        all'area di memoria allocata dall'ultima funzione.</p>
      <ol class="codicevb" start="28">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;PercorsoScelto = Space$(512)</li>
      </ol>
      <p>Come per tutte le funzioni API che utilizzano stringhe, &egrave; necessario 
        prepare prima la variabile mediante l'istruzione <i>Space$</i>.</p>
      <ol class="codicevb" start="29">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;CartellaScelta = SHGetPathFromIDList(PercorsoAllocato, 
          PercorsoScelto)</li>
      </ol>
      <p>La funzione <b>SHGetPathFromIDList</b> estrae il percorso allocato dall'area 
        di memoria indicata da PercorsoAllocato e lo memorizza nella variabile 
        PercorsoScelto.<br>
        Se l'utente ha annullato la scelta, il tentativo di estrazione del percorso 
        ritorner&agrave; il valore 0.</p>
      <ol class="codicevb" start="30">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If CartellaScelta Then</li>
      </ol>
      <p>Quindi segue un controllo che si assicura che l'utente abbia scelto qualche 
        cartella. In caso negativo il programma salta alla riga 34.</p>
      <ol class="codicevb" start="31">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SfogliaCartelle = 
          Left$(PercorsoScelto, InStr(PercorsoScelto, Chr$(0)) - 1)</li>
      </ol>
      <p>Tutte le funzioni API restituiscono le variabili stringa con un terminatore 
        (codice ASCII 0) alla fine. Questa riga provvede a eliminare il terminatore 
        finale da <b>PercorsoScelto</b> e memorizza il rimanente nella variabile 
        <b>SfogliaCartelle</b> che sar&agrave; il valore ritornato all'uscita 
        della funzione.</p>
      <ol class="codicevb" start="32">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CoTaskMemFree PercorsoAllocato</li>
      </ol>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Fatto questo &egrave; necessario deallocare la memoria allocata.<br>
        La funzione <b>CoTaskMemFree</b> provvede a questo e richiede un puntatore.</p>
      <ol class="codicevb" start="33">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SfogliaCartelle = 
          &quot;&quot;</li>
      </ol>
      <p>L'utente ha annullato la selezione. Non sar&agrave; ritornata alcuna 
        cartella all'uscita.</p>
      <ol class="codicevb" start="35">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p><img src="../images/howto/howto009_01.jpg" width="254" height="65" align="right" alt="Figura 2">Terminata 
        la nostra funzione possiamo passare alla semplice interfaccia.<br>
        Inseriamo sopra il nostro form due controlli: un pulsante di comando di 
        nome <b>Sfoglia</b> ed una casella di testo di nome <b>Percorso</b>.</p>
      <p>Nel momento in cui l'utente clicca il pulsante Sfoglia viene richiamato 
        l'evento click:</p>
      <ol class="codicevb" start="38">
        <li>Private Sub Sfoglia_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Percorso.Text = SfogliaCartelle(Me.hWnd)</li>
        <li>End Sub</li>
      </ol>
      <p>Questa semplice routine scrive il percorso della cartella selezionata 
        all'interno della casella di testo di nome <b>Percorso</b>.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>&Egrave; terminata qui. Basta cliccare il pulsante Sfoglia per vedere 
        apparire la finestra di dialogo &quot;Sfoglia per Cartelle&quot;.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        4 Dicembre 2000<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
