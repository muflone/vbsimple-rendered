<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Ottenere il nome DOS di un file o directory</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Ottenere il nome DOS di 
    un file o directory<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>All'interno di Windows &egrave; possibile dare ai files dei nomi lunghi 
        fino a 255 caratteri, con estensione superiore ai tre caratteri. Tuttavia 
        i files continuano ad essere memorizzati come alias nel <a href="../info/info_07.htm">formato 
        canonico DOS</a>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>In taluni casi &egrave; necessario ottenere l'alias DOS del file, ad 
        esempio per utilizzarlo con un programma DOS esterno. Esiste una funzione 
        <a href="../glossary/a.htm#API">API</a> apposita a questo scopo: <i>GetShortPathName</i>.</p>
      <p><img src="../images/howto/howto013_01.jpg" width="199" height="82" align="right" alt="Figura 1">Svilupperemo 
        subito un semplice progettino: inseriamo all'interno di un form due TextBox 
        <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
        di nome <b>FileLungo</b> e <b>FileDOS</b>. Inseriamo anche un pulsante 
        di nome <b>Converti</b>.<br>
        Il click sopra il pulsante scriver&agrave; all'interno della casella <b>FileDOS</b> 
        il corrispondente nome DOS del file scritto nella casella <b>FileLungo</b>.</p>
      <p>All'interno della finestra del codice scriviamo:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li>Private Declare Function GetShortPathName Lib &quot;KERNEL32&quot; 
          Alias &quot;GetShortPathNameA&quot; (ByVal lpszLongPath As String, ByVal 
          lpszShortPath As String, ByVal cchBuffer As Long) As Long</li>
      </ol>
      <p>E subito vediamo la funzione API accennata prima: come molte altre funzioni 
        API che utilizzano le stringhe, ne <a href="../info/info_09.htm">esistono 
        due differenti versioni</a>: una progettata per <a href="../glossary/a.htm#ANSI">ANSI</a> 
        ed una per <a href="../glossary/u.htm#UNICODE">UNICODE</a>. Se utilizziamo 
        Windows95/98/ME useremo la prima, se invece utilizziamo WindowsNT dovremo 
        sfruttare quella progettata per stringhe UNICODE.<br>
        Questo corso &egrave; sviluppato intorno alla versione pi&ugrave; semplice 
        del sistema Windows, per cui faremo riferimento alla versione che tratta 
        stringhe ANSI.</p>
      <p>La nostra funzione API si chiamer&agrave; <i>GetShortPathName</i> e punter&agrave;, 
        mediante alias, alla funzione <i>GetShortPathNameA</i>. Essa richiede 
        tre parametri: il primo &egrave; la stringa contenente il percorso lungo, 
        il secondo &egrave; una stringa buffer dove verr&agrave; memorizzato il 
        corrispondente percorso DOS del file, mentre l'ultimo parametro &egrave; 
        un numero intero indicante la grandezza in bytes del buffer comprendente 
        anche il <a href="../glossary/n.htm#NULL">NULL</a> finale.</p>
      <ol class="codicevb" start="4">
        <li>Private Sub Converti_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim BufferDOS As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim LunghezzaDOS As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim LunghezzaBuffer As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;LunghezzaBuffer = Len(FileLungo.Text) + 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;BufferDOS = String(LunghezzaBuffer, 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;LunghezzaDOS = GetShortPathName(FileLungo.Text, 
          BufferDOS, LunghezzaBuffer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FileDOS.Text = Left$(BufferDOS, LunghezzaDOS)</li>
        <li>End Sub</li>
      </ol>
      <p>All'interno della routine che gestisce il click sopra il pulsante <b>Converti</b> 
        viene effettuata la conversione da nome lungo a nome corto (DOS).</p>
      <p>Abbiamo dichiarato una variabile di nome <b>BufferDOS</b> che verr&agrave; 
        utilizzata per memorizzare il nome DOS. Abbiamo anche altre due variabili 
        di tipo <i>Long</i> ed entrambe contengono la lunghezza di una stringhe: 
        la prima, <b>LunghezzaDOS</b>, indica la lunghezza in bytes della stringa 
        contenuta all'interno di <b>BufferDOS</b>; la seconda, <b>LunghezzaBuffer</b>, 
        indica la lunghezza del buffer contenente il nome lungo.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Alla riga 8 calcoliamo la lunghezza della stringa da convertire, ovvero 
        del nome di file lungo, mediante l'istruzione <i>Len</i>. Tale valore 
        verr&agrave; poi utilizzato per comunicare alla funzione API la dimensione 
        di <b>BufferDOS</b>. Poich&eacute; stiamo lavorando con stringhe, &egrave; 
        necessario calcolare anche il NULL finale della stringa. A tale scopo 
        aggiungiamo un byte all'ampiezza del buffer (<b>LunghezzaBuffer</b>) per 
        contenere il NULL finale.</p>
      <p>Alla riga 9 prepariamo il buffer di nome <b>BufferDOS</b> mediante l'utilizzo 
        dell'istruzione <i>String</i>. L'ampiezza del buffer &egrave; determinata 
        dalla variabile <b>LunghezzaBuffer</b> preparata prima.</p>
      <p>Alla riga 10 effettuiamo la chiamata alla funzione API fornendole come 
        parametri la stringa contenuta nella casella di testo <b>FileLungo</b>, 
        il buffer <b>BufferDOS</b> e la sua ampiezza <b>LunghezzaBuffer</b>.<br>
        In uscita la funzione <i>GetShortPathName</i> ci restituir&agrave; il 
        numero di caratteri di cui si compone il nome DOS e, <a href="../info/info_05.htm">per 
        riferimento</a>, memorizzer&agrave; all'interno della variabile <b>BufferDOS</b> 
        il percorso DOS.</p>
      <p>Adesso possiamo completare la nostra funzione scrivendo all'interno della 
        casella di testo <b>NomeDOS</b> il nome DOS del file, estraendo i primi 
        caratteri da <b>BufferDOS</b>. Il numero di caratteri da estrarre &egrave; 
        memorizzato all'interno di <b>LunghezzaDOS</b> poich&eacute; restituito 
        dalla chiamata alla funzione API <i>GetShortPathName</i>.</p>
      <p><img src="../images/howto/howto013_02.jpg" width="199" height="82" align="right" alt="Figura 2">Possiamo 
        provare il nostro progettino scrivendo all'interno della prima casella 
        il percorso della cartella Programmi (solitamente <b>C:\Programmi</b>) 
        e premendo il pulsante <i>Converti</i>, ottenendo il corrispondente nome 
        DOS (<b>C:\PROGRA~1</b>). <br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Conoscendo il corretto funzionamento e comportamento delle funzioni <a href="../glossary/a.htm#API">API</a> 
        questo genere di operazioni si effettua ad occhi chiusi, poich&eacute; 
        non richiede nessun accorgimento particolare, oltre a quelli indicati 
        nelle <a href="../info/info_09.htm">informazioni aggiuntive alle funzioni 
        API</a>.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        18 Dicembre 2000<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
