<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Spostare un controllo a runtime</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Spostare un controllo a 
    runtime<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Avete presente l'<a href="../glossary/i.htm#IDE">IDE</a> di Visual Basic?<br>
        In <a href="../glossary/f.htm#FASEDIPROGETTAZIONE">fase di progettazione</a> 
        si possono <i>&quot;prendere&quot;</i> dei controlli e trascinarli per 
        lo schermo.<br>
        Avete mai pensato di fare questo in <a href="../glossary/f.htm#FASEDIESECUZIONE">fase 
        di esecuzione</a>? Dare all'utente la possibilit&agrave; di scegliersi 
        la posizione dei controlli?</p>
      <p>La soluzione pi&ugrave; semplice ed anche migliore consiste nell'utilizzare 
        l'<a href="../glossary/a.htm#API">API</a> ed i messaggi delle finestre. 
        Per un discorso pi&ugrave; approfondito sui messaggi vedi la sezione informazioni 
        aggiuntive.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/howto/howto007_01.jpg" width="194" height="192" align="right" alt="Figura 1">Nel 
        nostro esempio inseriremo tre controlli (tanto per dare l'idea e provare 
        il nostro codice): una <b><i>DirListBox</i></b><img src="../images/controls/dirlistbox.gif" width="25" height="25" align="absmiddle"> 
        di nome Dir1, un <b><i>CommandButton</i></b> <img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle"> 
        di nome Command1 ed una <b><i>TextBox</i></b> <img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle"> 
        di nome Text1. Per il momento lasciamoli l&igrave;, inutilizzati.</p>
      <p>Per effettuare lo spostamento di questi controlli utilizzeremo due dichiarazioni 
        API: la <i>ReleaseCapture</i> e la <i>SendMessage</i>.<br>
        La prima serve per rilasciare il cursore del mouse; chiariamo questo concetto: 
        nel momento in cui l'utente clicca con il tasto sinistro del mouse sopra 
        un controllo, quell'oggetto diventa l'oggetto attivo. Questo fa s&igrave; 
        che tutti i messaggi inviati (il movimento del mouse, il click, il rilascio) 
        saranno diretti a tale oggetto.</p>
      <p>La funzione <i>ReleaseCapture</i> rilascia l'oggetto selezionato in modo 
        da redirigere i messaggi nella maniera pi&ugrave; idonea. Non &egrave; 
        necessario ripristinare l'oggetto attivo perch&eacute; di questo si occuperanno 
        tanti altri eventi.</p>
      <p>La funzione <i>SendMessage</i> serve per inviare un messaggio specifico 
        ad una determinata finestra. Nel nostro esempio invieremo il messaggio 
        che permette lo spostamento del controllo.</p>
      <p>Passiamo al nostro codice; innanzitutto dichiariamo le nostre funzioni 
        API: </p>
      <ol class="codicevb" start="1">
        <li>Private Declare Sub ReleaseCapture Lib &quot;USER32&quot; ()</li>
        <li>Private Declare Function SendMessage Lib &quot;USER32&quot; Alias 
          &quot;SendMessageA&quot; (ByVal hwnd As Long, ByVal wMsg As Long, ByVal 
          wParam As Long, lParam As Any) As Long</li>
      </ol>
      <p>Dichiariamo anche due <a href="../glossary/c.htm#COSTANTE">costanti</a> 
        <img src="../images/ide/costante.gif" width="16" height="16" border="0" align="absmiddle"> 
        utilizzate per definire il messaggio che permette lo spostamento di un 
        controllo:</p>
      <ol class="codicevb" start="3">
        <li>Private Const WM_NCLBUTTONDOWN = &amp;HA1</li>
        <li>Private Const SC_DLG_NO_UI = &amp;H2</li>
      </ol>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Per evitare di dover riscrivere ogni volta il codice di spostamento del 
        controllo abbiamo scritto le istruzioni di spostamento all'interno di 
        una sub. Per distinguere un controllo dall'altro utilizzeremo il suo <a href="../glossary/h.htm#HANDLE">handle</a>:</p>
      <ol class="codicevb" start="6">
        <li>Public Sub MuoviControllo(ByVal Handle As Long)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ReleaseCapture</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SendMessage Handle, WM_NCLBUTTONDOWN, SC_DLG_NO_UI, 
          0&</li>
        <li>End Sub</li>
      </ol>
      <p>In questa funzione c'&egrave; poco da commentare: viene semplicemente 
        rilasciato l'oggetto attivo tramite la funzione API <i>ReleaseCapture</i> 
        e poi viene inviato tramite la funzione API <i>SendMessage</i> il messaggio 
        SC_DLG_NO_UI associato a WM_NCLBUTTONDOWN alla finestra il cui handle 
        &egrave; quello passato alla funzione.</p>
      <p>Per spostare un controllo utilizzeremo l'evento <i>MouseDown</i> associato 
        ad ogni controllo. Se il tasto del mouse premuto sar&agrave; quello sinistro, 
        verr&agrave; chiamata la funzione <b>MuoviControllo</b> vista poco prima.<br>
        Scriveremo per cui:</p>
      <ol class="codicevb" start="11">
        <li>Private Sub Command1_MouseDown(Button As Integer, Shift As Integer, 
          X As Single, Y As Single)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Button = 1 Then MuoviControllo Command1.hwnd</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Dir1_MouseDown(Button As Integer, Shift As Integer, X 
          As Single, Y As Single)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Button = 1 Then MuoviControllo Dir1.hwnd</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Text1_MouseDown(Button As Integer, Shift As Integer, X 
          As Single, Y As Single)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Button = 1 Then MuoviControllo Text1.hwnd</li>
        <li>End Sub</li>
      </ol>
      <p>Come possiamo vedere, la chiamata dei diversi controlli, differisce soltanto 
        per l'handle passato alla funzione.</p>
      <p>A questo punto possiamo provare il nostro progetto: una semplice operazione 
        di trascinamento provoca lo spostamento del controllo trascinato. Ovviamente 
        ad ogni riavvio del form tutti i controlli torneranno alla loro posizione 
        originale perch&eacute; non abbiamo una funzione di salvataggio delle 
        posizioni dei controlli.<br>
        <br>
      </p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>L'utilizzo dei messaggi delle finestre semplifica enormemente la scrittura 
        di codici per il calcolo delle coordinate di movimento del controllo.</p>
      <p>Esiste una seconda soluzione funzionante per&ograve; soltanto su Windows 
        9x. Consiste nell'utilizzare i messaggi WM_SYSCOMMAND e SC_MOVE.<br>
        &Egrave; stata abbandonata in favore della nuova soluzione, provata e 
        funzionante anche su Windows 2000.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        Nuova soluzione di: Rapta e KyeMan<br>
        25 Aprile 2001<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
