<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Determinare il colore di un pixel sullo schermo</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Determinare il colore di 
    un pixel sullo schermo<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Gli schermi dei nostri computer si fanno sempre pi&ugrave; colorati. 
        Come fare per determinare il colore di un punto sullo schermo? In questo 
        How-To estrarremo il colore del pixel indicato dal cursore del mouse.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/howto/howto035_01.jpg" width="164" height="89" align="right" alt="Figura 1">Il 
        progetto si compone di un solo form e poche righe di codice.<br>
        Inseriamo nel nostro form una <i>PictureBox</i><img src="../images/controls/picturebox.gif" width="25" height="25" align="absmiddle"> 
        di nome <b>ColorePixel</b>, un <i>Timer</i><img src="../images/controls/timer.gif" width="25" height="25" align="absmiddle">di 
        nome <b>Tempo</b>, con la propriet&agrave; <i>Enabled</i> impostata a 
        True ed <i>Interval</i> a 100, una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle"> 
        di nome <b>Colore</b> ed altre tre <i>Label</i> in una <a href="../glossary/m.htm#MATRICE">matrice</a> 
        di nome <b>NumeriRGB</b> con i loro indici rispettivamente di 0, 1 e 2. 
        Abbiamo voluto aggiungere anche altre tre <i>PictureBox</i> colorate con 
        i tre colori fondamentali: rosso, verde e blu, ma esse non serviranno 
        per i nostri scopi.</p>
      <p>Il funzionamento &egrave; molto semplice: mediante una funzione API otteniamo 
        le coordinate del punto in cui &egrave; posizionato il mouse e mediante 
        un'altra funzione leggiamo il colore del pixel in quel punto. Fatto questo 
        scomponiamo il numero ottenuto nella tripletta <a href="../glossary/r.htm#RGB">RGB</a> 
        ed estraiamo i valori dei singoli colori.<br>
        Tali operazioni saranno ripetute ogni decimo di secondo per assicurare 
        l'aggiornamento dei colori estratti. Vediamo il codice:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Type POINTAPI</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;x As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;y As Long</li>
        <li>End Type</li>
        <li></li>
        <li>Private Declare Function GetCursorPos Lib &quot;USER32&quot; (lpPoint 
          As POINTAPI) As Long</li>
        <li>Private Declare Function GetDC Lib &quot;USER32&quot; (ByVal hwnd 
          As Long) As Long</li>
        <li>Private Declare Function ReleaseDC Lib &quot;USER32&quot; (ByVal hwnd 
          As Long, ByVal hdc As Long) As Long</li>
        <li>Private Declare Function GetPixel Lib &quot;GDI32&quot; (ByVal hdc 
          As Long, ByVal x As Long, ByVal y As Long) As Long</li>
        <li></li>
        <li>Private ScreenDC As Long</li>
        <li>Private Coord As POINTAPI</li>
        <li></li>
      </ol>
      <p>Alle righe 3-6 definiamo un nuovo tipo di dati&nbsp;<img src="../images/ide/tipoudt.gif" width="16" height="16" align="absmiddle"> 
        di nome <b>POINTAPI</b>. &Egrave; un tipo di dati API e viene richiesto 
        da svariate funzioni grafiche.</p>
      <p>Alla riga 8 abbiamo la dichiarazione della funzione API <b><i>GetCursorPos</i></b> 
        che restituisce le coordinate del cursore del mouse. Richiede appunto 
        il tipo di dati <b>POINTAPI</b>.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Le righe 9 e 10 contengono le dichiarazioni delle funzioni <i><b>GetDC</b></i> 
        e <i><b>ReleaseDC</b></i>. La prima serve per ottenere il <a href="../glossary/d.htm#DC">DC</a> 
        (<a href="../glossary/d.htm#DEVICECONTEXT">Device Context</a>) di una 
        finestra, mentre la seconda serve per rilasciare (<a href="../glossary/d.htm#DEALLOCARE">deallocare</a>) 
        un DC.</p>
      <p>La riga 11 include la dichiarazione della funzione API <i><b>GetPixel</b></i> 
        che restituisce in uscita il colore del pixel indicato alle coordinate 
        specificate. La funzione richiede anche il DC cui si fa riferimento.</p>
      <p>Alle righe 13 e 14 definiamo due variabili che utilizzeremo pi&ugrave; 
        volte all'interno del nostro progetto. La prima &egrave; <b><i>ScreenDC</i></b>, 
        ovvero l'handle del DC dello schermo; ci&ograve; significa che il punto 
        di origine sar&agrave; l'angolo in alto a sinistra dello schermo; se avessimo 
        scelto un altro DC l'origine sarebbe stato l'angolo in alto a sinistra 
        della finestra cui appartiene il DC. Il Device Context dello schermo contiene 
        tutto ci&ograve; che &egrave; visibile all'utente, ma non contiene la 
        grafica che al momento &egrave; nascosta. <br>
        La seconda variabile &egrave; <i><b>Coord</b></i>, di tipo <i>POINTAPI</i>, 
        che utilizzeremo per contenere le coordinate del cursore del mouse.</p>
      <ol class="codicevb" start="16">
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ScreenDC = GetDC(0)</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Form_Unload(Cancel As Integer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call ReleaseDC(0, ScreenDC)</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>All'avvio del programma estrarremo il DC dello schermo tramite la funzione 
        <i>GetDC</i>. La finestra 0 denota lo schermo. Memorizzeremo tale DC nella 
        variabile ScreenDC (riga 17).</p>
      <p>Altres&igrave; alla chiusura del programma rilasceremo tale <a href="../glossary/h.htm#HANDLE">handle</a> 
        DC, tramite la funzione <i>ReleaseDC</i> (riga 21). Il mancato rilascio 
        di un DC comporta il blocco di un handle e alla lunga anche il blocco 
        del sistema. </p>
      <ol class="codicevb" start="24">
        <li>Private Sub Tempo_Timer()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim ColoreEstratto As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call GetCursorPos(Coord)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ColoreEstratto = GetPixel(ScreenDC, Coord.x, 
          Coord.y)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ColorePixel.BackColor = ColoreEstratto</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Colore.Caption = Right(&quot;000000&quot; 
          &amp; Hex(ColoreEstratto), 6)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;NumeriRGB(0).Caption = &quot;Rosso: &quot; 
          &amp; Mid(Colore.Caption, 5, 2)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;NumeriRGB(1).Caption = &quot;Verde: &quot; 
          &amp; Mid(Colore.Caption, 3, 2)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;NumeriRGB(2).Caption = &quot;Blu: &quot; &amp; 
          Mid(Colore.Caption, 1, 2)</li>
        <li>End Sub</li>
      </ol>
      <p>Tutto il codice principale &egrave; contenuto nella funzione legata all'evento 
        <i>Timer</i><img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle"> 
        di <b>Tempo</b>.</p>
      <p>Alla riga 25 dichiariamo la variabile <i><b>ColoreEstratto</b></i> che 
        utilizzeremo per memorizzare il valore del colore ottenuto.</p>
      <p>Alla riga 26 reperiamo le coordinate del cursore tramite la funzione 
        <i>GetCursorPos</i>.<br>
        Possiamo adesso estrarre il colore del pixel alle coordinate indicate 
        nella struttura <i><b>Coord</b></i>. Utilizzeremo allora la funzione <i>GetPixel</i>: 
        essa richiede l'handle del DC per specificare l'origine dei punti e le 
        due coordinate. Il risultato della chiamata alla funzione sar&agrave; 
        memorizzato nella variabile <i><b>ColoreEstratto</b></i>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Ottenuto il colore possiamo procedere alla sua scissione. Alla riga 28 
        mostriamo dentro la <i>PictureBox</i> <b>ColorePixel</b> il colore del 
        pixel estratto, impostando per essa la propriet&agrave; <i>BackColor</i>.</p>
      <p>Alla riga 29 convertiamo il colore estratto in esadecimale tramite funzione 
        Hex. L'operazione di concatenazione usata assieme alla funzione Right 
        &egrave; una soluzione molto comune per assicurarsi che il risultato della 
        conversione in esadecimale sia esattamente 6 caratteri. Il risultato sar&agrave; 
        mostrato nella Label <b>Colore</b>.</p>
      <p>La scomposizione del colore in tripletta RGB sar&agrave; effettuato mediante 
        estrazione di coppie di caratteri dalla Label <b>Colore</b>. La prima 
        coppia indicher&agrave; il blu, la seconda il verde e la terza il rosso 
        (righe 30-32).<br>
        Avremmo potuto adottare mille soluzioni per effettuare quest'operazione 
        ma questa sembra essere una delle pi&ugrave; semplici. Una soluzione per 
        la scomposizione si trova nell'How-To dedicatato alla <a href="ht_038.htm">gestione 
        dei colori RGB</a> ed in quello dedicato all'<a href="ht_031.htm">estrazione 
        dei singoli bytes da un dato di tipo multibyte</a>.</p>
      <p><img src="../images/howto/howto035_02.jpg" width="164" height="89" align="right" alt="Figura 2">La 
        prova del programma &egrave; semplicissima, infatti il programma far&agrave; 
        tutto da solo tramite il <i>Timer</i>. Lanciamo il programma, muoviamo 
        il mouse sullo schermo e vedremo nella <i>PictureBox</i> il colore del 
        punto che stiamo indicando. <br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Il progetto &egrave; molto semplice e non pone alcun rischio particolare.<br>
        &Egrave; anche il principio di base per l'<a href="ht_036.htm">How-To 
        dedicato all'ingrandimento o riduzione di una parte dello schermo</a>.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        17 Maggio 2001<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
