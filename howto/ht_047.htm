<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Inserire delle immagini nelle voci di un menu</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Inserire delle immagini 
    nelle voci di un menu<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Quasi tutti i moderni programmi presentano all'interno delle voci dei 
        menu delle icone che rendono il programma un po' pi&ugrave; accattivante 
        e semplice da capire.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Esistono due diverse soluzioni per inserire le icone all'interno delle 
        voci di un menu: la prima soluzione &egrave; molto semplice ma altrettanto 
        limitata ed insoddisfacente; la seconda soluzione utilizza il <a href="../glossary/s.htm#SUBCLASSING">subclassing</a> 
        della finestra e si presenta pertanto davvero molto complessa ma i risultati 
        che produce sono davvero soddisfacenti. In questo articolo sar&agrave; 
        presentata la prima delle due soluzioni, ovvero quella pi&ugrave; semplice 
        e che non richiede il subclassing della finestra.</p>
      <p><img src="../images/howto/howto047_01.png" width="139" height="153" align="right" alt="Figura 1">Il 
        progetto sviluppato si compone di un solo form, senza alcun controllo, 
        eccetto un menu scritto con l'<a href="../base/bas_16.htm#STRUMENTIOPT3">Editor 
        di menu</a> <img src="../images/ide/editmenu.gif" width="16" height="16" align="absmiddle"> 
        incluso nell'<a href="../glossary/i.htm#IDE">IDE</a> di Visual Basic, 
        contenente al suo interno soltanto quattro voci. Il nome ed i contenuti 
        del menu non importa; utilizzeremo infatti le funzioni <a href="../glossary/a.htm#API">API</a> 
        per effettuare le modifiche che non richiedono i nomi dei menu ma si basano 
        sugli <a href="../glossary/h.htm#HANDLE">handle</a> dei menu. Unico requisito 
        per il progetto: il primo menu deve contenere almeno 4 voci al suo interno. 
        Nel nostro esempio il menu <i><b>&quot;Menu con bitmap&quot;</b></i> contiene 
        al suo interno 4 voci: VB, ASP, HTM E TXT ed inseriremo un'icona per ognuna 
        delle quattro voci.</p>
      <p>Vediamo il codice del progetto:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Const MF_BYPOSITION = &amp;H400&amp;</li>
        <li></li>
        <li>Private Declare Function GetMenu Lib &quot;user32&quot; (ByVal hwnd 
          As Long) As Long</li>
        <li>Private Declare Function GetSubMenu Lib &quot;user32&quot; (ByVal 
          hMenu As Long, ByVal nPos As Long) As Long</li>
        <li>Private Declare Function SetMenuItemBitmaps Lib &quot;user32&quot; 
          (ByVal hMenu As Long, ByVal nPosition As Long, ByVal wFlags As Long, 
          ByVal hBitmapUnchecked As Long, ByVal hBitmapChecked As Long) As Long</li>
        <li></li>
        <li>Private imgBitmaps(3) As IPictureDisp</li>
        <li></li>
      </ol>
      <p>Alla riga 3 &egrave; dichiarata una costante di nome <b>MF_BYPOSITION</b> 
        che indica che le operazioni che eseguiremo sulle voci di menu si baseranno 
        sulla loro posizione relativa rispetto al menu che le contiene.</p>
      <p>Alla riga 5 &egrave; stata dichiarata la funzione <b>GetMenu</b> che 
        recupera l'<a href="../glossary/h.htm#HANDLE">handle</a> della barra dei 
        menu della finestra. La funzione <b>GetSubMenu</b> restituisce invece 
        l'handle dei singoli menu della finestra, che sono contenuti all'interno 
        della barra dei menu. La terza funzione API &egrave; <b>SetMenuItemBitmaps</b> 
        che consente di associare un'immagine ad una voce di menu.</p>
      <p>Alla riga 9 &egrave; dichiarato un <a href="../glossary/a.htm#ARRAY">array</a> 
        di immagini (<i><b>IPictureDisp</b></i>) che verr&agrave; utilizzato per 
        contenere le immagini da associare ai menu. Purtroppo &egrave; stato necessario 
        <a href="../glossary/a.htm#ALLOCARE">allocare</a> questa matrice per bloccare 
        le immagini in memoria. Senza di essa le immagini sarebbero state caricate 
        ed automaticamente <a href="../glossary/d.htm#DEALLOCARE">deallocate</a> 
        dalla memoria, rendendole inutilizzabili.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Gli oggetti in Visual Basic infatti vengono scaricati dalla memoria soltanto 
        quando tutti i <a href="../glossary/p.htm#PUNTATORE">puntatori</a> all'oggetto 
        rilasciano l'oggetto puntato, ovvero vengono eliminati tutti i riferimenti 
        all'oggetto in memoria. L'array <b>imgBitmaps</b> terr&agrave; le immagini 
        in memoria con la minima occupazione di memoria possibile. Avremmo potuto 
        utilizzare anche un controllo <i>Image</i> o <i>Picture</i> sul form ma 
        avrebbe richiesto una quantit&agrave; maggiore di risorse.</p>
      <ol class="codicevb" start="11">
        <li>Private Function AppPath() As String</li>
        <li>&nbsp;&nbsp;AppPath = App.Path</li>
        <li>&nbsp;&nbsp;If Right$(AppPath, 1) &lt;&gt; &quot;\&quot; Then AppPath 
          = AppPath &amp &quot;\&quot;</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>La funzione AppPath, peraltro gi&agrave; vista in un <a href="../activity/act_21.htm">altro 
        articolo</a>, restituisce il percorso dell'applicazione, assicurandosi 
        che esso termini con una barra rovesciata.</p>
      <ol class="codicevb" start="16">
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;Dim hSubMenu As Long</li>
        <li>&nbsp;&nbsp;Set imgBitmaps(0) = LoadPicture(AppPath &amp; &quot;0.BMP&quot;)</li>
        <li>&nbsp;&nbsp;Set imgBitmaps(1) = LoadPicture(AppPath &amp; &quot;1.BMP&quot;)</li>
        <li>&nbsp;&nbsp;Set imgBitmaps(2) = LoadPicture(AppPath &amp; &quot;2.BMP&quot;)</li>
        <li>&nbsp;&nbsp;Set imgBitmaps(3) = LoadPicture(AppPath &amp; &quot;3.BMP&quot;)</li>
        <li></li>
        <li>&nbsp;&nbsp;hSubMenu = GetSubMenu(GetMenu(Me.hwnd), 0)</li>
        <li>&nbsp;&nbsp;Call SetMenuItemBitmaps(hSubMenu, 0, MF_BYPOSITION, imgBitmaps(0).Handle, 
          imgBitmaps(0).Handle)</li>
        <li>&nbsp;&nbsp;Call SetMenuItemBitmaps(hSubMenu, 1, MF_BYPOSITION, imgBitmaps(1).Handle, 
          imgBitmaps(1).Handle)</li>
        <li>&nbsp;&nbsp;Call SetMenuItemBitmaps(hSubMenu, 2, MF_BYPOSITION, imgBitmaps(2).Handle, 
          imgBitmaps(2).Handle)</li>
        <li>&nbsp;&nbsp;Call SetMenuItemBitmaps(hSubMenu, 3, MF_BYPOSITION, imgBitmaps(3).Handle, 
          imgBitmaps(3).Handle)</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Alle righe 18-21 sono caricate quattro immagini presenti nella cartella 
        del programma.<br>
        La riga 23 recupera l'handle della prima (a base 0) voce del menu del 
        form. Successivamente (righe 24-27) ad ogni voce del menu &egrave; assegnato 
        l'handle di ognuna delle quattro immagini tramite la funzione <b>SetMenuItemBitmap</b>.</p>
      <ol class="codicevb" start="30">
        <li>Private Sub Form_Unload(Cancel As Integer)</li>
        <li>&nbsp;&nbsp;Erase imgBitmaps</li>
        <li>End Sub</li>
      </ol>
      <p>L'applicazione che richiama la funzione <b>SetMenuItemBitmaps</b> &egrave; 
        responsabile di deallocare le immagini al termine dell'utilizzo. Alla 
        riga 31 la matrice di oggetti <b>imgBitmaps</b> &egrave; azzerata e tutti 
        i suoi elementi deallocati utilizzando la funzione <b>Erase</b>.</p>
      <table width="90%" border="0" cellspacing="2" cellpadding="2" align="center">
        <tr> 
          <td width="50%" align="center" valign="top"><img src="../images/howto/howto047_02.png" width="139" height="153" alt="Figura 2"><br>
            <b>Figura 2</b></td>
          <td width="50%" align="center" valign="top"><img src="../images/howto/howto047_03.png" width="139" height="153" alt="Figura 3"><br>
            <b>Figura 3</b></td>
        </tr>
      </table>
      <p>Passando all'esecuzione del progetto possiamo vedere che all'interno 
        del menu sono presenti le quattro icone. Purtroppo la loro qualit&agrave; 
        &egrave; davvero scarsa e nel momento in cui una voce &egrave; selezionata 
        (Figura 3) la loro qualit&agrave; &egrave; ulteriormente inferiore.<br>
        <br>
      </p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>La soluzione proposta &egrave; davvero molto semplice ma altamente limitata. 
        Le icone da inserire nel menu devono essere immagini bitmap di dimensioni 
        15x15 preferibilmente a 16 colori o in bianco e nero. In aggiunta le bitmap 
        devono restare in memoria, deve ovvero essere presente un oggetto in memoria 
        che tenga un riferimento all'immagine per prevenire lo scaricamento dell'oggetto.</p>
      <p>In futuro potrebbe essere pubblicata anche l'altra soluzione, che utilizza 
        subclassing e come tale si presenta molto pi&ugrave; difficile della soluzione 
        appena sviluppata.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        25 Aprile 2002<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
