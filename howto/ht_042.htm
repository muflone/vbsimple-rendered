<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Trascinamento OLE</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Trascinamento OLE<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Una delle caratteristiche pi&ugrave; apprezzate dei sistemi Windows &egrave; 
        il <a href="../glossary/t.htm#TRASCINAMENTOOLE">trascinamento OLE</a> 
        tra oggetti di diverso genere: files, testi ed immagini possono essere 
        trasferite, copiate da una posizione ad un'altra con poche semplici operazioni. 
        Il termine trascinamento OLE indica il trasferimento mediante trascinamento 
        del <b>contenuto di un controllo</b> e non il trascinamento del controllo 
        stesso; per trascinare un controllo sulla superficie del form vedi l'<a href="ht_007.htm">HowTo 
        dedicato allo spostamento di un controllo a runtime</a>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Quasi tutti i controlli di Visual Basic sono in grado di eseguire operazioni 
        di trascinamento OLE, alcuni dei quali, se desiderato, in maniera automatica. 
        Il progetto che svilupperemo potrebbe sembrare parecchio complesso ma 
        non &egrave; affatto cos&igrave;. Per evitare ripetizioni, dopo aver visto 
        il funzionamento del sistema di trascinamento OLE, racchiuderemo le operazioni 
        interessate a pi&ugrave; parti del codice in tre Sub separate.</p>
      <p><img src="../images/howto/howto042_01.png" width="173" height="254" align="right" alt="Figura 1">Cominciamo 
        disponendo sulla superficie del nostro form i seguenti controlli: nell'alto 
        in angolo a sinistra un controllo <i>Image</i><img src="../images/controls/image.gif" width="25" height="25" align="absmiddle">di 
        nome <b>imgFreccia1</b> contenente l'immagine della freccia verso destra 
        mostrata nella figura a fianco; nell'angolo opposto abbiamo una seconda 
        <i>Image</i> di nome <b>imgFreccia2</b> con l'immagine della freccia verso 
        sinistra.<br>
        Entrambe serviranno da indicatori durante l'utilizzo del programma.</p>
      <p>Tra le due frecce abbiamo 4 controlli disposti verticalmente uno sopra 
        l'altro: il primo di questi &egrave; un controllo <i>Image</i><img src="../images/controls/image.gif" width="25" height="25" align="absmiddle"> 
        di nome <b>Image1</b> contenente l'immagine del cane <i>Soichiro</i> ^_^ 
        e con la propriet&agrave; <i>BorderStyle</i> impostata su <i><b>1 - Fixed 
        Single</b></i>; nel nostro esempio questa propriet&agrave; non &egrave; 
        strettamente necessaria ma sar&agrave; utile quando in seguito amplieremo 
        il discorso con le operazioni di trascinamento automatico.</p>
      <p>Subito sotto il cane Soichiro abbiamo una <i>Label</i><img src="../images/controls/label.gif" width="25" height="25" align="absmiddle">di 
        nome <b>Label1</b>, un <i>Frame</i><img src="../images/controls/frame.gif" width="25" height="25" align="absmiddle">di 
        nome <b>Frame1</b> ed una <i>ListBox</i><img src="../images/controls/listbox.gif" width="25" height="25" align="absmiddle">di 
        nome (indovina un po') <b>List1</b>. Abbiamo preferito non assegnare un 
        nome significativo a questi controlli per evitare confusioni con le altre 
        parti del codice; i quattro controlli con nome predefinito saranno quelli 
        interessati nelle operazioni di trascinamento OLE. Tutti e quattro questi 
        controlli (<b>Image1</b>, <b>Label1</b>, <b>Frame1</b> e <b>List1</b>) 
        avranno la propriet&agrave; <i>OLEDropMode</i> impostata su <i><b>1 - 
        Manual</b></i>. Ci&ograve; significa che sar&agrave; compito del programmatore 
        occuparsi delle operazioni di trascinamento e pertanto non saranno gestite 
        automaticamente e verranno generati degli eventi in occasione delle operazioni 
        di trascinamento.</p>
      <p>Sotto la ListBox avremo una <i>Label</i> descrittiva di nome <b>lblEffetto</b> 
        e due <i>OptionButton</i><img src="../images/controls/optionbutton.gif" width="25" height="25" align="absmiddle">di 
        nome <b>optEffetto</b> in una <a href="../glossary/m.htm#MATRICE">matrice</a> 
        di controlli, quindi con indice 0 per quello con <i>Caption</i> &quot;Copia&quot; 
        ed indice 1 per quello con <i>Caption</i> &quot;Sposta&quot;.</p>
      <p>In fondo al form un'altra <i>Label</i> descrittiva di nome <b>lblGestioneAutomatica</b>, 
        una <i>TextBox</i><img src="../images/controls/textbox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>txtAutomatica</b> ed una <i>PictureBox</i><img src="../images/controls/picturebox.gif" width="25" height="25" align="absmiddle">di 
        nome <b>picAutomatica</b>. Queste ultime due verranno utilizzate per il 
        trascinamento OLE automatico e pertanto avranno la propriet&agrave; <i>OLEDropMode</i> 
        impostata su <i><b>2 - Automatic</b></i>.</p>
      <p>Pima di vedere il codice spiegheremo il funzionamento generale del procedimento: 
        per le operazioni di trascinamento manuale il programma in una situazione 
        particolare, tipicamente la pressione di un pulsante del mouse sopra un 
        controllo lancia l'esecuzione del metodo <img src="../images/ide/metodo.gif" width="16" height="16" align="absmiddle"> 
        <b><i>OLEDrag</i></b> dell'oggetto di cui si richiede il trascinamento 
        OLE. In risposta l'oggetto utilizzato per il trascinamento lancia l'evento<img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle"><b><i>OLEStartDrag</i></b> 
        fornendo come argomenti un oggetto <i>DataObject</i> di nome <b>Data</b> 
        ed un numero di nome <b>AllowedEffects</b>.</p>
      <p>Il primo di questi servir&agrave; come contenitore dei dati da trasferire 
        in cui ogni dato &egrave; identificato da un formato; il valore del formato 
        sar&agrave; un numero dell'enumerazione <img src="../images/ide/enumeraz.gif" width="16" height="16" align="absmiddle"> 
        <a href="../enum/008.htm">ClipBoardConstants</a>. L'oggetto <i>DataObject</i> 
        potr&agrave; essere riempito tramite il metodo <b>SetData</b> fornendo 
        il valore che assumer&agrave; tale dato ed il numero del formato. Sarebbe 
        anche possibile non fornire immediatamente il valore del dato ma solo 
        il suo formato: in tal caso al momento della lettura dei dati sar&agrave; 
        lanciato l'evento <i><b>OLESetData</b></i> per richiedere il completamento 
        di tali dati. Tralasciamo per il momento questo caso limite ed assumiamo 
        che il programma fornisca sempre il valore per ogni dato.</p>
      <p>L'altro argomento passato all'evento <i><b>OLEStartDrag</b></i> sar&agrave; 
        <b>AllowedEffects</b> e dovr&agrave; essere un numero dell'enumerazione 
        <a href="../enum/041.htm">OLEDropEffectConstants</a>. Esso determiner&agrave; 
        innanzitutto la forma del puntatore durante il trascinamento ed il comportamento 
        dei dati al termine del rilascio. I tre valori principali dell'enumerazione 
        sono:</p>
      <ul>
        <li><i>vbDropEffectNone = 0</i> <img src="../images/howto/howto042_02.gif" width="21" height="31" align="absbottom"><br>
          Indica che il trascinamento non verr&agrave; effettuato.<br>
          <br>
        </li>
        <li><i>vbDropEffectCopy = 1</i> <img src="../images/howto/howto042_03.gif" width="21" height="31" align="absbottom"><br>
          Indica un'operazione di copiatura dei dati che verranno trascinati; 
          al termine dell'operazione i dati originali non dovrebbero essere rimossi.<br>
          <br>
        </li>
        <li><i>vbDropEffectMove = 2</i> <img src="../images/howto/howto042_04.gif" width="21" height="31" align="absbottom"><br>
          Indica un'operazione di spostamento dei dati trascinati. Al termine 
          dell'operazione i dati originali dovrebbero essere rimossi dalla locazione 
          originale.</li>
      </ul>
      <p>La guida in linea di Visual Basic raccomanda l'utilizzo dei suddetti 
        valori in combinazione di bit sia durante la composizione del valore (tramite 
        operatore OR) che durante la lettura dei dati in esso contenuti (tramite 
        operatore AND); vedi anche le <a href="../info/info_08.htm">Informazioni 
        aggiuntive sull'estrazione bit a bit</a>.<br>
        Personalmente non sono d'accordo ma utilizzeremo comunque tale metodologia. 
        <img src="../images/icons/smile%20sad.gif" width="15" height="15" border="0" align="absmiddle"></p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>L'operazione di trascinamento sar&agrave; effettuata soltanto se entrambi 
        gli argomenti verranno completati: riempito il contenitore <b>Data</b> 
        tramite SetData ed impostato il valore <b>AllowedEffects</b>. La fase 
        di trascinamento termina quando l'utente rilascia il pulsante del mouse 
        oppure quando scatta qualche evento codice che ne interrompe l'esecuzione.</p>
      <p>Durante il trascinamento se l'oggetto che si trova sotto il puntatore 
        ha la propriet&agrave; <i>OLEDropMode </i>impostata su <i><b>1 - Manual</b></i> 
        verr&agrave; lanciato l'evento <i><b>OLEDragOver</b></i> ad indicare che 
        &egrave; in atto un trascinamento sopra l'oggetto cui si riferisce l'evento. 
        Se il trascinamento sopra tale oggetto non &egrave; voluto, ad esempio 
        per la differenza dei dati trattati oppure perch&eacute; si tratta dello 
        stesso oggetto che fornisce i dati, &egrave; possibile disabilitare temporaneamente 
        il trascinamento, senza tuttavia interrompere l'intera fase di trascinamento, 
        impostando l'argomento <i>Effect</i> su <b>vbDropEffectNone</b>. Ci&ograve; 
        render&agrave; inutile il rilascio del pulsante del mouse sul controllo 
        e l'evento successivo che conferma il rilascio non verr&agrave; generato.</p>
      <p>Le ultime due fasi dell'operazione di trascinamento sono identificate 
        dal rilascio effettivo con successo del pulsante del mouse. Il controllo 
        su cui &egrave; effettuato il rilascio lancer&agrave; l'evento <i><b>OLEDragDrop</b></i> 
        per richiedere il trasferimento dei dati. Anche in questo caso saranno 
        forniti gli argomenti <b>Data</b> di tipo <i>DataObject</i> ed <b>Effect</b> 
        per indicare il tipo di trascinamento. A parte questi due argomenti l'evento 
        presenta gli stessi dati dell'evento <i><b>MouseMove</b></i>. All'interno 
        dell'evento sar&agrave; necessario controllare la presenza di dati idonei 
        al tipo di controllo e l'eventuale recupero tramite il metodo <b>GetData</b>.</p>
      <p>L'ultimo evento che verr&agrave; generato sar&agrave; <i><b>OLECompleteDrag</b></i> 
        relativo all'oggetto da cui inizia il trascinamento e che fornisce i dati. 
        La sua funzione &egrave; esclusivamente quella di permettere al controllo 
        originale la rimozione dei dati trasferiti mediante operazione (Effetto) 
        di spostamento.</p>
      <p>Vediamo il codice del progetto alla luce di quanto detto finora cominciando 
        dal primo controllo trascinabile, Image1:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Sub Image1_MouseDown(Button As Integer, Shift As Integer, 
          X As Single, Y As Single)</li>
        <li>&nbsp;&nbsp;If Button = 1 Then Image1.OLEDrag</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Image1_OLEStartDrag(Data As DataObject, AllowedEffects 
          As Long)</li>
        <li>&nbsp;&nbsp;AttivaTrascinamento Image1, Data, AllowedEffects</li>
        <li>&nbsp;&nbsp;If Image1.Picture.Handle &lt;&gt; 0 Then Data.SetData 
          Image1.Picture, vbCFBitmap</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Nel momento in cui l'utente preme un tasto del mouse scatta il normale 
        evento MouseDown. Controlleremo pertanto che il pulsante premuto sia il 
        sinistro ed in tal caso avvieremo l'operazione di trascinamento sul controllo 
        Image1 (riga 4).</p>
      <p>In funzione del controllo che esegue il metodo OLEDrag (riga 4) scatta 
        l'evento OLEStartDrag per inizializzare l'operazione di trascinamento. 
        All'interno di questo lanceremo la Sub <b>AttivaTrascinamento</b> che 
        si occuper&agrave; di fornire dati validi per gli argomenti Data ed AllowedEffects, 
        che vedremo pi&ugrave; avanti. Ci basti sapere per ora che essa fornir&agrave; 
        al contenitore Data una stringa.</p>
      <p>Alla riga 9 oltre ai dati forniti dalla Sub AttivaTrascinamento abbiamo 
        aggiunto un ulteriore dato al contenitore Data. Essendo Image1 un controllo 
        grafico diamo la possibilit&agrave; di trasferire l'immagine in esso contenuta. 
        Baster&agrave; controllare che vi sia un'immagine e richiamare il metodo 
        <b>SetData</b> a cui forniremo il dato ovvero la propriet&agrave; <i>Picture</i> 
        dell'oggetto <b>Image1</b> e come formato dei dati specificheremo che 
        si tratta di una Bitmap.</p>
      <ol class="codicevb" start="12">
        <li>Private Sub Image1_OLEDragOver(Data As DataObject, Effect As Long, 
          Button As Integer, Shift As Integer, X As Single, Y As Single, State 
          As Integer)</li>
        <li>&nbsp;&nbsp;TrascinamentoSu Image1, Data, Effect</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Image1_OLEDragDrop(Data As DataObject, Effect As Long, 
          Button As Integer, Shift As Integer, X As Single, Y As Single)</li>
        <li>&nbsp;&nbsp;RilasciaTrascinamento Image1, Data, Effect</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Image1_OLECompleteDrag(Effect As Long)</li>
        <li>&nbsp;&nbsp;If (Effect And vbDropEffectMove) = vbDropEffectMove Then 
          Set Image1.Picture = Nothing</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Image1_DblClick()</li>
        <li>&nbsp;&nbsp;Set Image1.Picture = LoadPicture(App.Path &amp; &quot;\soichiro.bmp&quot;)</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Il funzionamento del'evento <i><b>OLEDragOver</b></i> sar&agrave; controllato 
        dalla Sub <b>TrascinamentoSu</b> che fondamentalmente impedir&agrave; 
        il rilascio sullo stesso controllo che ha fornito i dati. Non che sia 
        proibito farlo ma chi avrebbe interesse a trasferire dei dati da un controllo 
        allo stesso controllo?</p>
      <p>In maniera analoga, l'evento <i><b>OLEDragDrop</b></i> sar&agrave; controllato 
        dalla Sub <b>RilasciaTrascinamento</b> che si occuper&agrave; di mostrare 
        una MsgBox con i dati stringa e di mostrare le eventuali immagini Bitmap 
        contenuti nell'oggetto DataObject.</p>
      <p>Il completamento del trascinamento &egrave; identificato dal richiamo 
        dell'evento <i><b>OLECompleteDrag</b></i> sul controllo che ha fornito 
        i dati. Nel caso dell'immagine sar&agrave; possibile eliminare l'originale 
        a seguito di un'operazione di spostamento dei dati.</p>
      <p>La funzione alle righe 24-26 consentono di ricaricare l'immagine del 
        cane Soichiro nel caso essa venga eliminata perch&eacute; richiesto lo 
        spostamento dei dati.</p>
      <hr>
      <p>Sar&agrave; omesso il codice relativo agli altri 3 controlli trascinabili 
        (<b>Label1</b>, <b>Frame1</b> e <b>List1</b>) perch&eacute; del tutto 
        identici a quello appena visto, eccetto per le righe 9, 21 e 25 in quanto 
        essi non tratteranno l'uso di immagini.</p>
      <ol class="codicevb" start="28">
        <li>Private Sub AttivaTrascinamento(ByVal Controllo As Control, ByRef 
          Data As DataObject, ByRef AllowedEffects As Long)</li>
        <li>&nbsp;&nbsp;Data.SetData Controllo.Name, vbCFText</li>
        <li>&nbsp;&nbsp;If optEffetto(0).Value = True Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;AllowedEffects = AllowedEffects Or vbDropEffectCopy</li>
        <li>&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;AllowedEffects = AllowedEffects Or vbDropEffectMove</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;imgFreccia1.Move imgFreccia1.Left, Controllo.Top</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Avevamo accennato che la funzione <b>AttivaTrascinamento</b> fornir&agrave; 
        al contenitore Data una stringa e tale operazione sar&agrave; svolta dalla 
        riga 29. Il dato che sar&agrave; fornito a scopo di esempio sar&agrave; 
        il nome del controllo che effettua il trascinamento.<br>
        In funzione del pulsante di opzione scelto sar&agrave; impostato l'effetto 
        desiderato, copia o sposta (righe 30-34).</p>
      <p>Alla riga 35 viene infine posizionata la prima freccia imgFreccia1 in 
        corrispondenza del controllo che ha fornito i dati. Questo indicatore 
        punter&agrave; l'origine dei dati.</p>
      <ol class="codicevb" start="38">
        <li>Private Sub TrascinamentoSu(ByVal Controllo As Control, ByVal Data 
          As DataObject, Effect As Long)</li>
        <li>&nbsp;&nbsp;If Data.GetFormat(vbCFText) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Data.GetData(vbCFText) = Controllo.Name 
          Then Effect = vbDropEffectNone</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;If imgFreccia2.Top &lt;&gt; Controllo.Top Then imgFreccia2.Top 
          = Controllo.Top</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>La Sub TrascinamentoSu effettua una serie di controlli sui dati trasferiti. 
        Infatti se il trascinamento viene effettuato sullo stesso controllo che 
        ha fornito i dati disabiliteremo il rilascio semplicemente impostando 
        l'effetto su <i><b>vbDropEffectNone</b></i> (riga 40).</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Prima di richiedere la lettura dei dati trasferiti &egrave; opportuno 
        verificare che sia presente il formato di dati che intendiamo leggere, 
        nel nostro esempio il formato stringa corrispondente al valore <i><b>vbCFText</b></i>. 
        Tale controllo &egrave; effettuato utilizzando il metodo <b>GetFormat</b> 
        e restituisce un valore booleano corrispondente alla presenza di dati 
        nel formato richiesto (riga 39).</p>
      <p>Avendo la sicurezza che i dati trasferiti siano del formato corretto 
        effettueremo la lettura tramite il metodo GetData e nel caso che tali 
        dati corrispondano al nome del controllo in esame bloccheremo temporaneamente 
        il rilascio (riga 40).</p>
      <p>Infine sposteremo la seconda freccia <b>imgFreccia2</b> in corrispondenza 
        del controllo su cui i dati sono trascinati. Questo secondo indicatore 
        punter&agrave; pertanto la destinazione dei dati.</p>
      <ol class="codicevb" start="45">
        <li>Private Sub RilasciaTrascinamento(ByVal Controllo As Control, ByVal 
          Data As DataObject, ByVal Effect As Long)</li>
        <li>&nbsp;&nbsp;Dim Messaggio As String</li>
        <li>&nbsp;&nbsp;If Data.GetFormat(vbCFText) Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If (Effect And vbDropEffectCopy) = vbDropEffectCopy 
          Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Messaggio = &quot;Copia &quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Messaggio = &quot;Sposta &quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Messaggio = Messaggio &amp; Data.GetData(vbCFText)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Messaggio = Messaggio &amp; &quot; su &quot; 
          &amp; Controllo.Name</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox Messaggio, vbInformation Or vbOKOnly, 
          &quot;Trascinamento OLE&quot;</li>
        <li>&nbsp;&nbsp;End If</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>L'ultima Sub creata sar&agrave; quella dedicata alla fase di rilascio 
        dei dati sopra un controllo: <b>RilasciaTrascinamento</b> effettua il 
        controllo della presenza dei dati nel formato corretto (riga 47) ed in 
        tal caso mostra all'utente un messaggio.</p>
      <p>Il messaggio verr&agrave; costruito in base all'effetto richiesto (righe 
        48-54) e saranno recuperati i dati trasferiti tramite il metodo <b>GetData</b>. 
        Tale messaggio sar&agrave; mostrato mediante una MsgBox alla riga 55.</p>
      <p>Lanciamo il progetto, avendo cura di aver inserito anche il codice relativo 
        agli altri controlli in maniera analoga a quanto fatto per il controllo 
        Image1, e vediamo cosa succede trascinando il Frame sopra la ListBox:</p>
      <p>Se il pulsante di opzione selezionato per la scelta dell'effetto di trascinamento 
        &egrave; il primo dei due (Copia) il puntatore del mouse assumer&agrave; 
        la forma relativa all'operazione di copia (vedi figura 2) e sar&agrave; 
        mostrata la finestra con il messaggio <b>&quot;Copia Frame1 su List1&quot;</b> 
        come mostrato nella figura 3.<br>
        La stessa operazione pu&ograve; essere effettuata con gli altri tre controlli 
        per i quali &egrave; abilitato il trascinamento. I dati sul controllo 
        originale non saranno mai modificati. </p>
      <table width="90%" border="0" cellspacing="2" cellpadding="2" align="center">
        <tr> 
          <td width="50%" align="center" valign="top"> 
            <p><img src="../images/howto/howto042_05.png" width="173" height="254" alt="Figura 2"><br>
              <b>Figura 2</b></p>
          </td>
          <td width="50%" align="center" valign="top"><img src="../images/howto/howto042_07.png" width="173" height="254" alt="Figura 4"><br>
            <b>Figura 4</b></td>
        </tr>
        <tr> 
          <td width="50%" align="center" valign="top"> 
            <p><img src="../images/howto/howto042_06.png" width="143" height="95" alt="Figura 3"><br>
              <b>Figura 3</b></p>
          </td>
          <td width="50%" align="center" valign="top"><img src="../images/howto/howto042_08.png" width="148" height="95" alt="Figura 5"><br>
            <b>Figura 5</b></td>
        </tr>
      </table>
      <p>Se invece il pulsante di opzione scelto fosse il secondo (Sposta) il 
        puntatore del mouse assumer&agrave; una forma differente ad indicare l'operazione 
        di spostamento dei dati (vedi figura 4). Il messaggio mostrato nella MsgBox 
        indicher&agrave; l'operazione di spostamento (vedi figura 5). In tali 
        situazioni al termine del trasferimento i dati nel controllo di origine 
        dovrebbero essere eliminati</p>
      <p>Nel nostro progetto l'unico controllo per cui &egrave; abilitata l'operazione 
        di spostamento &egrave; <b>Image1</b>.</p>
      <p>Per dimostrare il funzionamento selezionare innanzitutto il pulsante 
        di opzione <i><b>Sposta</b></i>, trascinare l'immagine <b>Image1</b> sulla 
        <i>PictureBox</i> in basso come mostrato nella figura a fianco e rilasciare 
        il pulsante del mouse.<br>
        L'immagine originale sar&agrave; trasferita nella <i>PictureBox</i>.<br>
        Per fare apparire nuovamente l'immagine del cane baster&agrave; un semplice 
        click doppio sulla casella dell'immagine in alto.</p>
      <p align="center"><img src="../images/howto/howto042_09.png" width="173" height="254" alt="Figura 6"><br>
        <b>Figura 6</b> </p>
      <p>Abbiamo volutamente relegato alla fine del discorso i due controlli in 
        basso con propriet&agrave; <i>OLEDropMode</i> impostata su <i><b>2 - Automatic</b></i>: 
        <b>txtAutomatica</b> e <b>picAutomatica</b>.</p>
      <p>Tali controlli effettuano il ricevimento dei dati in maniera automatica 
        senza l'esecuzione degli eventi relativi <i><b>OLEDragOver</b></i>, <i><b>OLEDragDrop</b></i> 
        e quindi non richiedono una gestione manuale come per i controlli precedenti. 
        Il controllo <b>txtAutomatica</b> legger&agrave; i dati di tipo stringa 
        se presenti mentre il controllo <b>picAutomatica</b> recuper&agrave; l'immagine 
        in maniera automatica.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Il discorso &egrave; ancora ampio e richiederebbe ben pi&ugrave; di una 
        singola pagina web. Mediante questo meccanismo possono essere effettuate 
        tantissime operazioni utili rendendo l'applicativo semplice per l'utente. 
        La maggioranza dei programmi sia per piattaforme Windows che per altri 
        sistemi operativi utilizzano questa caratteristica.</p>
      <p>Il progetto in prima analisi potrebbe sembrare complesso e lungo ma uno 
        sguardo al codice del progetto scaricabile potrebbe chiarire molti punti 
        a prima vista oscuri.</p>
      <p>Si consiglia anche la consultazione della guida in linea di Visual Basic 
        sull'uso della propriet&agrave; <i>Files</i> della classe <img src="../images/ide/classe.gif" width="16" height="16" align="absmiddle"> 
        <i>DataObject</i>.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        3 Marzo 2002<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
