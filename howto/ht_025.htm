<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Visualizza la finestra di formattazione di un'unità</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Visualizza la finestra di 
    formattazione di un'unit&agrave;<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>In alcuni progetti pu&ograve; essere utile richiamare la finestra standard 
        di Windows per formattare un'unit&agrave;. In questo HowTo vedremo come 
        fare, sfruttando una funzione <a href="../glossary/a.htm#API">API</a> 
        della <a href="../glossary/l.htm#LIBRERIA">libreria</a> SHELL32 non documentata.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Questo progetto si compone di un form<img src="../images/controls/form.gif" width="25" height="25" align="absmiddle">e 
        di un <a href="../glossary/m.htm#MODULO">modulo standard</a> <img src="../images/ide/modulo.gif" width="16" height="16" align="absmiddle"> 
        per la definizione delle funzioni e <a href="../glossary/c.htm#COSTANTE">costanti</a> 
        <img src="../images/ide/costante.gif" width="16" height="16" border="0" align="absmiddle"> 
        API. Scriviamo all'interno del modulo:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Public Const DriveA As Integer = 0</li>
        <li>Public Const DriveB As Integer = 1</li>
        <li>Public Const DriveC As Integer = 2</li>
        <li>Public Const DriveD As Integer = 3</li>
        <li>Public Const DriveE As Integer = 4</li>
        <li></li>
        <li>Public Const SHFMT_OPT_QUICK As Integer = 0</li>
        <li>Public Const SHFMT_OPT_FULL As Integer = 1</li>
        <li>Public Const SHFMT_OPT_SYSONLY As Integer = 2</li>
        <li>Public Const SHFMT_ERROR As Long = &amp;HFFFFFFFF</li>
        <li>Public Const SHFMT_CANCEL As Long = &amp;HFFFFFFFE</li>
        <li>Public Const SHFMT_NOFORMAT As Long = &amp;HFFFFFFFD</li>
        <li>Private Const SHFMT_ID_DEFAULT As Integer = &amp;HFFFF</li>
        <li></li>
        <li>Private Declare Function SHFormatDrive Lib &quot;SHELL32.DLL&quot; 
          (ByVal hWnd As Long, ByVal Drive As Integer, ByVal fmtID As Integer, 
          ByVal Options As Integer) As Long</li>
        <li></li>
      </ol>
      <p>Nella sezione dichiarazioni abbiamo una serie di costanti ed una funzione 
        API.<br>
        Alle righe 3-7 abbiamo le costanti indicanti il drive da formattare: ogni 
        lettera di drive &egrave; rappresentata dal numero ordinale d'essa nell'alfabeto, 
        cos&igrave; il drive A: ha valore 0, il drive C: ha valore 2, etc...</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Alle righe 9-11 abbiamo dichiarato le modalit&agrave; di formattazione 
        del drive: <b>SHFMT_OPT_QUICK</b> per la formattazione veloce, <b>SHFMT_OPT_FULL</b> 
        per la formattazione completa e <b>SHFMT_OPT_SYSONLY</b> per il solo trasferimento 
        dei files di sistema.</p>
      <p>Alle righe 12-14 abbiamo le costanti indicanti i codici di uscita della 
        formattazione: <b>SHFMT_ERROR</b> in caso di errori, <b>SHFMT_CANCEL</b> 
        per annullamento dell'operazione da parte dell'utente e <b>SHFMT_NOFORMAT</b> 
        in caso di impossibilit&agrave; a formattare l'unit&agrave;.</p>
      <p>L'ultima costante &egrave; la <b>SHFMT_ID_DEFAULT</b> ed indica il tipo 
        di formattazione da eseguire (riga 15).</p>
      <p>Alla riga 17, infine, abbiamo la dichiarazione della funzione API <i><b>SHFormatDrive</b></i>. 
        Questa funzione non &egrave; documentata ufficialmente e risulta impossibile 
        trovarla nei visualizzatori di dichiarazioni API. Essa richiede come parametri 
        l'<a href="../glossary/h.htm#HANDLE">handle</a> della finestra che richiede 
        l'attivazione della finestra di formattazione, il drive indicato numericamente 
        (vedi sopra), il tipo di formattazione da effettuare e le opzioni di formattazione 
        (vedi sopra).</p>
      <ol class="codicevb" start="19">
        <li>Function FormatDriveDlg(ByVal OwnerhWnd As Long, ByVal Drive As Integer, 
          Optional Options As Variant) As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If IsMissing(Options) Then Options = SHFMT_OPT_QUICK</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;FormatDriveDlg = SHFormatDrive(OwnerhWnd, 
          Drive, SHFMT_ID_DEFAULT, Options)</li>
        <li>End Function</li>
      </ol>
      <p>La nostra funzione di richiamo della finestra di formattazione si chiamer&agrave; 
        <b>FormatDriveDlg</b> e richiede due parametri obbligatori ed uno opzionale.</p>
      <p>Alla riga 20 viene controllato se &egrave; stato passato il parametro 
        <b>Options</b> opzionale. Se non dovesse essere stato passato, sar&agrave; 
        impostato come opzione di formattazione <b>SHFMT_OPT_QUICK</b>, ovvero 
        la formattazione rapida. </p>
      <p>Alla riga 21 viene richiamata la funzione <i>ShFormatDrive</i> passandole 
        come parametri quelli ricevuti dalla nostra funzione ed il tipo di formattazione 
        (<b>SHFMT_ID_DEFAULT</b>). Il risultato dell'operazione sar&agrave; riportato 
        in uscita alla funzione <i>FormatDriveDlg</i>.</p>
      <p>Possiamo adesso vedere il form semplicissimo per richiamare la finestra 
        di formattazione per l'unit&agrave; floppy A:</p>
      <p><img src="../images/howto/howto025_01.jpg" width="174" height="71" align="right">L'interfaccia 
        si compone di un solo <i>CommandButton</i><img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">di 
        nome <b>btnFormatDrive</b> al cui click verr&agrave; eseguito il seguente 
        codice:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Sub btnFormatDrive_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim ret As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ret = FormatDriveDlg(Me.hWnd, DriveA)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Select Case ret</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SHFMT_ERROR</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox 
          &quot;Errore durante la formattazione&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SHFMT_CANCEL</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox 
          &quot;Operatione annullata&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SHFMT_NOFORMAT</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox 
          &quot;Questo drive non pu&ograve; essere formattato&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox 
          &quot;Operazione completata.&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End Select</li>
        <li>End Sub</li>
      </ol>
      <p>L'unica routine &egrave; quella legata all'<a href="../glossary/e.htm#EVENTO">evento</a> 
        <i>Click</i> sul pulsante <b>btnFormatDrive</b>.<br>
        Alla riga 4 dichiariamo la variabile <b>ret</b> che ricever&agrave; il 
        valore restituito dalla chiamata alla funzione <b>FormatDriveDlg</b>. 
        La chiamata viene effettuata passando come parametri l'<a href="../glossary/h.htm#HANDLE">handle 
        </a>del form e la costante <b>DriveA</b>, per formattare il disco floppy.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>In uscita dalla funzione, il valore <b>ret</b> conterr&agrave; un numero 
        indicante un errore oppure la riuscita operazione.<br>
        Abbiamo cos&igrave;, alla righe 6-15, un controllo del contenuto della 
        variabile <b>ret</b>. Per ogni suo valore appare una diversa finestra 
        di dialogo informativa.</p>
      <hr>
      <p><img src="../images/howto/howto025_02.jpg" width="274" height="282" align="right" alt="Figura 2">La 
        prova del progetto &egrave; molto semplice: la pressione dell'unico pulsante 
        sul form richiama la nostra finestra di formattazione.</p>
      <p>Qualunque sia stato il risultato dell'operazione, apparir&agrave; una 
        finestra informativa.</p>
      <p align="center"><img src="../images/howto/howto025_03.jpg" width="138" height="80" alt="Figura 3"></p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>In questo nostro esempio abbiamo voluto richiamare la finestra di formattazione 
        per l'unit&agrave; floppy per limitare al minimo gli accidentali danni.</p>
      <p>&Egrave; fondamentale non sottovalutare questo: prima di mostrare la 
        finestra di formattazione di un'unit&agrave;, avvisare sempre l'utente. 
        Infatti, l'involontaria pressione di un tasto da tastiera pu&ograve; in 
        pochi secondi cancellare preziose informazioni.</p>
      <p>Si consiglia di non abusare di questa funzione, sebbene possa essere 
        utile in progetti che richiedono l'utilizzo di un dischetto.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=6">Roal 
        Zanazzi</a><br>
        2 Febbraio 2001<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
