<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Elencare i files di una cartella secondo un criterio (seconda parte)</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Elencare i files di una 
    cartella secondo un criterio<br>
    (seconda&nbsp;parte)<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level4.gif" width="17" height="18" align="absmiddle"> 
        4<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" -->
<p align="center"><a href="ht_014.htm">&lt;&lt; Continua dalla parte 1</a></p>
      <ul>
        <li><a href="ht_014.htm">Prima versione (senza l'utilizzo dell'API</a>)</li>
        <li><a href="ht_014_2.htm#STEP2">Seconda versione (con l'utilizzo dell'API</a>) 
          <img src="../images/api.gif" width="34" height="24" align="absmiddle"> 
        </li>
      </ul>
      <hr>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p align="center" class="size3"><a name="STEP2"></a>Seconda versione (con 
        l'utilizzo dell'API) <img src="../images/api.gif" width="34" height="24" align="absmiddle"></p>
      <p>Una soluzione alternativa consiste nello sfruttamento di alcune funzioni 
        <a href="../glossary/a.htm#API">API</a>, in particolare l'invio di un 
        messaggio ben definito alla <i>ListBox<img src="../images/controls/listbox.gif" width="25" height="25" align="absmiddle"></i>che 
        dovr&agrave; contenere i nomi dei files.</p>
      <p>Il messaggio in questione &egrave; <b><i>LB_DIR</i></b> applicato alla 
        ListBox. Per cui &egrave; necessario definire alcune <a href="../glossary/c.htm#COSTANTE">costanti</a> 
        <img src="../images/ide/costante.gif" width="16" height="16" border="0" align="absmiddle"> 
        e dichiarazioni API:</p>
      <ol class="codicevb" start="1">
        <li>Private Const LB_DIR = &amp;H18D</li>
        <li>Private Const DDL_ARCHIVE = &amp;H20</li>
        <li>Private Const DDL_HIDDEN = &amp;H2</li>
        <li>Private Const DDL_READONLY = &amp;H1</li>
        <li>Private Const DDL_SYSTEM = &amp;H4</li>
        <li>Private Declare Function SendMessage Lib &quot;USER32&quot; Alias 
          &quot;SendMessageA&quot; (ByVal hwnd As Long, ByVal wMsg As Long, ByVal 
          wParam As Long, lParam As Any) As Long</li>
        <li>Private Declare Function GetShortPathName Lib &quot;KERNEL32&quot; 
          Alias &quot;GetShortPathNameA&quot; (ByVal lpszLongPath As String, ByVal 
          lpszShortPath As String, ByVal cchBuffer As Long) As Long</li>
      </ol>
      <p>La prima costante &egrave; proprio il messaggio <b><i>LB_DIR</i></b> 
        che provveder&agrave; ad effettuare il riempimento della ListBox.<br>
        Seguono alcune costanti di tipo DDL_ che definiscono il tipo di file da 
        elencare: <i>DDL_ARCHIVE</i> indica i files il cui attributo di archivio 
        &egrave; impostato; <i>DDL_HIDDEN</i> indica i files nascosti; <i>DDL_READONLY</i> 
        specifica i files di sola lettura; infine <i>DDL_SYSTEM</i> indica i files 
        di sistema.</p>
      <p>Nota che i valori DDL_ specificati corrispondono ai valori vbArchive, 
        vbHidden, vbReadOnly e vbSystem dell'<a href="../glossary/e.htm#ENUMERAZIONE">enumerazione</a> 
        <i>VbFileAttribute</i>. Ci&ograve; significa che avremmo potuto fare a 
        meno di queste costanti ed utilizzare il tipo intrinseco di Visual Basic.</p>
      <p>Alla riga 6 abbiamo dichiarato la funzione API <i>SendMessage</i>, utilizzata 
        per inviare un messaggio ad un oggetto. La funzione richiede quattro parametri:</p>
      <ul>
        <li><b>hWnd</b>: <a href="../glossary/h.htm#HANDLE">handle</a> della finestra 
          (oggetto) a cui inviare il messaggio;</li>
        <li><b>wMsg</b>: <a href="../glossary/m.htm#MESSAGGIO">messaggio</a> da 
          inviare alla finestra;</li>
        <li><b>wParam</b>: valore numerico per specificare un parametro per il 
          messaggio;</li>
        <li><b>lParam</b>: valore generico per specificare un ulteriore parametro.</li>
      </ul>
      <p>Alla riga 7 dichiariamo la funzione API <i>GetShortPathName</i> che converte 
        un nome di file lungo nel <a href="../info/info_07.htm">formato DOS (8.3)</a>. 
        Esiste un <i><a href="ht_013.htm">HowTo</a></i> che spiega passo passo 
        il funzionamento di questa funzione API; per tale ragione essa non sar&agrave; 
        approfondita in questa sede.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/howto/howto014_03.jpg" width="264" height="311" align="right" alt="Figura 1">Per 
        utilizzare questa nuova funzione di elencazione files inseriamo un nuovo 
        pulsante di comando<img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">di 
        nome <b>ElencaAPI</b> sul nostro form.</p>
      <p>Purtroppo per&ograve; questa nuova soluzione non permette la scansione 
        delle sottocartelle.</p>
      <p>Quindi l'impostazione del valore della <i>CheckBox</i><img src="../images/controls/checkbox.gif" width="25" height="25" align="absmiddle">non 
        varia nulla. In ogni caso <b class="sottolineato">non saranno scandite</b> 
        le sottocartelle.</p>
      <ol class="codicevb" start="9">
        <li>Private Sub ElencaAPI_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TempoInizio As Single</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim TempoFine As Single</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim Percorso As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ElencaAPI.MousePointer = vbHourglass</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;TempoInizio = Timer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ListaFiles.Clear</li>
      </ol>
      <p>Fino a questo punto la funzione differisce dalla precedente solo per 
        la variabile stringa <b>Percorso</b> dichiarata alla riga 12. Essa servir&agrave; 
        per ottenere il percorso della cartella da analizzare.</p>
      <ol class="codicevb" start="16">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Percorso = String(Len(CercaText.Text) + 1, 
          0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Percorso = Left$(Percorso, GetShortPathName(ByVal 
          CercaText.Text, Percorso, Len(CercaText.Text) + 1))</li>
      </ol>
      <p>Queste due righe sono l'applicazione (anche se un po' pi&ugrave; complessa) 
        della funzione API <i>GetShortPathName</i> vista in un <a href="ht_013.htm">altro 
        <i>HowTo</i></a>. Esse convertono il percorso specificato nella <i>TextBox</i> 
        <b>CercaText</b> in <a href="../info/info_07.htm">formato DOS</a> e memorizzano 
        il risultato nella variabile <b>Percorso</b>.</p>
      <ol class="codicevb" start="18">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Right(Percorso, 1) &lt;&gt; &quot;\&quot; 
          Then Percorso = Percorso &amp; &quot;\&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Percorso = Percorso &amp; TipoText.Text</li>
      </ol>
      <p>La riga 19 concatena il tipo di file ricercato al percorso, ma prima 
        si assicura (riga 18) che la variabile <b>Percorso</b> termini con un 
        \ e provvede ad aggiungerlo nel caso contrario.</p>
      <ol class="codicevb" start="20">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call SendMessage(ListaFiles.hwnd, LB_DIR, 
          DDL_ARCHIVE Or DDL_HIDDEN Or DDL_READONLY Or DDL_SYSTEM, ByVal Percorso)</li>
      </ol>
      <p>In quest'unica riga risiede l'intera funzione di elencazione.<br>
        Viene richiesto di inviare il messaggio <b>LB_DIR</b> alla finestra il 
        cui handle &egrave; ListaFiles.hwnd, ovvero la <i>ListBox</i> <b>ListaFiles</b>.<br>
        Vengono inviati due parametri: il primo &egrave; un numero composto dall'<a href="../info/info_06.htm">operazione 
        di OR</a> tra i valori DDL; in tal modo verranno ricercati tutti i files, 
        ovvero quelli con l'attributo archivio, quelli nascosti, quelli di sola 
        lettura e quelli di sistema.<br>
        Il secondo parametro &egrave; la variabile <b>Percorso</b>, passata, per&ograve; 
        <a href="../info/info_05.htm">per valore</a>, come richiesto dalla maggior 
        parte delle <a href="../info/info_09.htm">funzioni API</a>. Essa, lo ricordiamo, 
        &egrave; composta dal percorso della cartella da analizzare e dal tipo 
        di file richiesto (vedi riga 19).</p>
      <p>Questa semplice chiamata riempie la ListBox con i nomi dei files corrispondenti 
        al criterio richiesto.</p>
      <ol class="codicevb" start="21">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;TempoFine = Timer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Tempo.Caption = &quot;Tempo: &quot; &amp; 
          TempoFine - TempoInizio</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Conteggio.Caption = &quot;Conteggio: &quot; 
          &amp; ListaFiles.ListCount</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;ElencaAPI.MousePointer = vbNormal</li>
        <li>End Sub</li>
      </ol>
      <p>La funzione si chiude con le stesse righe che completano la versione 
        precedente. Viene scritta la durata dell'elencazione nella <i>Label</i> 
        <b>Tempo</b> e viene scritto nella <i>Label</i> <b>Conteggio</b> il numero 
        di elementi di cui si compone la ListBox.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Terminata la scrittura della funzione possiamo passare alla prova:</p>
      <p align="center"><img src="../images/howto/howto014_04.jpg" width="264" height="311" alt="Figura 2"><br>
        <b>Figura 2</b> </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Questa funzione &egrave; leggermente pi&ugrave; complessa della versione 
        precedente, ma richiede un tempo di elaborazione nettamente inferiore 
        a quello dell'altra versione. Provare per credere! :)<br>
        Il grosso svantaggio &egrave; che non &egrave; possibile elencare i files 
        presenti nelle sottocartelle tramite una sola chiamata.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a> e <a href="../vbmail.htm?id=3">Giuseppe Della Bianca</a><br>
        27 Dicembre 2000<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
