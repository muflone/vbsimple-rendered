<html><!-- #BeginTemplate "/Templates/HowTo.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Apertura e chiusura del cassetto del lettore CD</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Apertura e chiusura del 
    cassetto del lettore CD<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/howto.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>In alcuni programmi multimediali pu&ograve; essere piacevole aprire e 
        chiudere il cassetto del lettore CD per invitare l'utente ad inserire 
        un disco nell lettore. Si tratta di un'operazione di cui &egrave; meglio 
        non abusare, ma in quei rari casi in cui fosse necessaria un'operazione 
        del genere, le funzioni <a href="../glossary/m.htm#MCI">MCI</a> provvedono 
        una via molto semplice.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/howto/howto039_01.png" width="172" height="62" align="right" alt="Figura 1">Il 
        progetto si compone di un solo form con due semplici CommandButton<img src="../images/controls/commandbutton.gif" width="25" height="25" align="absmiddle">di 
        nome <b>cmdApriCD</b> e <b>cmdChiudiCD</b> e di un breve e semplice codice:</p>
      <ol class="codicevb" start="1">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Type MCI_OPEN_PARMS</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;dwCallback As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;wDeviceID As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lpstrDeviceType As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lpstrElementName As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lpstrAlias As String</li>
        <li>End Type</li>
        <li></li>
        <li>Private Const MCI_OPEN = &amp;H803&amp;</li>
        <li>Private Const MCI_OPEN_TYPE = &amp;H2000&amp;</li>
        <li>Private Const MCI_SET = &amp;H80D&amp;</li>
        <li>Private Const MCI_SET_DOOR_OPEN = &amp;H100&amp;</li>
        <li>Private Const MCI_SET_DOOR_CLOSED As Long = &amp;H200&amp;</li>
        <li>Private Const MCI_CLOSE = &amp;H804&amp;</li>
        <li></li>
        <li>Private Declare Function mciSendCommand Lib &quot;winmm.dll&quot; 
          Alias &quot;mciSendCommandA&quot; (ByVal wDeviceID As Long, ByVal uMessage 
          As Long, ByVal dwParam1 As Long, ByRef dwParam2 As Any) As Long</li>
        <li></li>
        <li>Private openParams As MCI_OPEN_PARMS</li>
        <li></li>
      </ol>
      <p>Innanzitutto &egrave; necessario definire i tipi, le costanti <img src="../images/ide/costante.gif" width="16" height="16" align="absmiddle"> 
        e le funzioni <a href="../glossary/a.htm#API">API</a>: alla riga 3 viene 
        definitivo un nuovo tipo di dati <img src="../images/ide/tipoudt.gif" width="16" height="16" align="absmiddle"> 
        denominato <b>MCI_OPEN_PARMS</b> che verr&agrave; utilizzato per contenere 
        i parametri sull'unit&agrave; CD da comandare.</p>
      <p>Alle righe 11-16 sono definite varie costanti API che saranno utilizzate 
        pi&ugrave; avanti dalla funzione <i>mciSendCommand</i>, dichiarata alla 
        riga 18. </p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Dichiariamo anche una variabile di nome openParams del tipo <b>MCI_OPEN_PARAMS</b> 
        definito in precedenza.</p>
      <ol class="codicevb" start="22">
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;openParams.wDeviceID = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;openParams.lpstrDeviceType = &quot;cdaudio&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call mciSendCommand(0, MCI_OPEN, MCI_OPEN_TYPE, 
          openParams)</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Form_Unload(Cancel As Integer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call mciSendCommand(openParams.wDeviceID, 
          MCI_CLOSE, 0, ByVal 0&amp;)</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Prima di eseguire un comando su un'unit&agrave; MCI &egrave; fondamentale 
        aprire un <a href="../glossary/h.htm#HANDLE">handle</a> a tale unit&agrave; 
        utilizzando la solita funzione <i>mciSendCommand</i>; al termine del suo 
        utilizzo sar&agrave; opportuno chiudere lo stesso.</p>
      <p>Alla riga 23 viene specificato l'ID della periferica da utilizzare il 
        cui tipo &egrave; definito alla riga successiva (<i><b>cdaudio</b></i>). 
        Forniti i parametri necessari sar&agrave; possibile richiedere l'apertura 
        dell'handle alla periferica tramite la funzione API <i>mciSendCommand</i> 
        specificando come comando (<a href="../glossary/m.htm#MESSAGGIO">messaggio</a>) 
        il valore della costante <i><b>MCI_OPEN</b></i>. I parametri aggiuntivi 
        da fornire riguardano il tipo di argomento passato, nel nostro caso una 
        struttura di tipo <b>MCI_OPEN_PARMS</b>, identificata dalla costante API 
        <i> <b>MCI_OPEN_TYPE</b></i> ed un <a href="../glossary/p.htm#PUNTATORE">puntatore</a> 
        (infatti l'argomento &egrave; <a href="../info/info_05.htm">dichiarato 
        con ByRef</a>) alla variabile <b>openParams</b>.</p>
      <p>Non appena effettuata l'apertura del dispositivo MCI il <a href="../glossary/m.htm#MEMBRO">membro</a> 
        <i>wDeviceID</i> ricever&agrave; il vero ID della periferica, precedentemente 
        inizializzato a 0.</p>
      <p>In maniera analoga, alla chiusura del form, sar&agrave; necessario chiudere 
        l'handle aperto utilizzando sempre la funzione <i>mciSendCommand</i> passando 
        come parametri l'ID del dispositivo aperto e come comando (messaggio) 
        il valore della costante <b>MCI_CLOSE</b>. A tutti gli altri argomenti 
        pu&ograve; essere passato un valore di zero.</p>
      <ol class="codicevb" start="32">
        <li>Private Sub cmdApriCD_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call mciSendCommand(openParams.wDeviceID, 
          MCI_SET, MCI_SET_DOOR_OPEN, ByVal 0&amp;)</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub cmdChiudiCD_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call mciSendCommand(openParams.wDeviceID, 
          MCI_SET, MCI_SET_DOOR_CLOSED, ByVal 0&amp;)</li>
        <li>End Sub</li>
      </ol>
      <p>L'apertura e la chiusura del cassetto del lettore CD si differenziano 
        soltanto per un parametro inviato alla funzione <i>mciSendCommand</i>. 
        Infatti in entrambi i casi sar&agrave; necessario fornire l'ID della periferica 
        ed il messaggio corrispondente alla costante <i><b>MCI_SET</b></i>. La 
        differenza sta nel terzo argomento della funzione: in caso di apertura 
        dovr&agrave; essere passata la costante <i><b>MCI_SET_DOOR_OPEN</b></i>, 
        mentre, in caso di chiusura la costante da passare sar&agrave; <i><b>MCI_SET_DOOR_CLOSED</b></i>.</p>
      <p>Ci penser&agrave; la funzione MCI a richiedere l'apertura o la chiusura 
        del cassetto del CD.<br>
        <br>
      </p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>A volte &egrave; incredibile!<br>
        Le funzioni MCI sono in grado di sollevare il programmatore dalla scrittura 
        decine o centinaia di righe di codice, anche per compiere i comandi pi&ugrave; 
        complessi.<br>
        Un altro esempio di utilizzo delle funzioni MCI si trova nella <a 
        href="../activity/act_16.htm">Richiesta per riprodurre un file MIDI all'intero 
        di un file di risorse</a>.</p>
      <p>Un problema legato a questa soluzione, per&ograve;, sta nel fatto che 
        l'apertura del cassetto avviene in maniera <a href="../glossary/s.htm#SINCRONO">sincrona</a> 
        ovvero il programma interrompe la sua esecuzione durante l'operazione 
        di apertura e di chiusura del cassetto del lettore CD.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        27 Gennaio 2002<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli HowTo</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
