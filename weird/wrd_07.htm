<html><!-- #BeginTemplate "/Templates/Weird.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Variant variabili</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Variant variabili<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/weird.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"> 
        2<!-- #EndEditable --> / 5</p>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Questa stranezza mi &egrave; capitata mentre sviluppavo un programma 
        in Delphi e solitamente programmando in Visual Basic non ci si rende conto 
        del difetto. L'articolo utilizza la libreria <a href="../glossary/a.htm#ADO">ADO</a> 
        per connettere un <a href="../glossary/r.htm#RECORDSET">Recordset</a>, 
        quindi salvarlo su file e ricaricarlo dallo stesso.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Utilizzeremo soltanto un form e tutto il codice sta nella routine di 
        gestione dell'evento<img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle"> 
        <i><b>Load</b></i>:</p>
      <ol start="1" class="codicevb">
        <li> Option Explicit</li>
        <li></li>
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim conn As ADODB.Connection</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim rs As ADODB.Recordset</li>
        <li></li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set conn = New ADODB.Connection</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call conn.Open(&quot;Provider=Microsoft.Jet.OLEDB.4.0;Data 
          Source=&quot; &amp; App.Path &amp; &quot;\db1.mdb&quot;)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set rs = conn.OpenSchema(adSchemaColumns, 
          Array(Empty, Empty, &quot;PROVA&quot;, Empty))</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;With rs</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Test 
          1 =&gt; &quot; &amp; VarType(.Fields("NUMERIC_PRECISION").Value)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Test 
          2 =&gt; &quot; &amp; .Fields(&quot;NUMERIC_PRECISION&quot;).Type</li>
      </ol>
      <p>Le righe 4 e 5 dichiarano rispettivamente una Connessione ed un Recordset, 
        mentre le righe 7 e 8 <a href="../glossary/i.htm#ISTANZA">istanziano</a> 
        ed aprono la connessione al database Access DB1.MDB posto nella stessa 
        cartella del progetto.</p>
      <p>La riga 9 legge lo schema Columns che restituisce un Recordset contenenti 
        tutte le colonne della tabella selezionata (di nome <b>PROVA</b>). Per 
        una spiegazione del funzionamento di <i>OpenSchema</i> si rimanda alla 
        guida di ADO, perch&egrave; inutilmente lunga da trattare in questo articolo. 
        La stessa documentazione dice che il recordset restituito conterr&agrave; 
        una colonna di nome <b>NUMERIC_PRECISION</b> e di tipo DBTYPE_UI2, corrispondente 
        ad un <i>Unsigned Integer da 2 bytes</i> e riprodotto in ADO come adUnsignedSmallInt, 
        dal valore 18.</p>
      <p>Alla riga 11 &egrave; effettuato questo controllo, inizialmente sul valore 
        dato dalla propriet&agrave; <i><b>Value</b></i> e quindi come controprova 
        sulla propriet&agrave; <i><b>Type</b></i>. Secondo quanto dice la guida 
        entrambi i test dovrebbero visualizzare il valore 18. Alla prova pratica 
        purtroppo non &eacute; cos&igrave;:</p>
      <table width="40%" border="0" align="center">
        <tr> 
          <td width="50%" align="center" valign="top"><img src="../images/weird/weird07_01.png" width="83" height="80" alt="Figura 1"><br>
            <b>Figura 1</b></td>
          <td width="50%" align="center" valign="top"><img src="../images/weird/weird07_02.png" width="83" height="80" alt="Figura 2"><br>
            <b>Figura 2</b></td>
        </tr>
      </table>
      <p>Il primo dei test, visualizzato nella <b>Figura 1</b> mostra come il 
        tipo Variant del valore restituito sia 3, corrispondente a vbLong ed alla 
        sua trasposizione in ADO con adInteger, <i>Intero con segno da 4 bytes</i> 
        ovvero DBTYPE_I4. Il secondo test, mostrato in <b>Figura 2</b>, dimostra 
        come il tipo di dati che ADO dice di restituire invece &egrave; il regolare 
        18 adUnsignedSmallInt ovvero DBTYPE_UI2.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Di primo acchitto si potrebbe accettare la stranezza con l'alibi che 
        Visual Basic non &egrave; in grado di gestire un tipo di dati Intero senza 
        segno e pertanto forza automaticamente la conversione al tipo successivamente 
        pi&ugrave; ampio, come Long. Il successivo test dimostrer&agrave; come 
        non solo la ragione non pu&ograve; esser questa ma ne avverr&agrave; un'altra 
        ancora. </p>
      <ol start="13" class="codicevb">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Save &quot;c:\wrd_07.xml&quot;, 
          adPersistXML</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Close</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call .Open(&quot;c:\wrd_07.xml&quot;, 
          Nothing)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Test 
          3 =&gt; &quot; &amp; VarType(.Fields("NUMERIC_PRECISION").Value)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Test 
          4 =&gt; &quot; &amp; .Fields(&quot;NUMERIC_PRECISION&quot;).Type</li>
      </ol>
      <p>Dalla riga 13 il Recordset aperto verr&agrave; salvato su un file XML 
        di nome WRD_07.XML, chiuso e riaperto ricaricando lo stesso file salvato. 
        Successivamente sono effettuati i due test gi&agrave; eseguiti in precedenza 
        (righe 16 e 17). Questa volta per&ograve; la dimostrazione cambia:</p>
      <table width="40%" border="0" align="center">
        <tr> 
          <td width="50%" align="center" valign="top"><img src="../images/weird/weird07_03.png" width="83" height="80" alt="Figura 3"><br>
            <b>Figura 3</b></td>
          <td width="50%" align="center" valign="top"><img src="../images/weird/weird07_04.png" width="83" height="80" alt="Figura 4"><br>
            <b>Figura 4</b></td>
        </tr>
      </table>
      <p>Entrambi i test restituiscono gli stessi dati: il tipo Variant dato dalla 
        propriet&agrave; Value &egrave; 18, corrispondente a DBTYPE_UI2, lo stesso 
        tipo che la propriet&agrave; Type dice di restituire. Questo dimostra 
        anche l'inaccettabilit&agrave; della tesi sulla predetta conversione automatica; 
        Visual Basic infatti forzer&agrave; la conversione a Long soltanto nel 
        momento in sar&agrave; obbligato a farlo, ad esempio quando il numero 
        da rappresentare non rientrer&agrave; nel tipo Integer nativo di VB. Il 
        linguaggio &egrave; perfettamente in grado di maneggiare numeri dichiarati 
        con il tipo 18: <i>Intero senza segno e da 2 bytes</i>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>A questa stranezza se ne aggiunge un'altra, data dalla variazione del 
        tipo di Variant restituito dalla propriet&agrave; Value; il primo test 
        restituiva valore 3 (DBTYPE_I4) mentre il secondo valore 18 (DBTYPE_UI2). 
        In quesat seconda analisi dopo il ricaricamento del Recordset entrambi 
        i test restituiscono valore 18 (DBTYPE_UI2), quello corretto ed in linea 
        con la documentazione di ADO.</p>
      <ol start="18" class="codicevb">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Close</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End With</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;conn.Close</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Kill &quot;c:\wrd_07.xml&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set rs = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set conn = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Unload Me</li>
        <li>End Sub</li>
      </ol>
      <p>Segue il codice occupato della chiusura del Recordset, della connessione, 
        del form e della cancellazione del file, che non richiede alcuna spiegazione.</p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Nessuna colpa pu&ograve; essere addossatta a Visual Basic riguardo queste 
        due stranezze ma il comportamento &egrave; totalmente a carico di ADO; 
        ne &egrave; prova il fatto che questa dimostrazione &egrave; stata effettuata 
        come controprova del medesimo malfunzionamento verificatosi inizialmente 
        in un progetto Delphi.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        20 Dicembre 2003<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice delle Stranezze</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
