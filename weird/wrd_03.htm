<html><!-- #BeginTemplate "/Templates/Weird.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Eventi con Variant</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Eventi con Variant<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/weird.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
</div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Questo articolo tratta un <a href="../glossary/b.htm#BUG">bug</a> che 
        si verifica <b>esclusivamente</b> con Visual Basic 5, anche dopo aver 
        installato l'ultimo <a href="../glossary/s.htm#SERVICEPACK">Service Pack</a> 
        3 per Visual Studio 97. Lo strano comportamento riguarda il passaggio 
        <a href="../info/info_05.htm">per riferimento</a> di dati Variant all'<a href="../glossary/e.htm#EVENTO">evento</a><img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle"> 
        di un controllo utente <img src="../images/ide/ctlutent.gif" width="16" height="16" align="absmiddle"> 
        e si verifica soltanto nei progetti <a href="../glossary/c.htm#COMPILAZIONE">compilati</a>.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Sebbene i conrolli utente ed i moduli di classe <img src="../images/ide/classe.gif" width="16" height="16" align="absmiddle"> 
        siano concettualmente uguali, il comportamento anomalo si verifica soltanto 
        nei controlli utente, in un momento ben preciso.<br>
        Per dimostrare questo bug utilizzeremo un progetto molto semplice contenente 
        un modulo di <a href="../glossary/c.htm#CLASSE">classe</a>, un controllo 
        utente ed un form che li utilizzer&agrave; entrambi. Il controllo utente 
        ed il modulo di classe saranno strutturalmente identici, a dimostrare 
        che la differenza tra i due esiste.<br>
        Il codice di entrambi sar&agrave; quindi il seguente:</p>
      <ol class="codicevb">
        <li>Option Explicit</li>
        <li></li>
        <li>Public Event Saluta(ByRef Saluto As Variant)</li>
        <li></li>
        <li>Public Sub Salutami()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim varSaluto As Variant</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;varSaluto = &quot;ciao&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;RaiseEvent Saluta(varSaluto)</li>
        <li>End Sub</li>
        <li></li>
        <li>Public Sub Salutami2()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim varSaluto As Variant</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;varSaluto = &quot;ciao&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;RaiseEvent Saluta(CStr(varSaluto))</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>L'evento in questione &egrave; dichiarato alla riga 3, prende il nome 
        di Saluta e riceve, per riferimento, un parametro di nome Saluto e di 
        tipo Variant. Sono presenti due <a href="../glossary/m.htm#METODO">metodi</a> 
        <img src="../images/ide/metodo.gif" width="16" height="16" align="absmiddle"> 
        di nome <b>Salutami</b> e <b>Salutami2</b> che sostanzialmente non faranno 
        altro che lanciare l'evento <i><b>Saluta</b></i>; la differenza tra loro 
        &egrave; data dal fatto che il primo passa all'evento <i> <b>Saluta</b></i> 
        la variabile <i>varSaluto</i>, mentre il secondo passa la stringa contenuta 
        nella stessa variabile.</p>
      <p>Potrebbe sembrar strana come chiamata, una stringa dove invece va passata 
        una variabile, ma si tratta comunque di un'operazione comunissima, utilizzata 
        spesso quando si desidera che la funzione chiamata non vada ad intaccare 
        dati al suo esterno, ma si desidera comunque ricevere gli effetti dati 
        dal suo richiamo.</p>
      <p>&Egrave; stata aggiunta al controllo utente, che prender&agrave; il nome 
        di <i>SmileControl</i>, la seguente routine per impedirne il ridimensionamento, 
        ma non ha alcun effetto con il resto del progetto:</p>
      <ol start="17" class="codicevb">
        <li>Private Sub UserControl_Resize()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;UserControl.Height = 240</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;UserControl.Width = 240</li>
        <li>End Sub</li>
      </ol>
      <p><img src="../images/weird/weird03_01.png" width="158" height="90" align="right" alt="Figura 1">Il 
        form che utilizzer&agrave; i due moduli conterr&agrave; quattro semplici 
        pulsanti di nome <b>cmdClsVar</b>, <b>cmdClsStr</b>, <b>cmdCtlVar</b> 
        e <b>cmdCtlStr</b>, ed un'istanza del controllo <i>SmileControl</i> appena 
        creato.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>I quattro pulsanti richiameranno rispettivamente: i metodi Salutami e 
        Salutami2 dell'<a href="../glossary/i.htm#ISTANZA">istanza</a> <b>clsSaluta</b> 
        ed i metodi Salutami e Salutami2 del controllo <b>SmileControl1</b>. Il 
        codice del form pertanto si riduce a poche miserevoli righe:</p>
      <ol start="1" class="codicevb">
        <li>Option Explicit</li>
        <li>Private WithEvents clsSaluta As Classe1</li>
        <li></li>
        <li>Private Sub Form_Load()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set clsSaluta = New Classe1</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Form_Unload(Cancel As Integer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set clsSaluta = Nothing</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>L'istanza clsSaluta &egrave; dichiarata con WithEvents (riga 2) in modo 
        da poterne utilizzare gli eventi, ed &egrave; istanziata al caricamento 
        del form (riga 5) e deallocata alla sua chiusura (riga 9).</p>
      <ol start="12" class="codicevb">
        <li>Private Sub cmdClsVar_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;clsSaluta.Salutami</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub cmdClsStr_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;clsSaluta.Salutami2</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub cmdCtlVar_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SmileControl1.Salutami</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub cmdCtlStr_Click()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SmileControl1.Salutami2</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>Come gi&agrave; detto, i quattro pulsanti richiamano i metodi Salutami 
        e Salutami2 del controllo utente e dell'istanza della classe. Lo ricordiamo, 
        il metodo Salutami genera l'evento Saluta passandovi una variabile Variant, 
        mentre Salutami2 genera lo stesso evento ma passandovi invece una stringa.</p>
      <p>Concludiamo il nostro progetto con le ultime due routine conclusive:</p>
      <ol start="28" class="codicevb">
        <li>Private Sub clsSaluta_Saluta(Saluto As Variant)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox Saluto</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub SmileControl1_Saluta(Saluto As Variant)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox Saluto</li>
        <li>End Sub </li>
      </ol>
      <p>Anche queste strutturalmente identiche: la prima riguarda l'evento Saluta 
        dell'istanza della classe, mentre la seconda riguarda lo stesso evento 
        ma del controllo utente. Per entrambe &egrave; visualizzato un avviso 
        con il valore del parametro <b>Saluto</b>, fornito dai metodi Salutami 
        e Salutami2.</p>
      <hr>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/weird/weird03_02.png" width="334" height="101" align="right">Lanciando 
        il progetto all'interno dell'<a href="../glossary/i.htm#IDE">IDE</a> di 
        Visual Basic, tutto funziona regolarmente, ma una volta compilato il progetto 
        e lanciato il file eseguibile, i primi tre pulsanti rispondono regolarmente, 
        mentre il quarto pulsante (<i><b>Controllo con String</b></i>) generer&agrave; 
        l'errore di runtime 458 mostrato nella figura a fianco. L'errore sar&agrave; 
        generato in occasione della lettura tramite <i>MsgBox</i> dei dati forniti 
        all'evento e non al ricevimento degli stessi alla routine evento.</p>
      <p>La descrizione dell'errore &egrave; <i><b>&quot;La variabile utilizza 
        un tipo di automazione non supportato in Visual Basic&quot;</b></i> e 
        descrive abbastanza bene l'errore. Infatti, nonostante il metodo Salutami2 
        avesse passato una stringa all'evento Saluta, quest'ultimo riceve dei 
        dati differenti. &Egrave; possibile verificarlo sostituendo la riga 33 
        con:</p>
      <ol start="33" class="codicevb">
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox VarType(Saluto)</li>
      </ol>
      <p>La funzione VarType restituir&agrave; infatti un valore assai anomalo: 
        99 decimale, un valore che indica un tipo di dati non previsto nei Variant 
        di Visual Basic. Vedi a tal scopo l'articolo dedicato all'<a href="../news/news_11.htm">analisi 
        della struttura dei Variant</a>.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Ci&ograve; che lascia parecchio perplessi &egrave; il fatto che all'interno 
        dell'IDE tutto scorre regolarmente e l'errore &egrave; generato soltanto 
        nella lettura di stringhe passate ad eventi di un controllo utente, che 
        si aspettano sia passata una variabile Variant.</p>
      <p>L'errore &egrave; infatti generato leggendo il valore, il contenuto di 
        <i><b>Saluto</b></i> e non leggendone il suo tipo tramite <i>VarType</i> 
        o altro. L'errore non si genera quindi:</p>
      <ul>
        <li>n&eacute; passando i dati all'evento tramite ByVal</li>
        <li>n&eacute; al ricevimento di tali dati</li>
        <li>n&eacute; per i moduli di classe</li>
        <li>n&eacute; all'interno dell'IDE di VB</li>
      </ul>
      <p>Il bug &egrave; stato corretto in Visual Basic 6.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        13 Settembre 2002<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice delle Stranezze</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
