<html><!-- #BeginTemplate "/Templates/ClientServer.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Introduzione alle funzioni WSA</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Introduzione alle funzioni 
    WSA <!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><img src="../images/api.gif" width="34" height="24" align="absmiddle"><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/cliserv.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
  </div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Questo articolo &egrave; il primo della sezione che utilizzer&agrave; 
        le funzioni <i><b>WSA</b></i> (<i>Winsock API</i>) anzich&eacute; il controllo 
        Winsock visto negli altri articoli. Esistono numerose ragioni per preferire 
        le funzioni dell'API al controllo <a href="../glossary/a.htm#ACTIVEX">ActiveX</a>; 
        il primo sicuramente &egrave; dato dalla libert&agrave; non dover installare 
        l'<a href="../glossary/o.htm#OCX">OCX</a> sulla macchina in cui andr&agrave; 
        eseguito il programma, ma in generale il controllo presenta enormi limitazioni 
        ed aspetti sgradevoli. La scelta fatta in questo articolo invece, &egrave; 
        data esclusivamente dalla fattibilit&agrave;; alcune operazioni che vedremo 
        in seguito non sono possibili usando soltanto il controllo ActiveX.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Essendo il primo progetto basato su WSA sar&agrave; occasione per spiegare 
        in generale il funzionamento, peraltro davvero molto semplice.</p>
      <p>Affinch&eacute; sia possibile utilizzare qualsiasi funzione WSA &egrave; 
        necessario che venga chiamata almeno una volta all'interno del processo, 
        la funzione di inizializzazione <b>WSAStartup</b>, che vedremo fra poco, 
        e che consente di specificare il numero di versione richiesta delle funzioni 
        <a href="../glossary/w.htm#WSA">WSA</a>; se il sistema &egrave; in grado 
        di fornire la versione richiesta risponder&agrave; positivamente oppure 
        in caso contrario restituir&agrave; un codice d'errore ed il numero di 
        versione che il sistema &egrave; in grado di utilizzare. Ad ogni chiamata 
        di WSAStartup deve corrispondere una chiamata a <b>WSACleanUp</b> che 
        servir&agrave; a liberare le risorse occupate. Una singola applicazione 
        pu&ograve; chiamare pi&ugrave; volte la funzione WSAStartup ma deve richiamare 
        altrettante volte la funzione WSACleanUp al termine dell'utilizzo delle 
        risorse.</p>
      <p>Vista la necessit&agrave; di dover chiamare ogni volta queste funzioni 
        e ricordarsi di effettuare inizializzazione e scaricamento si &egrave; 
        preferito sviluppare una classe apposita che servir&agrave; unicamente 
        ad inizializzare il supporto alle funzioni WSA e liberare le risorse al 
        termine. La classe sar&agrave; utilizzata in tutti gli esempi che accedono 
        a WSA: il suo nome &egrave; <b>clsFBISocket</b> e contiene il seguente 
        codice:</p>
      <p> 
      <ol start="1" class="codicevb">
        <li>Option Explicit</li>
        <li></li>
        <li>Private Const WSADESCRIPTION_LEN = 256</li>
        <li>Private Const WSASYS_STATUS_LEN = 128</li>
        <li></li>
        <li>Private Type WSADATA</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;bVersionL As Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;bVersionH As Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;bHighVersionL As Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;bHighVersionH As Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;szDescription(0 To WSADESCRIPTION_LEN) As 
          Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;szSystemStatus(0 To WSASYS_STATUS_LEN) As 
          Byte</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;wMaxSockets As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;wMaxUDPDG As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;dwVendorInfo As Long</li>
        <li>End Type</li>
        <li></li>
        <li>Private Enum FBISocketErrors</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SocketSuccess = 0</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SocketErrNotResponding = 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SocketErrUnsupportedVer = 2</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SocketErrNotEnoughSockets = 3</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;SocketErrOnCleanUp = 4</li>
        <li>End Enum</li>
        <li></li>
        <li>Private Declare Function WSAStartup Lib &quot;WSOCK32.DLL&quot; (ByVal 
          wVersionRequired As Long, lpWSADATA As WSADATA) As Long</li>
        <li>Private Declare Function WSACleanup Lib &quot;WSOCK32.DLL&quot; () 
          As Long</li>
        <li></li>
      </ol>
      <p>La sezione dichiarazioni conterr&agrave; la definizione di due costanti 
        <!-- #BeginLibraryItem "/Library/Costante.lbi" --> <img src="../images/ide/costante.gif" width="16" height="16" align="absmiddle"> 
<!-- #EndLibraryItem -->utilizzate dal tipo di dati<!-- #BeginLibraryItem "/Library/TipoDati.lbi" --> <img src="../images/ide/tipoudt.gif" width="16" height="16" align="absmiddle"> 
<!-- #EndLibraryItem --> WSADATA definito subito dopo; questo &egrave; richiesto 
        dalla funzione di iniziailzzazione WSAStartup e conterr&agrave; i dati 
        sulla versione di Windows Socket in uso (<i><b>bVersionL</b></i> e <i><b>bVersionH</b></i>), 
        della versione massima supportata (<i><b>bHighVersionL</b></i> e <i><b>bHighVersionH</b></i>) 
        e del numero massimo di socket disponibili (<i><b>wMaxSockets</b></i>). 
        Segue un'enumerazione <!-- #BeginLibraryItem "/Library/Enumerazione.lbi" --><img src="../images/ide/enumeraz.gif" width="16" height="16" align="absmiddle">&nbsp;<!-- #EndLibraryItem --> 
        utilizzata unicamente all'interno della classe per l'assegnazione dei 
        messaggi di errore ai singoli codici di errore.</p>
      <p>Alle righe 26 e 27 sono definite le uniche due funzioni <a href="../glossary/a.htm#API">API</a> 
        necessarie: <b>WSAStartup</b> rappresenta l'inizializzazione ed utilizza 
        due argomenti: il numero di versione richiesta ed una variabile di tipo 
        WSADATA definita in precedenza. L'altra funzione molto pi&ugrave; semplicemente 
        libera le risorse occupate dall'inizializzazione e non richiede nessun 
        argomento. Ogni inizializzazione richiede una deallocazione delle risorse 
        ed &egrave; quindi necessario che il numero di inizializzazioni sia uguale 
        al numero di deallocazioni. Questo controllo &egrave; effettuato pi&ugrave; 
        avanti.</p>
      <ol start="29" class="codicevb">
        <li>Private WSAD As WSADATA</li>
        <li>Private m_MinSockets As Integer</li>
        <li>Private m_LastError As Long</li>
        <li>Private m_IgnoreErrors As Boolean</li>
        <li>Private m_WSAInitialized As Boolean</li>
        <li></li>
        <li>Public Event Error(ByVal ErrorCode As Long, ByVal Description As String, 
          ByRef Cancel As Boolean)</li>
        <li></li>
      </ol>
      <p>La variabile <b>WSAD</b> &egrave; utilizzata unicamente dalla funzione 
        vista in precedenza e sar&agrave; impiegata per recuperare altri dati 
        in seguito all'inizializzazione del sistema Windows Socket.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Seguono altre tre <a href="../intermed/int_03.htm#STEP3">propriet&agrave; 
        private</a> utilizzate unicamente per contenere i dati che verranno esposti 
        dalle rispettive propriet&agrave; <!-- #BeginLibraryItem "/Library/Proprietà.lbi" --><img src="../images/ide/propr.gif" width="16" height="16" align="absmiddle">&nbsp;<!-- #EndLibraryItem --> 
        pubbliche. In particolare il <a href="../glossary/m.htm#MEMBRO">membro</a> 
        <i><b>m_WSAInitialized</b></i> conterr&agrave; un valore che indica il 
        buon esito o meno dell'operazione di iniziailzzazione e quindi della necessaria 
        liberazione delle risorse. La classe espone anche un evento<!-- #BeginLibraryItem "/Library/Evento.lbi" --><img src="../images/ide/evento.gif" width="16" height="16" align="absmiddle">&nbsp;<!-- #EndLibraryItem -->di 
        nome <b>Error</b> che consente di intercettare gli errori WSA, con relativa 
        descrizione e con la possibilit&agrave; di non visualizzare l'avviso di 
        errore.</p>
      <ol start="37" class="codicevb">
        <li>Private Sub Class_Initialize()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_MinSockets = 1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_IgnoreErrors = False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Call RequestVersion(1, 1)</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Class_Terminate()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If m_WSAInitialized Then Call CleanUp</li>
        <li>End Sub</li>
        <li></li>
      </ol>
      <p>All'<a href="../glossary/i.htm#ISTANZA">istanza</a> della classe saranno 
        inizializzati i membri delle propriet&agrave; e sar&agrave; richiesta 
        l'inizializzazione del sistema WSA con la versione 1.1; in seguito sar&agrave; 
        possibile richiedere una nuova versione, sempre richiamando la funzione 
        <b>RequestVersion</b> che vedremo tra poco. Alla deallocazione dell'oggetto 
        sar&agrave; invece chiamata la funzione di scaricamento delle risorse 
        se il membro <b><i>m_WSAInitialized</i></b> attivato dalla funzione <b>RequestVersion</b> 
        dovesse contenere il valore True/Vero.</p>
      <ol start="47" class="codicevb">
        <li>Public Function ErrorDescription(ByVal ErrorCode As Long) As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Select Case ErrorCode</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SocketSuccess: 
          ErrorDescription = &quot;Nessun errore&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SocketErrNotResponding: 
          ErrorDescription = &quot;L'ambiente Windows Socket 32 non risponde correttamente&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SocketErrUnsupportedVer: 
          ErrorDescription = &quot;Versione di Windows Socket non supportata&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SocketErrNotEnoughSockets: 
          ErrorDescription = &quot;Numero di socket supportati insufficiente&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case SocketErrOnCleanUp: 
          ErrorDescription = &quot;Errore durante il CleanUp&quot;</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End Select</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>Questa semplicissima funzione di nome <b>ErrorDescription</b> restituisce 
        una descrizione di errore corrispondente al codice di errore fornito.</p>
      <ol start="57" class="codicevb">
        <li>Public Function HandleError(ByVal ErrorCode As Long, Optional Description 
          As String) As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim blnCancel As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim strError As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_LastError = ErrorCode</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Not m_IgnoreErrors Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strError = IIf(Len(Description) 
          = 0, ErrorDescription(ErrorCode), Description)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RaiseEvent Error(ErrorCode, 
          strError, blnCancel)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If Not blnCancel Then 
          MsgBox &quot;Errore &quot; &amp; CStr(ErrorCode) &amp; vbNewLine &amp; 
          _</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strError, 
          vbCritical Or vbOKOnly</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>La funzione <b>HandleError</b> accoglier&agrave; quella noiosa parte 
        di gestione dei messaggi di errore. La prima operazione da farsi &egrave; 
        quella di verificare il valore del membro della propriet&agrave; <b>IgnoreErrors</b>; 
        nel caso che questo valore fosse Vero non sar&agrave; manifestato alcun 
        errore. Se il valore non dovesse essere Vero, sar&agrave; prepararato 
        un messaggio di errore, lanciato l'evento, verificato il valore di ritorno 
        dall'evento ed eventualmente mostrato un avviso di errore. Questa funzione 
        verr&agrave; richiamata ogni volta che si verifica un errore e con essa 
        verr&agrave; assegnato il valore al membro <i><b>m_LastError</b></i>.</p>
      <p>La funzione &egrave; stata resa pubblica e come tipo di dato di ErrorCode 
        &egrave; stato usato Long anzich&eacute; <i>FBISocketErrors</i> per consentire 
        l'utilizzo della funzione anche dall'esterno, ed utilizzare un'unica funzione 
        di gestione degli errori. Il secondo argomento, Description, conterr&agrave; 
        una descrizione dell'errore e se specificato avr&agrave; la precedenza 
        sulla descrizione recuperabile tramite funzione ErrorDescription.</p>
      <ol start="69" class="codicevb">
        <li>Public Function RequestVersion(ByVal LowVer As Byte, ByVal HighVer 
          As Byte) As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Dim lngVersionReq As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;lngVersionReq = HighVer * &amp;H100 + LowVer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If m_WSAInitialized Then CleanUp</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If WSAStartup(lngVersionReq, WSAD) <> 0 Then</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_WSAInitialized = 
          False</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call HandleError(SocketErrNotResponding)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Else</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_WSAInitialized = 
          True</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With WSAD</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          (.bVersionH &lt; HighVer) Or _</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(.bVersionH 
          = HighVer And .bVersionL &lt; LowVer) Then _</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call 
          HandleError(SocketErrUnsupportedVer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If 
          (.wMaxSockets &lt; m_MinSockets) Then _</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Call 
          HandleError(SocketErrNotEnoughSockets)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End With</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;End If</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;RequestVersion = m_WSAInitialized</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>Il metodo <!-- #BeginLibraryItem "/Library/Metodo.lbi" --><img src="../images/ide/metodo.gif" width="16" height="16" align="absmiddle">&nbsp;<!-- #EndLibraryItem -->di 
        inizializzazione vero e proprio <b>RequestVersion</b>, richiamato anche 
        durante l'istanza della classe, richiede la specifica della versione di 
        Windows Socket da richiedere; sar&agrave; inizialmente verificato il valore 
        del membro <i><b>m_WSAInitialized</b></i>, in modo da poter effettuare 
        la liberazione delle risorse prima di richiedere una nuova inizializzazione; 
        ci&ograve; ci assicura che il numero di iniziailzzazioni in corso sia 
        sempre 0 oppure 1. Il metodo <b>CleanUp</b> che vedremo subito dopo si 
        occupa di liberare le risorse.</p>
      <p>Richiamata la funzione <i>WSAStartup</i> (riga 73) effettueremo un primo 
        controllo sul suo valore di ritorno; se il valore non &egrave; zero la 
        funzione ha prodotto un errore e sar&agrave; quindi lasciata gestione 
        alla routine HandleError. In tal caso m_WSAInitialized assumer&agrave; 
        valore False ad indicare che non sar&agrave; necessario liberare le risorse, 
        non essendo infatti riusciti ad inizializzare il supporto WSA.</p>
      <p>Viceversa, se il valore di ritorno della funzione dovesse essere 0, assegneremo 
        il valore True al membro m_WSAInitialized e procederemo con qualche controllo 
        extra; un primo controllo riguarda la versione disponibile nel sistema; 
        nel caso richiedessimo una versione non disponibile ed il sistema supporta 
        invece una versione precedente la funzione non produrr&agrave; un errore 
        ma riporter&agrave; nei valori bVersionH e bVersionL i numeri di versione 
        in uso. Nel caso in cui la versione recuperata sia inferiore a quella 
        richiesta sar&agrave; richiesta la generazione dell'errore <i>SocketErrUnsupportedVer</i> 
        (righe 79-81).</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Un altro controllo riguarda il numero di socket disponibili; mediante 
        la propriet&agrave; MinSockets della classe &egrave; possibile assicurarsi 
        durante l'inizializzazione che vi sia un numero di socket determinato. 
        Il controllo alle righe 82 e 83 verificher&agrave; questo dato; se il 
        numero di socket disponibili sia inferiore al numero contenuto nel membro 
        <i> <b>m_MinSockets</b></i> sar&agrave; generato l'errore <i>SocketErrNotEnoughSockets</i>.</p>
      <p>Il valore di ritorno di questa funzione indicher&agrave; l'avvenuta inizializzazione 
        o meno del supporto Windows Socket.</p>
      <ol start="89" class="codicevb">
        <li>Private Function CleanUp() As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If m_WSAInitialized Then CleanUp = (WSACleanup 
          = 0)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;If Not CleanUp Then Call HandleError(SocketErrOnCleanUp)</li>
        <li>End Function</li>
        <li></li>
      </ol>
      <p>Il metodo privato <b>CleanUp</b> si occuper&agrave; di liberare le risorse 
        occupate, verificando inizialmente il valore di m_WSAInitialized, in modo 
        da non richiamare la funzione di deallocazione quando non sia necessario 
        farlo. La funzione <i>WSACleanUp</i> restituisce 0 nel caso che l'operazione 
        sia andata a buon fine; se dovesse invece verificarsi un errore durante 
        la deallocazione sar&agrave; generato l'errore <i>SocketErrOnCleanUp</i>.</p>
      <p>Seguono le propriet&agrave; pubbliche sulla cui utiliit&agrave; non dovrebbero 
        sorgere dubbi:</p>
      <ol start="94" class="codicevb">
        <li>Public Property Get Version() As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Version = CStr(WSAD.bVersionH) &amp; &quot;.&quot; 
          &amp; CStr(WSAD.bVersionL)</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Get MaxVersion() As String</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MaxVersion = CStr(WSAD.bHighVersionH) &amp; 
          &quot;.&quot; &amp; CStr(WSAD.bHighVersionL)</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Get MaxSocketSupported() As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MaxSocketSupported = WSAD.wMaxSockets</li>
        <li>End Property</li>
        <li></li>
      </ol>
      <p>La propriet&agrave; <b>Version</b> restituir&agrave; la versione di Windows 
        Socket in uso che solitamente corrisponde a quella richiesta ma in alcuni 
        casi pu&ograve; essere una versione inferiore se la versione richiesta 
        non dovesse esistere. La propriet&agrave; <b>MaxVersion</b> restituisce 
        invece il numero massimo di versione supportata dal sistema. La propriet&agrave; 
        <b>MaxSocketSupported</b> restituisce il numero massimo di socket utilizzabili 
        nella sessione corrente.</p>
      <ol start="106" class="codicevb">
        <li>Public Property Get MinSockets() As Integer</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MinSockets = m_MinSockets</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Let MinSockets(ByVal newValue As Integer)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_MinSockets = newValue</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Get LastError() As Long</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;LastError = m_LastError</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Let LastError(ByVal newValue As Long)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_LastError = newValue</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Get IgnoreErrors() As Boolean</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;IgnoreErrors = m_IgnoreErrors</li>
        <li>End Property</li>
        <li></li>
        <li>Public Property Let IgnoreErrors(ByVal newValue As Boolean)</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;m_IgnoreErrors = newValue</li>
        <li>End Property</li>
      </ol>
      <p>La classe si conclude con tre semplici propriet&agrave; in lettura e 
        scrittura <b>MinSockets</b>, <b>LastError</b> e <b>IgnoreErrors</b> che 
        puntano ai rispettivi membri.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Il modulo di classe<!-- #BeginLibraryItem "/Library/Classe.lbi" --> <img src="../images/ide/classe.gif" width="16" height="16" align="absmiddle"><!-- #EndLibraryItem --> 
        qui analizzato, davvero molto semplice, si occuper&agrave; esclusivamente 
        di inizializzare il supporto WSA ed effettuare quei controlli d'obbligo 
        sull'esecuzione e sulla versione disponibile.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        26 Marzo 2004<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice Client/Server</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
