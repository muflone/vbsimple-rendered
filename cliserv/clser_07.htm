<html><!-- #BeginTemplate "/Templates/ClientServer.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Creazione di un controllo Winsock in un modulo di classe</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Creazione di un controllo 
    Winsock in un modulo di classe<!-- #EndEditable --> 
    <!-- #BeginEditable "API" --><!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/cliserv.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
  </div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"> 
      <table width="100%"><tr><td align="left" nowrap><style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-right" style="background-color:#FFFFFF;color:#000000">
  <div class="cse-branding-form">
    <form action="http://www.google.it/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-8218922773694577:rv2o52-qh5a" />
        <input type="hidden" name="ie" value="ISO-8859-1" />
        <input type="text" name="q" size="20" />
        <input type="submit" name="sa" value="Cerca" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Ricerca personalizzata
  </div>
</div></td><td align="right">
      <p align="right" class="size3">Difficolt&agrave;: <img src="../images/icons/level1.gif" width="17" height="18" align="absmiddle"><!-- #BeginEditable "DIFFICOLTA" --><img src="../images/icons/level2.gif" width="17" height="18" align="absmiddle"><img src="../images/icons/level3.gif" width="17" height="18" align="absmiddle"> 
        3<!-- #EndEditable --> / 5</p>
</td></tr></table>
      <script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" --> 
      <p>Il problema in esame trova molteplici soluzioni. La pi&ugrave; semplice, 
        anche se non molto pulita consiste nel creare un form, inserire all'interno 
        d'esso il controllo Winsock ed impostare la propriet&agrave; <b>Visible</b> 
        del form a False. In tal modo il form sar&agrave; caricato in memoria 
        ma sar&agrave; completamente invisibile all'utente. Per utilizzare il 
        controllo baster&agrave; fare riferimento al form contenitore.<br>
        Ad esempio se il nostro form nascosto si chiama Form1 ed il controllo 
        Winsock si chiama Winsock1, baster&agrave; scrivere Form1.Winsock1 per 
        ottenere un riferimento completo al controllo.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Per sfruttare in maniera diretta il controllo all'interno del form si 
        potrebbe eseguire un assegnamento di una variabile di classe al controllo 
        all'interno del form.<br>
        In codice tutto questo si effettua con queste semplici istruzioni:</p>
      <ol class="codicevb" start="1">
        <li>Public WithEvents Winsock1 As Winsock</li>
        <li>Private FormWSock As Form1</li>
        <li></li>
        <li>Private Sub Class_Initialize()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FormWSock = New Form1</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set Winsock1 = FormWSock.Winsock1</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Class_Terminate()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set Winsock1 = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Unload FormWSock</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set FormWSock = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Classe1 deallocata&quot;</li>
        <li>End Sub</li>
      </ol>
      <p>La prima riga definisce la variabile membro collegata al controllo del 
        Form1.<br>
        La seconda riga prepara una variabile utilizzabile per creare istanze 
        del Form1. Avremmo potuto usare la normale istruzione Load Form1, ma non 
        avremmo potuto utilizzare pi&ugrave; di un'istanza di classe per volta.</p>
      <p>All'interno dell'inizializzazione della classe avviene l'istanza del 
        Form1 nella variabile FormWSock e subito dopo il collegamento (<a href="../glossary/m.htm#MAPPING">mapping</a>) 
        tra la variabile Winsock1 della classe con il controllo Winsock1 del form 
        istanziato da FormWSock (righe 5 e 6).</p>
      <p>Alla chiusura della classe avviene la deallocazione della variabile membro 
        Winsock1, lo scaricamento del form dalla memoria, la deallocazione della 
        variabile puntatore al Form1, ed un messaggio di confermata chiusura, 
        che pu&ograve; essere tranquillamente rimosso.</p>
      <p>Questa classe &egrave; facilmente istanziabile e possiede una variabile 
        pubblica che contiene il nostro controllo Winsock.</p>
      <hr>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Una seconda soluzione al problema &egrave; data dall'istruzione <i>CreateObject</i>, 
        la quale crea un'<a href="../glossary/i.htm#ISTANZA">istanza</a> di un 
        controllo <a href="../glossary/a.htm#ACTIVEX">ActiveX</a> e restituisce 
        un <a href="../glossary/p.htm#PUNTATORE">puntatore</a> ad un Object.<br>
        Il suo sfruttamento presuppone la conoscenza del nome interno della classe. 
        Nel caso del Winsock il suo nome &egrave; <b>MSWinsock.Winsock</b>. Tutti 
        i nomi delle classi sono memorizzate nel <a href="../glossary/r.htm#REGISTRO">registro</a> 
        di Windows ed ogni classe possiede un proprio <a href="../glossary/c.htm#CLSID">CLSID</a>.</p>
      <p>Questa classe sar&agrave; molto pi&ugrave; semplice della precedente 
        ma possiede numerose limitazioni:</p>
      <ol class="codicevb" start="1">
        <li>Public Winsock1 As Object</li>
        <li></li>
        <li>Private Sub Class_Initialize()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set Winsock1 = CreateObject(&quot;MSWinsock.Winsock&quot;)</li>
        <li>End Sub</li>
        <li></li>
        <li>Private Sub Class_Terminate()</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;Set Winsock1 = Nothing</li>
        <li>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox &quot;Classe2 deallocata&quot;</li>
        <li>End Sub</li>
      </ol>
      <p>Innanzitutto possiamo subito notare alla prima riga che il controllo 
        Winsock1 &egrave; dichiarato del tipo generico Object, perch&eacute; l'istruzione 
        CreateObject (riga 4) restituisce un puntatore ad una variabile Object. 
        &Egrave; assolutamente inefficace ogni tentativo di assegnare tale puntatore 
        ad una variabile di tipo Winsock.</p>
      <p>Lo svantaggio principale di questa soluzione sta nella mancanza di supporto 
        nella scrittura del codice. Infatti se la variabile fosse stata dichiarata 
        di tipo Winsock l'<a href="../glossary/i.htm#IDE">IDE</a> di Visual Basic 
        avrebbe in automatico suggerito i nomi e la sintassi dei metodi e delle 
        propriet&agrave;. Purtroppo la tipologia Object non fornisce questo supporto.<br>
        Altro svantaggio consiste nel non poter utilizzare gli eventi legati al 
        controllo. Infatti la tipologia Object non permette l'utilizzo della parola 
        chiave WithEvents che fornisce l'accesso agli eventi di un controllo.</p>
      <p>Una caratteristica molto particolare di questa soluzione appare nella 
        mancanza di riferimenti nel file di progetto. Infatti, a differenza di 
        tutte le altre soluzioni, non sar&agrave; obbligatorio aprire la finestra 
        di dialogo Componenti o quella Riferimenti dal menu progetto per inserire 
        un collegamento alla libreria MSWINSCK.OCX.</p>
      <hr>
      <p>Una terza soluzione consiste nell'inserire un riferimento al file MSWINSCK.OCX 
        tramite la voce Riferimenti del menu Progetto. La differenza principale 
        rispetto ai normali riferimenti &egrave; che non utilizzeremo il file 
        presentatoci da Visual Basic, ovvero MSWINSCK.OCA, ma il suo genitore, 
        MSWINSCK.OCX. Naturalmente non troveremo questo file nella lista di riferimenti 
        di Visual Basic; baster&agrave; premere il tasto sfoglia, cercarsi tale 
        file e premere OK.</p>
      <p>Una volta inserito tale riferimento potremo scrivere all'interno del 
        modulo di classe:</p>
      <blockquote> Public WithEvents Winsock1 As Winsock<br>
        ...<br>
        Set Winsock1 = New Winsock</blockquote>
      <p>In tal modo la variabile <b>Winsock1</b> conterr&agrave; un riferimento 
        completo ad un oggetto Winsock istanziato alla riga successiva. Potranno 
        pure essere utilizzati gli eventi associati a questo controllo.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>L'unico svantaggio presente in questa soluzione &egrave; che non potranno 
        essere inseriti controlli di tipo Winsock sopra i forms del progetto. 
        Infatti, nel momento in cui tenteremo di aggiungere il componente Winsock 
        dal menu Progetto, ci apparir&agrave; <i>Nome gi&agrave; in uso</i>. Il 
        motivo &egrave; semplice: mediante il riferimento precedente, Visual Basic 
        ha gi&agrave; caricato la classe MsWinsock.Winsock. Il tentativo di inserire 
        sia il riferimento, sia il componente Winsock genera una classe con lo 
        stesso nome di quella chiamata per prima, generando un errore di nome 
        non univoco. Perch&eacute; ricordiamo che Visual Basic nell'utilizzo dei 
        componenti esterni inserisce un riferimento al file con <a href="../glossary/e.htm#ESTENSIONIVB">estensione 
        OCA</a>.<br>
        <br>
      </p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>In ogni caso si consiglia l'utilizzo della prima soluzione in problemi 
        di questo genere, tenendo conto che, fintanto che sar&agrave; necessario 
        utilizzare il controllo Winsock, dovr&agrave; restare in memoria il form 
        contenitore del controllo.<br>
        Se il programma usufruitore della classe scarica accidentalmente il form 
        dalla memoria il codice non funzioner&agrave; nel modo corretto.</p>
      <p>Questo problema non sorge invece con la seconda soluzione poich&eacute; 
        non vi sono form caricati in memoria, ovvero potenziali rischi, ma il 
        tutto risiede in poche righe di classe.</p>
      <p>La terza soluzione &egrave; sicuramente la pi&ugrave; comoda, ma limita 
        l'utilizzo della classe all'interno di altri progetti. Il che va contro 
        il principio della riutilizzabilit&agrave; del codice, testata d'angolo 
        della <a href="../glossary/p.htm#PROGRAMMAZIONEADOGGETTI">programmazione 
        ad oggetti</a>.</p>
      <!-- #EndEditable -->
      <p align="right" class="credits2"><!-- #BeginEditable "CREDITS" --><a href="../vbmail.htm?id=1">Fibia 
        FBI</a><br>
        17 Novembre 2000<!-- #EndEditable --></p>
      <!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice Client/Server</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
