<html><!-- #BeginTemplate "/Templates/Articoli.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Stringhe API</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Stringhe API<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/news.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
  </div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"><script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" -->
      <p>Si &egrave; accennato pi&ugrave; di una volta che nei sistemi Windows 
        le stringhe sono archiviate secondo due codifiche: <a href="../glossary/a.htm#ANSI">ANSI</a> 
        ed <a href="../glossary/u.htm#UNICODE">Unicode</a>. Windows 95/98/ME utilizzano 
        la codifica ANSI secondo cui ad ogni carattere corrisponde un byte. Windows 
        NT utilizza invece la codifica Unicode per la quale ogni carattere della 
        stringa occupa due bytes, ma consente anche l'utilizzo di stringhe ANSI, 
        sempre preferendo, per&ograve;, le prime.</p>
      <p><a href="../intermed/int_04.htm">Abbiamo anche detto</a> che Visual Basic 
        maneggia le stringhe utilizzando sempre la codifica Unicode. Altres&igrave; 
        molti programmatori in linguaggio C (quelli che lavoravano in ambienti 
        a 16 bit) sono abituati al fatto le stringhe non sono altro che <a href="../glossary/a.htm#ARRAY">array</a> 
        oppure <a href="../glossary/p.htm#PUNTATORE">puntatori</a> di caratteri 
        e la dimensione della stringa &egrave; determinata dalla presenza di un 
        carattere <a href="../glossary/n.htm#NULL">NULL</a> terminatore. Tutte 
        le funzioni che manipolano stringhe si aspettano infatti che al termine 
        della stringa ci sia tale carattere, con codice <a href="../glossary/a.htm#ASCII">ASCII</a> 
        0.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>&Egrave; un'usanza comune troncare una stringa inserendo un valore NULL 
        nel punto in cui essa deve essere interrotta, oppure modificare il punto 
        di inizio della stringa spostando il puntatore al carattere da cui far 
        iniziare la stringa. Questo allo scopo di chiarire che in linguaggio C 
        gli array sono normalissimi puntatori.</p>
      <p>Nel momento in cui un programma Visual Basic comincia a <a href="../info/info_09.htm">comunicare 
        con un altro programma o una libreria esterna</a> si mettono in ballo 
        dei problemi che inizialmente potevano essere sottovalutati.</p>
      <p>Infatti la maggior parte delle funzioni API sono progettate per utilizzare 
        la codifica ANSI e quindi funzionare sia su Windows 9x che su Windows 
        NT. Particolare cura deve pertanto essere apportata nel trattamento delle 
        stringhe. La dichiarazione (<a href="../glossary/p.htm#PROTOTIPO">prototipo</a>) 
        di una funzione di libreria conterr&agrave; quasi sempre la definizione 
        del tipo di stringa che la funzione richiede. Un esempio di queste dichiarazioni 
        &egrave; il seguente:</p>
      <p class="fixed"> Private Declare Function sndPlaySound Lib &quot;winmm.dll&quot; 
        Alias &quot;sndPlaySoundA&quot; (ByVal lpszSoundName As String, ByVal 
        uFlags As Long) As Long<br>
        <br>
        BOOL sndPlaySound(LPCSTR lpszSound, UINT fuSound); </p>
      <p>La prima delle due righe &egrave; la dichiarazione Visual Basic mentre 
        la seconda in linguaggio C come definita nel file header.</p>
      <p>La funzione sndPlaySound punta in realt&agrave; alla funzione <b>sndPlaySoundA</b> 
        all'interno della libreria WINMM.DLL. La A al termine della funzione indica 
        che le stringhe trattate sono codificate in ANSI. La stessa funzione con 
        codifica della stringhe in Unicode prende il nome di <b>sndPlaySoundW</b>.</p>
      <p>Il tipo di dati <i><b>LP(C)STR</b></i> nella seconda definizione indica 
        un Long Pointer (Constant) String ovvero un puntatore ad una costante 
        stringa e corrisponde al formato standard ANSI. Avremmo anche potuto trovare 
        il tipo <i><b>LP(C)WSTR</b></i>: Long Pointer (Constant) Wide String corrispondente 
        al stesso tipo di dati ma nella codifica Unicode (Wide).<br>
        La C sta ad indicare una stringa costante ovvero che non verr&agrave; 
        modificata dalla funzione che la utilizza.</p>
      <p>Nel momento in cui passeremo una stringa a tale funzione sar&agrave; 
        pertanto passato il <a href="../glossary/p.htm#PUNTATORE">puntatore</a> 
        ad un'area dati contenente tanti caratteri, pi&ugrave; uno per il terminatore, 
        quando &egrave; lunga la stringa nel formato ANSI ed esattamente il doppio 
        nel caso di Unicode.</p>
      <p>Ma poich&eacute; in linguaggi di alto livello quale Visual Basic &egrave; 
        possibile avere delle stringhe contenenti all'interno anche caratteri 
        NULL con codice ASCII 0, &egrave; stato deciso con Visual Basic 3 di utilizzare 
        un nuovo tipo di dati denominato <i><b>HLSTR</b></i>: High Level String 
        ed erano caratterizzate dal fatto che il puntatore non indirizzava direttamente 
        alla stringa in memoria ma ad una struttura (descrittore) contenente all'interno 
        la lunghezza della stringa ed un altro puntatore all'area dati in cui 
        si trovava la stringa. Non era presente alcun carattere terminatore.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Da Visual Basic 4 in poi &egrave; cambiato tutto! Il formato <i><b>HLSTR</b></i> 
        &egrave; stato abbandonato in favore di un nuovo tipo di dati: <i><b>BSTR</b></i>: 
        Basic String, una struttura molto simile alla <i><b>LPWSTR</b></i>, costituita 
        appunto da un array di caratteri e da un terminatore finale, ma presenta 
        alcune differenze fondamentali.</p>
      <ul>
        <li>La lunghezza della stringa &egrave; memorizzata in una variabile di 
          4 bytes posta prima dell'area dati e non &egrave; quindi determinata 
          dalla presenza del terminatore.</li>
        <li>Il terminatore alla fine della stringa &egrave; comunque presente 
          ma non fa parte della stringa; &egrave; ovvero escluso dalla lunghezza 
          riportata.</li>
        <li>La stringa pu&ograve; contenere al suo interno altri valori NULL.</li>
        <li>Non &egrave; consentito alterare, se non entro certi limiti, la struttura 
          della stringa. OLE definisce alcune funzioni per la manipolazione di 
          questa particolare struttura.</li>
      </ul>
      <p>Possiamo schematizzare i quattro tipi di stringhe con:</p>
      <table width="95%" border="1" cellspacing="2" cellpadding="3" align="center">
        <tr> 
          <td align="center" valign="middle" width="15%"><b>LPSTR</b></td>
          <td width="70%" align="left" valign="middle"><img src="../images/news/news10_01.gif" width="174" height="13"><br>
            Il puntatore alla stringa indica il primo carattere dei dati. La stringa 
            &egrave; terminata con NULL ed ogni carattere occupa un byte</td>
          <td align="center" valign="middle" width="15%">10 bytes</td>
        </tr>
        <tr> 
          <td align="center" valign="middle" width="15%"><b>LPWSTR</b></td>
          <td width="70%" align="left" valign="middle"><img src="../images/news/news10_02.gif" width="284" height="13"><br>
            Il puntatore alla stringa indica il primo carattere dei dati. La stringa 
            &egrave; terminata con NULL ed ogni carattere occupa 2 bytes</td>
          <td align="center" valign="middle" width="15%">20 bytes</td>
        </tr>
        <tr> 
          <td align="center" valign="middle" width="15%"><b>HLSTR</b></td>
          <td width="70%" align="left" valign="middle"><img src="../images/news/news10_03.gif" width="163" height="13"><br>
            Il puntatore alla stringa indica una struttura di due membri: la lunghezza 
            della stringa in bytes ed un puntatore all'area dati. La stringa non 
            &egrave; terminata con NULL ed ogni carattere occupa 1 byte</td>
          <td align="center" valign="middle" width="15%">13 bytes</td>
        </tr>
        <tr> 
          <td align="center" valign="middle" width="15%"><b>BSTR</b></td>
          <td width="70%" align="left" valign="middle"><img src="../images/news/news10_04.gif" width="284" height="13"><br>
            Il puntatore alla stringa indica il primo carattere della stringa. 
            I 4 bytes precedenti ad essa indicano la lunghezza della stringa che 
            &egrave; terminata con NULL ed ogni carattere occupa 2 bytes</td>
          <td align="center" valign="middle" width="15%">24 bytes</td>
        </tr>
      </table>
      <p>&Egrave; proposto un esempio per dimostrare la presenza dei 4 bytes di 
        una stringa <i><b>BSTR</b></i>, che indicano la lunghezza in bytes (non 
        in caratteri) e la presenza del carattere terminatore in Unicode.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --> 
      <p>Articolo basato su due testi di Bruce Mc Kinney:</p>
      <ol>
        <li>Hardcore Visual Basic - Seconda edizione 1997</li>
        <li>Extending Visual Basic with C++ DLLs - Aprile 1996</li>
      </ol>
      <!-- #EndEditable -->
      <!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia FBI</a><br>
        14 Aprile 2002</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli articoli</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
