<html><!-- #BeginTemplate "/Templates/Articoli.dwt" -->
<head>
<script language="JavaScript" src="../funzioni.js"></script>
<script language="JavaScript" src="../scroller.js"></script>
<!-- #BeginEditable "doctitle" --> 
<title>Analisi di un Variant</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link href="../stili.css" rel="stylesheet" type="text/css" title="stili">
<link href="../codicevb.css" rel="stylesheet" type="text/css" title="codicevb">
<link href="../colori.css" rel="stylesheet" type="text/css" title="colori">
<meta name="description" content="Visual Basic Simple &egrave; l'unico sito in Italia che tratta la programmazione in Visual Basic in un'ottica mai vista prima d'ora. Tutti gli articoli sono spiegati passo dopo passo ed in una maniera davvero semplice per consentire a tutti di comprendere gli argomenti trattati.">
<meta name="keywords" content="VB, Visual, Basic, Simple, programmazione, codici, esempi, manuali, studio, sviluppo, ActiveX, OCX, articoli, notizie, apprendere, QBasic, API, COM, database">
</head>

<body bgcolor="#FFFFFF" leftmargin="0" topmargin="0">
<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td width="400" align="left" bgcolor="#FFFFFF"><img src="../images/vbslogo.jpg" width="400" height="80" border="0" alt="Visual Basic Simple"></td>
    <td width="100%" align="right" bgcolor="#FFFFFF"> 
      <div class="intestazioni"><a href="../home.htm">Home Page</a> <a href="../home.htm"><img src="../images/icons/dothome.gif" align="absmiddle" border="0" alt="Home Page" width="25" height="25"></a><br>
        <a href="../history.htm">Novit&agrave;</a> <a href="../history.htm"><img src="../images/icons/dotinfo.gif" align="absmiddle" border="0" alt="Informazioni su VB Simple" width="25" height="25"></a><br>
        <a href="../help.htm">Aiuto</a> <a href="../help.htm"><img src="../images/icons/dothelp.gif" align="absmiddle" border="0" alt="Hai bisogno d'aiuto?" width="25" height="25"></a></div>
    </td>
    <td width="160" align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 160x90, creato 02/02/09 */
google_ad_slot = "8970907891";
google_ad_width = 160;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></td>
  </tr>
</table>

<div align="center"> 
  <div class="titolo"><!-- #BeginEditable "TITOLO" -->Analisi di un Variant<!-- #EndEditable --></div>
  <script language="Javascript">NomePagina();</script>
  <table width="80%" border="1" cellspacing="1" cellpadding="3" bordercolorlight="#000000" bordercolordark="#000000" class="dontprint">
    <tr class="size0"> 
      <td align="center" width="25%"><a href="../ftv21/news.htm" target="treeframe"><img src="../images/icons/search%20window.gif" width="16" height="16" border="0" alt="Sincronizza Indice"><br>
        Sincronizza Indice</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
        Scarica il progetto</a></td>
      <td align="center" width="25%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
        Testo dell'articolo</a></td>
      <td align="center" width="25%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
        Stampa l'articolo</a></td>
    </tr>
  </table>
  </div>
<table width="100%" border="0">
  <tr> 
    <td width="80%"><script language="JavaScript">ShowArticlesScroller();</script><!-- #BeginEditable "CORPO" -->
      <p>Uno dei <a href="../info/info_04.htm">tipi di dati</a> pi&ugrave; usati 
        (ed a volte abusati) nei progetti scritti in Visual Basic, tanto che in 
        VBScript si tratta dell'unico tipo di dato, &egrave; il <b>Variant</b>.</p>
      <p>Si tratta di una tipologia di dati mista: una variabile dichiarata come 
        Variant pu&ograve; assumere vari tipi di dati: numeri interi, decimali 
        a singola e doppia precisione, stringhe, booleani, oggetti e persino errori. 
        &Egrave; il tipo di dati predefinito se non specificato diversamente, 
        tramite un'istruzione <span class="fixed">As&nbsp;Tipo</span> oppure <span class="fixed">DefTipo</span>. 
        Altres&igrave; una variabile non dichiarata, qualora non <a href="../intermed/int_05.htm#STEP2">venga 
        usato Option Explicit</a>, viene dichiarata automaticamente con Variant.</p>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo grafica */
google_ad_slot = "0981518759";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Le variabili di tipo Variant occupano 16 bytes di memoria pi&ugrave; 
        eventuale spazio aggiuntivo per i dati puntati, nei sottotipi <i>String</i> 
        ed <i>Object</i>. La loro struttura pu&ograve; essere scissa in tre parti:</p>
      <p align="center"><img src="../images/news/news11_01.png" width="256" height="32" alt="Figura 1"><br>
        <b>Figura 1</b></p>
      <ul>
        <li>I bytes 0 e 1 indicano il sottotipo dei dati</li>
        <li>I bytes da 2 a 7 sono in genere utilizzati fuorch&eacute; per il sottotipo 
          Decimal</li>
        <li>I bytes da 8 a 15 contengono il valore </li>
      </ul>
      <p>Il sottotipo dei dati &egrave; sempre contenuto nel primo byte del Variant: 
        il valore di tale byte sar&agrave; una costante dell'<a href="../glossary/e.htm#ENUMERAZIONE">enumerazione</a> 
        <i><b>VbVarType</b></i>. Il secondo byte (alla posizione 1) conterr&agrave; 
        il valore 0 nel caso di una variabile normale, mentre in caso di un <a href="../glossary/a.htm#ARRAY">array</a> 
        il secondo byte conterr&agrave; il valore <a href="../glossary/e.htm#ESADECIMALE">esadecimale</a> 
        20, corrispondente alla costante <b>vbArray</b> (&amp;H2000).</p>
      <p>I bytes alle posizioni 2-7 sono quasi sempre inutilizzati e contengono 
        dei valori non importanti, fuorch&eacute; nel caso di variabili di sottotipo 
        Decimal. </p>
      <p><img src="../images/news/news11_02.png" width="201" height="254" align="right" alt="Figura 2">Gli 
        ultimi 8 bytes conterranno il valore della variabile Variant e saranno 
        utilizzati soltanto quelli necessari alla riproduzione di un valore del 
        sottotipo richiesto. Ad esempio una variabile con sottotipo Integer utilizzer&agrave; 
        solo i primi due bytes (16 <a href="../glossary/b.htm#BIT">bit</a>), mentre 
        con una valore Long saranno utilizzati i primi 4 bytes (32 bit).<br>
        &Egrave; fondamentale ricordare che il byte meno significativo &egrave; 
        quello alla posizione 8 mentre quello pi&ugrave; significativo si trova 
        alla posizione 15. </p>
      <p>Per dimostrare l'analisi di una variabile Variant &egrave; stato creato 
        un progetto in grado di scomporre il contenuto di una variabile Variant 
        e mostrarne il contenuto come singoli bytes separati.</p>
      <p>Nella figura a fianco &egrave; riprodotto il numero 255 utilizzando il 
        sottotipo Integer. La variabile viene analizzata, scomposta ed il suo 
        contenuto &egrave; mostrato nell'elenco sulla sinistra.</p>
      <p>Poich&eacute; le variabili Integer occupano 16 bit, il valore 255 sar&agrave; 
        contenuto nei bytes alle posizioni 8 e 9. Il valore verr&agrave; quindi 
        riprodotto in esadecimale con <b class="colorerosso">00FF</b>. Il sottotipo 
        dei dati &egrave; indicato nel byte alla posizione 0 e nel nostro caso 
        indica il valore 2, corrispondente alla costante <b>vbInteger</b>. Il 
        byte alla posizione 1 indicher&agrave; invece il valore 0 poich&eacute; 
        si tratta di una variabile semplice e non di un array.</p>
      <table width="90%" border="0" cellspacing="0" cellpadding="3" align="center">
        <tr> 
          <td align="center" valign="top"><img src="../images/news/news11_03.png" width="201" height="254" alt="Figura 3"><br>
            <b>Figura 3</b></td>
          <td valign="top" align="center"><img src="../images/news/news11_04.png" width="201" height="254" alt="Figura 4"><br>
            <b>Figura 4</b></td>
        </tr>
      </table>
      <p>Altres&igrave; le variabili di sottotipo Long, che si compongono di 32 
        bit, contengono i loro dati nei byte 8-11 e nella Figura 3 il valore 255 
        &egrave; mostrato come <b class="colorerosso">000000FF</b> esadecimale. 
        Nella Figura 4, poich&eacute; il sottotipo scelto &egrave; il Byte, i 
        dati sono reclusi al byte 8, con il valore esadecimale <b class="colorerosso">FF</b>.</p>
    <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* Contenuti 468x60 */
google_ad_slot = "0785185013";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p>Quattro casi un po' particolari sono le variabili con sottotipo String, 
        Object, Error e Decimal; vediamo in dettaglio il funzionamento di tali 
        tipologie di dati. Cominciamo analizzando il contenuto di una variabile 
        Variant/String. &Egrave; fondamentale ricordare che le stringhe sono rappresentate 
        come <a href="../glossary/p.htm#PUNTATORE">puntatori</a> ad una zona contigua 
        di caratteri. Vedi anche l'articolo dedicato alle <a href="news_10.htm">stringhe 
        API</a>.</p>
      <p>Utilizzando il progetto relativo a quest'articolo, inseriamo una stringa 
        nel campo <b>Valore</b>, selezioniamo il sottotipo <i>String</i>, disattiviamo 
        la CheckBox <b>Array</b> e premiamo il pulsante <b>Analizza</b>. Utilizzando 
        la funzione <b>StrPtr</b>, apparir&agrave; in basso un'etichetta con il 
        puntatore alla stringa generata, lo stesso puntatore contenuto nei bytes 
        alle posizioni 8-11; i puntatori, infatti, sono valori a 32 bit. Nell'esempio 
        sottostante il puntatore fa riferimento a <b class="colorerosso">0061E574</b>.</p>
      <p align="center"><img src="../images/news/news11_05.gif" width="467" height="254"><br>
        <b>Figura 5</b></p>
      <p>Un click sopra l'etichetta con il puntatore alla stringa riveler&agrave; 
        una serie di informazioni su tale locazione di memoria. Apparir&agrave; 
        una MessageBox con il contenuto dell'area di memoria puntata e verr&agrave; 
        letta la lunghezza della stringa alla locazione indicata dal puntatore 
        meno 4 bytes. Lo ricordiamo, le variabili stringa <b>BStr</b> contengono 
        un riferimento alla lunghezza della stringa esattamente 4 bytes prima 
        del puntatore relativo alla stringa.</p>
      <p>La lunghezza riportata sar&agrave; esattamente uguale alla lunghezza 
        riportata dall'istruzione <a href="../intermed/int_04.htm#STEP3">LenB</a> 
        e doppia rispetto all'istruzione <a href="../intermed/int_04.htm#STEP3">Len</a> 
        sulla stringa.</p>
      <p>Le variabili di sottotipo Object si comportano in maniera quasi uguale 
        a quelle di sottotipo String. I bytes alle posizioni 8-11 conterranno 
        infatti un puntatore ad un'area dati. Il puntatore indicato sull'etichetta 
        in basso sar&agrave; il medesimo riportato dalla funzione <b>ObjPtr</b>. 
        A differenza delle stringhe non sar&agrave; facile analizzare il contenuto 
        dell'oggetto puntato.</p>
      <p><img src="../images/news/news11_06.png" width="143" height="95" align="right" alt="Figura 6">Un 
        caso molto pi&ugrave; semplice sono le variabili di sottotipo Error. Come 
        per i sottotipi precedenti, anche il sottotipo Error mostrer&agrave; un 
        valore nell'etichetta in fondo al Form.<br>
        Il valore indicato non sar&agrave; un puntatore ma piuttosto un codice 
        di errore. Un click sopra l'etichetta mostrer&agrave; una finestra di 
        avviso con il codice e la descrizione dell'errore generato.</p>
      <p><img src="../images/news/news11_07.png" width="201" height="254" align="left" alt="Figura 7">L'analisi 
        di una variabile con sottotipo Decimal riveler&agrave; qualcosa di differente 
        rispetto tutti gli altri sottotipi di dati analizzati fino ad ora.</p>
      <p>Innanzitutto &egrave; bene ricordare che il Decimal non &egrave; un tipo 
        di dati nativo di VB. Non &egrave; pertanto possibile dichiarare variabili 
        di tipo Decimal. L'unico modo per utilizzare un valore Decimal consiste 
        nel richiamare la funzione <i>CDec</i> con una variabile di tipo Variant.</p>
      <p>Nell'esempio a fianco abbiamo inserito il valore <b>255,12</b> nella 
        casella apposita, scelto il sottotipo Decimal e premuto il tasto Analizza. 
        Il numero sar&agrave; quindi contenuto nei bytes alle posizioni 8-15. 
        Tuttavia se analizziamo bene il contenuto di tali dati noteremo cosa realmente 
        accade. Nel nostro esempio il numero &egrave; stato riprodotto con <b class="colorerosso">00 
        00 00 00 00 00 63 A8</b>; una rapida conversione in decimale dimostrer&agrave; 
        che il numero indicato &egrave; <b>25512</b>, ovvero il nostro numero 
        specificato ma moltiplicato per 100 o per meglio dire privato della sua 
        virgola.</p>
      <p>Pertanto i dati riportati alle posizioni 8-15 sono la rappresentazione 
        intera del numero originale. Per memorizzare il numero originale verr&agrave; 
        utilizzato il byte alla posizione 2, inutilizzata da tutti gli altri sottotipi 
        di dati. Nel nostro esempio infatti troviamo in tale posizione il valore 
        <b class="coloreblu">02</b> che rappresenta il moltiplicatore in potenza 
        di dieci del numero intero (10 ^ 2 = 100).</p>
      <p>Per riottenere il numero originale sar&agrave; pertanto necessario dividere 
        il numero intero, riportato alle posizioni 8-15 (<b class="colorerosso">25512</b>) 
        per 10 elevato alla potenza indicata alla posizione 2 (<b class="coloreblu">100</b>). 
        Nel nostro esempio infatti 25512 / 100 restituisce 255,12.</p>
      <hr>
      <p align="center"><script type="text/javascript"><!--
google_ad_client = "pub-8218922773694577";
/* 468x60 solo testo */
google_ad_slot = "6726967947";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
      <p><img src="../images/news/news11_08.png" width="201" height="254" align="right" alt="Figura 8">Prima 
        di concludere con l'argomento Variant diamo uno sguardo a cosa accade 
        assegnando ad una variabile Variant un array.</p>
      <p>Nella nostra applicazione di esempio abbiamo fatto in modo che i pulsanti 
        di scelta Empty, Null, Error e Decimal venissero bloccati in caso di scelta 
        di un Array; questo perch&eacute; non &egrave; possibile creare vettori 
        di tale tipo di dati, in quanto non nativi in VB.</p>
      <p>Nella figura a fianco abbiamo specificato il valore 68, scelto il sottotipo 
        Long ed attivata la CheckBox Array. I dati che verranno rappresentati 
        sono alquanto incomprensbili e rappresentano un puntatore alla struttura 
        creata in memoria per contenere l'array.</p>
      <p>Ci&ograve; che dovrebbe maggiormente incuriosirci sono i primi due bytes: 
        <b class="colorerosso">03</b> <b class="coloreblu">20</b>. Il primo di 
        questi due sappiamo indica il sottotipo della variabile Variant; il secondo 
        byte, corrispondente al valore esadecimale 2000 (<b>vbArray</b>), indica 
        che tale dato &egrave; appunto un <a href="../glossary/v.htm#VETTORE">vettore</a> 
        in memoria.</p>
      <p>In sostanza quindi i primi due bytes sono dati dalla combinazione mediante 
        <a href="../info/info_06.htm">operatore Or</a> delle <a href="../glossary/c.htm#COSTANTE">costanti</a> 
        <b>vbArray</b> e <b>vbLong</b> (o altro sottotipo dati).</p>
      <!-- #EndEditable --></td>
  </tr>
</table>

<table width="100%">
  <tr> 
    <td><!-- #BeginEditable "FINALE" --><!-- #EndEditable -->
      <!-- #BeginEditable "CREDITS" --> 
      <p align="right" class="credits2"><a href="../vbmail.htm?id=1">Fibia FBI</a><br>
        9 Agosto 2002</p>
      <!-- #EndEditable --><!-- #BeginLibraryItem "/Library/Toolbar.lbi" -->
      <table width="80%" border="1" cellspacing="1" cellpadding="3" align="center" bordercolor="#000000" class="dontprint">
        <tr> 
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaZIP();"><img src="../images/icons/tool%20download.gif" width="16" height="18" border="0" alt="Scarica il progetto"><br>
            <span class="size1">Scarica il progetto</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:ScaricaPDF();"><img src="../images/icons/tool%20pdf.gif" width="16" height="18" alt="Scarica il testo dell'articolo" border="0"><br>
            <span class="size1">Scarica il testo dell'articolo</span></a></td>
          <td align="center" valign="top" width="33%"><a href="javascript:Stampa();"><img src="../images/icons/tool%20print.gif" width="16" height="18" alt="Stampa l'articolo" border="0"><br>
            <span class="size1">Stampa l'articolo</span></a></td>
        </tr>
      </table><!-- #EndLibraryItem -->
    </td>
  </tr>
</table>
<table width="100%" border="0" cellspacing="2" cellpadding="2">
  <tr>
    <td align="left"><a href="index.htm"><img src="../images/vbprev.jpg" width="49" height="32" align="absmiddle" border="0"> 
      Torna all'indice degli articoli</a></td>
    <td align="right">&nbsp;</td>
  </tr>
</table>

<hr width="80%">
<table width="100%">
  <tr>
    <td width="100%" align="center">
      <script language="Javascript">Banner();</script>
      <!--#echo banner=""-->
    </td>
  </tr>
</table>
<script language="Javascript">FibiaWebStats();</script>
</body>
<!-- #EndTemplate --></html>
